//    :::::: PROGRAMA DE CONTROLE ESCOLAR
//    .BY  : SERVO DO DEUS ALTISSIMO
//    .Data: modulo 1 - inicio em mar‡o/94
//    ::::::

// SSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS MENU   SECRETARIA


FUNCTION SECRETARIA(TA)
NOMTELA('CONTROLE DE SECRETARIA ESCOLAR')
SET MESSAGE TO 24 CENTER
DO WHILE .T.
      SETCOLOR(GCOR2)
      @       2,1   PROMPT ' 1.CADASTRO  '    MESS  '[             Vide Menu                  ]'
      @ ROW(),COL() PROMPT ' 2.NOTAS     '    MESS  '[ Lancamento de canhotos/notas|Fechamento]'
      @ ROW(),COL() PROMPT ' 3.CONSULTA '     MESS  '[ Consulta diversas (matricula,notas,... ]'
      @ ROW(),COL() PROMPT ' 4.RELATORIOS '   MESS  '[ Relatorios diversos-(boletim,hist,...) ]'
      @ ROW(),COL() PROMPT ' 5.CONFIGURACAO ' MESS  '[ Configura cores, marcas para apagar... ]'
      @ ROW(),COL() PROMPT ' 6.RETORNAR'      MESS  '[  Volta a 1a. Tela do Sistema           ]'
     MENU TO O2
     TE_2:=SAVESCREEN(0,0,24,79)
     DO CASE
       CASE O2=1
          MEN_CADASTRO()
       CASE O2=2
            SUB_LANCAMENTO()
       CASE O2=3
            CONS_CADMAT()
       CASE O2=4
            RELA_SECRETARIA()
       CASE O2=5
            SEC_CONFIGURAR()
       CASE O2=6 .OR. O2=0 .OR. LASTKEY()=27
          TEL22:=SAVESCREEN(2,3,23,78)
          TELA(3,69,6,77)
          @ 4,70 PROMPT '1->SIM '
          @ 5,70 PROMPT '2->NAO '
          MENU TO OPC
          IF OPC=1
             CLEAR
             EXIT
           ELSE
             RESTSCREEN(2,3,23,78,TEL22)
          ENDIF
      ENDC
      CLOSE ALL
   RESTSCREEN(0,00,24,79,TE_2)
ENDDO



//  *******    MENU DE CADASTRAMENTO DIVERSOS **********

FUNCTION MEN_CADASTRO
DO WHILE .T.
SETCOLOR(GCOR8)
TELA(3,1,12,15)
SETCOLOR(GCOR2)
      @       4,2 PROMPT '1.MATRICULA  ' MESS '[ Acessa cadastro/altera‡Æo de matricula ]'
      @ ROW()+1,2 PROMPT '2.MATERIA    ' MESS '[     Acessa cadastro de materias        ]'
      @ ROW()+1,2 PROMPT '3.PROFESSOR  ' MESS '[    Acessa cadastro de professores      ]'
      @ ROW()+1,2 PROMPT '4.GRADE P/SE.' MESS '[ Cadastro da grade curricular ano/serie ]'
      @ ROW()+1,2 PROMPT '5.HISTORICO  ' MESS '[     Lcto.historico anterior a 94       ]'
      @ ROW()+1,2 PROMPT '6.ARQ.MORTO  ' MESS '[    Acessa cadastro do arquivo morto    ]'
      @ ROW()+1,2 PROMPT '7.MENSAGENS  ' MESS '[  Mensagem padrao p/ impr. boletim esc. ]'
      @ ROW()+1,2 PROMPT '8.RETORNAR   ' MESS '[          Retorna a 1¦ Tela             ]'
     MENU TO O3
     SETCOLOR(GCOR1)
     TE_5:=SAVESCREEN(0,0,24,79)
     DO CASE
       CASE O3=1
            CAD_MATRICULA()
       CASE O3=2
            CAD_MATERIA()
       CASE O3=3
            CAD_PROFESSOR()
       CASE O3=4
            CAD_GRADE()
       CASE O3=5
            CAD_HISTORICO()
       CASE O3=6
            CAD_MORTO()
       CASE O3=7
            MENSAGEM()
       CASE O3=8 .OR. O3=0 .OR. LASTKEY()=27
             CLEAR
             EXIT
      ENDC
      CLOSE ALL
      SETCOLOR(GCOR2)
   RESTSCREEN(0,00,24,79,TE_5)
ENDDO
RETURN


FUNCTION SUB_LANCAMENTO
DO WHILE .T.
SETCOLOR(GCOR8)
TELA(3,15,7,31)
SETCOLOR(GCOR2)
      @       4,16 PROMPT '1.LANCAMENTOS' MESS '[ Acessa lancamento/alteracao de canhotos]'
      @ ROW()+1,16 PROMPT '2.FECHAMENTO ' MESS '[ Acessa fechamento de medias por serie  ]'
      @ ROW()+1,16 PROMPT '3.RETORNAR   ' MESS '[          Retorna a 1¦ Tela             ]'
     MENU TO O3
     SETCOLOR(GCOR1)
     TE_5:=SAVESCREEN(0,0,24,79)
     DO CASE
       CASE O3=1
            LANC_SECRETARIA()
       CASE O3=2
            FEC_NOTAS()
       CASE O3=3 .OR. O3=0 .OR. LASTKEY()=27
             CLEAR
             EXIT
      ENDC
      CLOSE ALL
      SETCOLOR(GCOR2)
   RESTSCREEN(0,00,24,79,TE_5)
ENDDO
RETURN

FUNCTION CONS_CADMAT
DO WHILE .T.
SETCOLOR(GCOR8)
TELA(3,27,12,42)
SETCOLOR(GCOR2)
      @       4,28 PROMPT '1.MATRICULA  ' MESS '[ Cons. cad. de matricula - ordem alfab. ]'
      @ ROW()+1,28 PROMPT '2.MATERIA    ' MESS '[ Cons. cad. de materias  - ordem alfab. ]'
      @ ROW()+1,28 PROMPT '3.PROFESSOR  ' MESS '[ Cons. cad. de professor - ordem alfab. ]'
      @ ROW()+1,28 PROMPT '4.GRADE P/SE ' MESS '[     Cons. cad. grade curricular        ]'
      @ ROW()+1,28 PROMPT '5.ARQ.MORTO  ' MESS '[  Cons. arq. morto -  ordem alfabetica  ]'
      @ ROW()+1,28 PROMPT '6.BOLETIM    ' MESS '[ Cons. boletim do aluno - vide codigo   ]'
      @ ROW()+1,28 PROMPT '7.ALUNO P/NUM' MESS '[ Cons.aluno por gr/se/turma e numero    ]'
      @ ROW()+1,28 PROMPT '8.RETORNAR   ' MESS '[          Retorna a 1¦ Tela             ]'
     MENU TO O4
     TE_5:=SAVESCREEN(0,0,24,79)
     DO CASE
       CASE O4=1
           CON_MATRICULA()
       CASE O4=2
            CON_MATERIA()
       CASE O4=3
            CON_PROFESSOR()
       CASE O4=4
            CON_GRADE()
       CASE O4=5
            CON_MORTO()
       CASE O4=6
            CON_BOLET()
       CASE O4=7
            CON_MATRICULA()
       CASE O4=8 .OR. O4=0 .OR. LASTKEY()=27
             CLEAR
             EXIT
      ENDC
      CLOSE ALL
    SETCOLOR(GCOR2)
   RESTSCREEN(0,00,24,79,TE_5)
ENDDO





FUNCTION RELA_SECRETARIA
DO WHILE .T.
SETCOLOR(GCOR8)
TELA(3,38,23,55)
SETCOLOR(GCOR2)
      SETCOLOR('W/BG')
      @       4,40 SAY    '  BOLETIM    '
      SETCOLOR(GCOR2)
      @ ROW()+1,40 PROMPT '1.GERAL/SERIE' MESS '[        Emite geral ou por serie        ]'
      @ ROW()+1,40 PROMPT '2.ALUNO      ' MESS '[  Emite boletins - pede pelo cod.aluno  ]'
      @ ROW()+1,40 PROMPT '3.SECRETARIA ' MESS '[   Emite listagem por serie-SECRETARIA  ]'
      @ ROW()+1,40 PROMPT '4.CF.CANHOTO ' MESS '[    Emite rel. p/ conf. de canhotos     ]'
      @ ROW()+1,40 PROMPT '5.BOL.P/PAIS ' MESS '[   Emite Boletins p/ Pais/texto e capa  ]'
      SETCOLOR('W/BG')
      @ ROW()+1,40 SAY    ' PADRONIZADO '
      SETCOLOR(GCOR2)
      @ ROW()+1,40 PROMPT '6.DIARIOS    ' MESS '[ Lista(lateral) dos diarios - vide menu ]'
      @ ROW()+1,40 PROMPT '7.HISTORICOS ' MESS '[ Historico-Escolar - cfe. cod. planilha ]'
      SETCOLOR('W/BG')
      @ ROW()+1,40 SAY    ' SECRETARIA  '
      SETCOLOR(GCOR2)
      @ ROW()+1,40 PROMPT '8.MATERIAS   ' MESS '[   Emite relatorio em ordem alfab‚tica   ]'
      @ ROW()+1,40 PROMPT '9.PROFESSOR  ' MESS '[   Emite relatorio em ordem alfabetica  ]'
      @ ROW()+1,40 PROMPT 'G.GRADE P/SE.' MESS '[ Emite relatorio com as grades por serie]'
      @ ROW()+1,40 PROMPT 'L.RELAT.LIVRE' MESS '[ Monta relatorios cfe. criterio/usuario ]'
      @ ROW()+1,40 PROMPT 'M.MATRICULA  ' MESS '[ Rel.alunos por ser/tur/gra-ordem alfab.]'
      @ ROW()+1,40 PROMPT 'N.RELAT.N.MAT' MESS '[Rel.alunos por num. de matricula/SEC    ]'
      @ ROW()+1,40 PROMPT 'S.ALUNOS M/F ' MESS '[ Rel. por ordem MASC/FEM, idade Int/Ext.]'
      @ ROW()+1,40 PROMPT 'X.ARQ.MORTO  ' MESS '[        Rel. por ordem alfabetica       ]'
      @ ROW()+1,40 PROMPT '0.RETORNAR   ' MESS '[         Retorna a tela anterior        ]'
     MENU TO O3
     TE_5:=SAVESCREEN(0,0,24,79)
        DO CASE
          CASE O3=1
            BOLET_SERIE()
          CASE O3=2
           BOLET_ALUNO()
          CASE O3=3
           BOLET_SEC()
          CASE O3=4
           CONFCANHO()
          CASE O3=5
           RELBO_PAI()
          CASE O3=6
           REL_DIARIOS()
          CASE O3=7
           REL_HISTORICO()
          CASE O3=8
            RELA_MATE()
          CASE O3=9
            RELA_PROF()
          CASE O3=10
            RELA_GRADE()
          CASE O3=11
            SUBRELA_FREE()
          CASE O3=12
           TP:=' '
           TELA(17,51,19,77)
           @ 18,52 SAY '[C]Lasse | [M]atric.'
           @ 18,75 GET TP PICT'@SA!' VALID(TP$ 'CM ')
           READ
           IF TP$'C'
               REL_MATCLA()
           ELSEIF TP$'M'
              RELA_ALU()
          ENDIF
          CASE O3=13
           TP:=' '
           TELA(18,51,20,78)
           @ 19,52 SAY '[R]esumo|[G]eral|[S]EC '
           @ 19,77 GET TP PICT'@SA!' VALID(TP$ 'RGS ')
           READ
           IF TP$'R'
               NUMMATR2()
           ELSEIF TP$'G'
              REL_NUMMATR()
           ELSEIF TP$'S'
              REL_MATBOL()
          ENDIF
          CASE O3=14
            RELA_ALU1()
          CASE O3=15
            RELA_MOR()
        CASE O3=16 .OR. O3=0 .OR. LASTKEY()=27
             CLEAR
             EXIT
      ENDC
      CLOSE ALL
   SETCOLOR(GCOR2)
   RESTSCREEN(0,00,24,79,TE_5)
ENDDO
RETURN

// ********** CADASTRO/ALTERACAO DE MATRICULAS ******


FUNCTION CAD_MATRICULA
A:=PROCNAME()
IF !ABREARQ('CADMATRI','CADA_MAT','E',3)
   RETURN
ENDIF
SET INDEX TO NUMATIND, COMATIND, NOMATIND, BOMATIND, GSMATIND, DTMATIND
NOMTELA('CADASTRO DE MATRÖCULAS/ALUNO')
MATR:='   '
SETCOLOR('RB/G,N/G,,,W/G')
DO WHILE .T.
   TELA(3,02,24,77)
   C_MAT:=' '
   APA_TELA()
   E:=0
   O:=' '
   @       5,16 GET MATR PICT'@R 999'
   READ
   IF LASTKEY()=27
     EXIT
   ENDIF
   SEEK MATR
   IF FOUND()
        TONE(1299,4)
        V:=RECNO()
        E:=1
   ENDIF
   IF E=0
       B:=MATR
       CRIA_VAR()
       MATR:=B
       GO (LASTREC())
       CO_D:=COD_ALU
       CO_D:=STRZERO((VAL(LEFT(CO_D,5))+1),5,0)
       C_ALU:=VAL(RIGHT(CO_D,1))
       IF C_ALU=1
           C_ALU:=CO_D+'0'
         ELSEIF C_ALU=2
           C_ALU:=CO_D+'9'
         ELSEIF C_ALU=3
           C_ALU:=CO_D+'8'
         ELSEIF C_ALU=4
           C_ALU:=CO_D+'7'
         ELSEIF C_ALU=5
           C_ALU:=CO_D+'6'
         ELSEIF C_ALU=6
           C_ALU:=CO_D+'5'
         ELSEIF C_ALU=7
           C_ALU:=CO_D+'4'
         ELSEIF C_ALU=8
           C_ALU:=CO_D+'3'
         ELSEIF C_ALU=9
           C_ALU:=CO_D+'2'
         ELSEIF C_ALU=0
           C_ALU:=CO_D+'1'
       ENDIF
   ENDIF
   IF E=1
     C_ALU:=COD_ALU
     MATR:=NUM_MAT
     D_MAT:=DAT_MAT
     S_MAT:=SERIE
     T_MAT:=TURMA
     G_MAT:=GRAU
     NU_CLA:=NUCLASSE
     CU_MAT:=CURSO
     N_ALU:=NOM_ALU
     SEX_ALU:=SEXO
     E_ALU:=END_ALU
     B_ALU:=BAI_ALU
     CI_ALU:=CID_ALU
     U_ALU:=UF_ALU
     CE_ALU:=CEP_ALU
     T_ALU:=TEL_ALUN
     NA_ALU:=NASC_ALU
     CI_N_ALU:=CID_NAS
     UF_N_ALU:=UF_NAS
     P_ALU:=PAI_ALU
     P_P_ALU:=PROF_PAI
     M_ALU:=MAE_ALU
     P_M_ALU:=PROF_MAE
     R_ALU:=RELI_ALU
      R_PAIS:=RELI_PAIS
     CO_ALU:=SIT_ALUN
     CO_INT:=SIT_INTE
     CO_BOL:=SIT_ECON
     N_BOL:=NUM_BOLS
     N_RESP:=NOM_RESP
     E_RESP:=END_RESP
     B_RESP:=BAI_RESP
     C_RESP:=CID_RESP
     U_RESP:=UF_RESP
     CE_RESP:=CEP_RESP
     TE_RESP:=TEL_RESP
     CP_RESP:=CPF_RESP
     R_RESP:=RG_RESP
     UF_RG_RESP:=RG_UF
     @       5,16 SAY MATR PICT'@R 999'
     APA_BCO()
   ENDIF
   @       5,33 SAY C_ALU PICT'@R 99999-9'
   @   ROW(),52 GET D_MAT PICT'@K'
   @ ROW()+1,32 GET S_MAT PICT'9' VALID(S_MAT$ '12345678')
   @   ROW(),42 GET T_MAT PICT'@S1!' VALID(T_MAT$ 'ABCEU')
   @   ROW(),48 GET G_MAT PICT'9' VALID(G_MAT$ '12')
   @   ROW(),70 GET NU_CLA PICT'99'
   @ ROW()+1,53 GET CU_MAT PICT'9'VALID(CU_MAT$ '12')
   @ ROW()+1,16 GET N_ALU PICT'@S35!' VALID(VAZIO(N_ALU))
   @   ROW(),63 GET SEX_ALU PICT'@S1!' VALID(SEX_ALU$ 'MF')
   @ ROW()+1,16 GET E_ALU PICT'@S35!'
   @ ROW()+1,16 GET B_ALU PICT'@S15!'
   @   ROW(),43 GET CI_ALU PICT'@S20!'
   @   ROW(),69 GET U_ALU PICT'@S2!'
   @ ROW()+1,16 GET CE_ALU PICT'@R 99999-999'
   @   ROW(),43 GET T_ALU PICT'@S15!'
   @ ROW()+1,16 GET NA_ALU PICT'@D'  VALID(NA_ALU<=DATE() .AND. !EMPTY(NA_ALU))
   @   ROW(),43 GET CI_N_ALU PICT'@S20!'
   @   ROW(),69 GET UF_N_ALU PICT'@S2!'
   @ ROW()+1,16 GET P_ALU PICT'@S35!'
   @   ROW(),62 GET P_P_ALU PICT'@S35!'
   @ ROW()+1,16 GET M_ALU PICT'@S35!'
   @   ROW(),62 GET P_M_ALU PICT'@S35!'
   @ ROW()+1,28 GET R_ALU PICT'@S15!'
   @   ROW(),60 GET R_PAIS PICT'@S15!'
   @ ROW()+1,43 GET CO_ALU PICT'9' VALID(CO_ALU$ '12')
   @   ROW(),70 GET CO_INT PICT'@S1!' VALID(CO_INT$ 'IE')
   @ ROW()+1,70 GET CO_BOL PICT'@S1!' WHEN CO_ALU='2' VALID(CO_BOL$ 'SE')
   @ ROW()+1,62 GET N_BOL  PICT'@S10!' WHEN CO_BOL$'S' VALID(VAZIO(N_BOL))
   @      19,17 GET N_RESP PICT'@S35!'
   @ ROW()+1,17 GET E_RESP PICT'@S35!'
   @ ROW()+1,17 GET B_RESP PICT'@S15!'
   @   ROW(),45 GET C_RESP PICT'@S20!'
   @   ROW(),69 GET U_RESP PICT'@S2!'
   @ ROW()+1,17 GET CE_RESP PICT'@R 99999-999'
   @   ROW(),45 GET TE_RESP PICT'@S15!'
   @ ROW()+1,17 GET CP_RESP PICT'@R 999.999.999-99'
   @   ROW(),45 GET R_RESP PICT'@S9!'
   @   ROW(),69 GET UF_RG_RESP PICT'@S2!'
  READ
  @ 24,25 SAY 'CONFIRMA INCLUSÇO ? Y/N [ ] '
  @ 24,50 GET O PICT'@S1!' VALID(O$ 'YN')
  READ
  IF LASTKEY()=27
      EXIT
  ENDIF
  IF O='Y'
    IF E=0
         APPEND BLANK
      ELSE
         GO V
    ENDIF
      REPLACE COD_ALU   WITH   C_ALU       ,;
              NUM_MAT   WITH   MATR       ,;
              DAT_MAT   WITH   D_MAT       ,;
              SERIE     WITH   S_MAT       ,;
              TURMA     WITH   T_MAT       ,;
              GRAU      WITH   G_MAT       ,;
              NUCLASSE  WITH   NU_CLA      ,;
              CURSO     WITH   CU_MAT      ,;
              NOM_ALU   WITH   N_ALU       ,;
              SEXO      WITH   SEX_ALU     ,;
              END_ALU   WITH   E_ALU       ,;
              BAI_ALU   WITH   B_ALU       ,;
              CID_ALU   WITH   CI_ALU      ,;
              UF_ALU    WITH   U_ALU       ,;
              CEP_ALU   WITH   CE_ALU      ,;
              TEL_ALUN  WITH   T_ALU       ,;
              NASC_ALU  WITH   NA_ALU      ,;
              CID_NAS   WITH   CI_N_ALU    ,;
              UF_NAS    WITH   UF_N_ALU    ,;
              PAI_ALU   WITH   P_ALU       ,;
              PROF_PAI  WITH   P_P_ALU     ,;
              MAE_ALU   WITH   M_ALU       ,;
              PROF_MAE  WITH   P_M_ALU     ,;
              RELI_ALU  WITH   R_ALU       ,;
              RELI_PAIS  WITH   R_PAIS      ,;
              SIT_ALUN  WITH   CO_ALU      ,;
              SIT_INTE  WITH   CO_INT      ,;
              SIT_ECON  WITH   CO_BOL      ,;
              NUM_BOLS  WITH   N_BOL       ,;
              NOM_RESP  WITH   N_RESP      ,;
              END_RESP  WITH   E_RESP      ,;
              BAI_RESP  WITH   B_RESP      ,;
              CID_RESP  WITH   C_RESP      ,;
              UF_RESP   WITH   U_RESP      ,;
              CEP_RESP  WITH   CE_RESP     ,;
              TEL_RESP  WITH   TE_RESP     ,;
              CPF_RESP  WITH   CP_RESP     ,;
              RG_RESP   WITH   R_RESP      ,;
              RG_UF     WITH   UF_RG_RESP
              COMMIT
              SELE CADA_MAT
              SET ORDER TO 1
              CRIA_VAR()
              O:=' '
       ELSE
      O:=' '
          LOOP
  ENDIF
ENDDO
RETURN



// *******   CRIA AS VARIAVEIS P/ CADASTRO DE MATRICULAS **********

FUNCTION CRIA_VAR
PUBLIC  C_ALU:=SPACE(6),;
        MATR:=SPACE(3),;
        D_MAT:=DATE(),;
        S_MAT:=SPACE(1),;
        T_MAT:=SPACE(1),;
        G_MAT:=SPACE(1),;
        NU_CLA:=SPACE(2),;
        CU_MAT:=SPACE(1),;
        N_ALU:=SPACE(35),;
        SEX_ALU:=' ',;
        E_ALU:=SPACE(35),;
        B_ALU:=SPACE(15),;
        CI_ALU:=SPACE(20),;
        U_ALU:=SPACE(2),;
        CE_ALU:=SPACE(8),;
        T_ALU:=SPACE(15),;
        NA_ALU:=CTOD(SPACE(8)),;
        CI_N_ALU:=SPACE(20),;
        UF_N_ALU:=SPACE(2),;
        P_ALU:=SPACE(35),;
        P_P_ALU:=SPACE(15),;
        M_ALU:=SPACE(35),;
        P_M_ALU:=SPACE(15),;
        R_ALU:=SPACE(15),;
        R_PAIS:=SPACE(15),;
        CO_ALU:=SPACE(1),;
        CO_INT:=SPACE(1),;
        CO_BOL:=SPACE(1),;
        N_BOL:=SPACE(10),;
        N_RESP:=SPACE(35),;
        E_RESP:=SPACE(35),;
        B_RESP:=SPACE(15),;
        C_RESP:=SPACE(20),;
        U_RESP:=SPACE(2),;
        CE_RESP:=SPACE(8),;
        TE_RESP:=SPACE(15),;
        CP_RESP:=SPACE(11),;
        R_RESP:=SPACE(9),;
        UF_RG_RESP:=SPACE(2)
RETURN


// *******   CRIA TELA DE ENTRADA OU EDICAO DE MATRICULAS **********

FUNCTION APA_TELA
   @       5,05 SAY 'Matr¡cula: '
   @   ROW(),25 SAY 'C¢digo : '
   @   ROW(),19 SAY '/94'
   @   ROW(),45 SAY 'Data : '
   @ ROW()+1,25 SAY 'S‚rie: '
   @   ROW(),35 SAY 'Turma: '
   @   ROW(),45 SAY 'do   Grau '
   @   ROW(),57 SAY 'N. na classe: '
   @ ROW()+1,25 SAY 'Curso :[1]Normal [2]T‚cnico '
   @ ROW()+1,05 SAY 'Aluno(a) : '
   @   ROW(),53 SAY 'Masc/Fem.: '
   @ ROW()+1,05 SAY 'Endere‡o : '
   @ ROW()+1,05 SAY 'Bairro   : '
   @   ROW(),32 SAY 'Cidade    : '
   @   ROW(),66 SAY 'UF :'
   @ ROW()+1,05 SAY 'CEP      : '
   @   ROW(),32 SAY 'Telefone  : '
   @ ROW()+1,05 SAY 'Data Nasc: '
   @   ROW(),32 SAY 'Natural de:'
   @   ROW(),66 SAY 'UF :'
   @ ROW()+1,05 SAY 'Pai      : '
   @   ROW(),52 SAY 'ProfissÆo: '
   @ ROW()+1,05 SAY 'MÆe      : '
   @   ROW(),52 SAY 'ProfissÆo: '
   @ ROW()+1,05 SAY 'ReligiÆo do aluno(a) : '
   @   ROW(),50 SAY 'dos pais : '
   @ ROW()+1,05 SAY 'Condi‡Æo :[1] Particular [2] Bolsista '
   @   ROW(),47 SAY '[I]nterno [E]xterno : '
   @ ROW()+1,47 SAY '[S]EC     [E]SCOLA  : '
   @ ROW()+1,47 SAY 'N. da Aut.SEC: '
   @      19,05 SAY 'Respons vel: '
   @ ROW()+1,05 SAY 'Endere‡o   : '
   @ ROW()+1,05 SAY 'Bairro     : '
   @   ROW(),34 SAY 'Cidade   : '
   @   ROW(),66 SAY 'UF :'
   @ ROW()+1,05 SAY 'CEP        : '
   @   ROW(),34 SAY 'Telefone : '
   @ ROW()+1,05 SAY 'CPF        : '
   @   ROW(),34 SAY 'RG N§    : '
   @   ROW(),66 SAY 'UF :'
RETURN


// ********** TELA COM BANCO DE DADOS DA MATRICULA **********


FUNCTION APA_BCO
   @       5,16 SAY  NUM_MAT
   @       5,33 SAY  COD_ALU   PICT'@R 99999-9'
   @   ROW(),52 SAY  DAT_MAT
   @ ROW()+1,32 SAY  SERIE
   @   ROW(),42 SAY  TURMA
   @   ROW(),48 SAY  GRAU
   @   ROW(),70 SAY  NUCLASSE
   @ ROW()+1,53 SAY  CURSO
   @ ROW()+1,16 SAY  NOM_ALU
   @   row(),63 SAY  SEXO
   @ ROW()+1,16 SAY  END_ALU
   @ ROW()+1,16 SAY  BAI_ALU
   @   ROW(),43 SAY  CID_ALU
   @   ROW(),69 SAY  UF_ALU
   @ ROW()+1,16 SAY  CEP_ALU   PICT'@R 99999-999'
   @   ROW(),43 SAY  TEL_ALUN
   @ ROW()+1,16 SAY  NASC_ALU
   @   ROW(),43 SAY  CID_NAS
   @   ROW(),69 SAY  UF_NAS
   @ ROW()+1,16 SAY  PAI_ALU
   @   ROW(),62 SAY  PROF_PAI
   @ ROW()+1,16 SAY  MAE_ALU
   @   ROW(),62 SAY  PROF_MAE
   @ ROW()+1,28 SAY  RELI_ALU
   @   ROW(),60 SAY  RELI_PAIS
   @ ROW()+1,43 SAY  SIT_ALUN
   @   ROW(),70 SAY  SIT_INTE
   @ ROW()+1,70 SAY  SIT_ECON
   @ ROW()+1,62 SAY  NUM_BOLS
   @      19,17 SAY  NOM_RESP
   @ ROW()+1,17 SAY  END_RESP
   @ ROW()+1,17 SAY  BAI_RESP
   @   ROW(),45 SAY  CID_RESP
   @   ROW(),69 SAY  UF_RESP
   @ ROW()+1,17 SAY  CEP_RESP  PICT'@R 99999-999'
   @   ROW(),45 SAY  TEL_RESP
   @ ROW()+1,17 SAY  CPF_RESP  PICT'@R 999.999.999-99'
   @   ROW(),45 SAY  RG_RESP
   @   ROW(),69 SAY  RG_UF
RETURN



FUNCTION DELMATRI
COT:=SETCOLOR()
QW:=SAVESCREEN(10,20,14,61)
IF A$'CAD_MATRICULA'
   TELA(10,20,12,60)
   CONFIRMA:=' '
   @ 11,22 SAY 'Deseja apagar o aluno '+LEFT(CADA_MAT->NOM_ALU,10)+'?  Y/N '
   INKEY(0)
    IF LASTKEY()=89
       AT_B:=1
       SELE CADA_MAT
       DELETE
       COMMIT
    ENDIF
    SETCOLOR(COT)
    RESTSCREEN(10,20,14,61,QW)
ENDIF
RETURN



FUNCTION CAD_MATERIA
IF !ABREARQ('MATERIAS','MATER','E',3)
   RETURN
ENDIF
SET INDEX TO MATECIND, MATEAIND
NOMTELA('CADASTRO DE MATERIAS')
C_MATE:='   '
N_MATE:=SPACE(40)
A_BREV:=SPACE(4)
SETCOLOR('RB/G,N/G,,,W/G')
TELA(10,10,14,70,10,15,65,,,,'COD.','              MATERIA ','ABREV')
SETCOLOR('RB/G,N/G,,,W/G')
AT_B:=0
A:='CAD_MATERIA'
DO WHILE .T.
   O:=' '
   SET ORDER TO 1
   GO BOTTOM
   CO_D:=C_MATERI
   CO_D:=STRZERO((VAL(LEFT(CO_D,2))+1),2,0)
   C_MATE:=VAL(RIGHT(CO_D,1))
        IF C_MATE=1
           C_MATE:=CO_D+'0'
        ELSEIF C_MATE=2
           C_MATE:=CO_D+'9'
        ELSEIF C_MATE=3
           C_MATE:=CO_D+'8'
        ELSEIF C_MATE=4
           C_MATE:=CO_D+'7'
        ELSEIF C_MATE=5
           C_MATE:=CO_D+'6'
        ELSEIF C_MATE=6
           C_MATE:=CO_D+'5'
        ELSEIF C_MATE=7
           C_MATE:=CO_D+'4'
        ELSEIF C_MATE=8
           C_MATE:=CO_D+'3'
        ELSEIF C_MATE=9
           C_MATE:=CO_D+'2'
        ELSEIF C_MATE=0
           C_MATE:=CO_D+'1'
       ENDIF
   @ 13,11 GET C_MATE PICT'@R 99-9'
   READ
   SEEK C_MATE
   E:=0
   IF FOUND()
      TONE(4321,3)
      N_MATE:=MATERIA
      A_BREV:=ABREVMAT
      E:=1
      NR:=RECNO()
   ENDIF
   @    13,16 GET N_MATE  PICT'@S40!'VALID(VER_2(@E))
   @ ROW(),66 GET A_BREV PICT'@S4!' VALID(VAZIO(A_BREV))
   READ
   @ 14,26 SAY 'CONFIRMA INCLUSÇO ? Y/N [ ] '
   @ 14,51 GET O PICT'@S1!' VALID(O$ 'YN')
  READ
   IF LASTKEY()=27
      EXIT
   ENDIF
   IF O$ 'Y' .AND. .NOT. EMPTY(N_MATE)
      IF E=0
         APPEND BLANK
      ENDIF
      REPL C_MATERI WITH C_MATE ,;
           MATERIA  WITH N_MATE ,;
           ABREVMAT WITH A_BREV
           COMMIT
  ENDIF
  O:=' '
  C_MATE:='   '
  N_MATE:=SPACE(40)
  A_BREV:=SPACE(4)
ENDDO
RETURN





// *************  CADASTRO DE PROFESSOR   *******************



FUNCTION CAD_PROFESSOR
IF !ABREARQ('PROFESSO','PROFESS','E',4)
   RETURN
ENDIF
SET INDEX TO COPROIND, NOPROIND
NOMTELA('CADASTRO DE PROFESSORES')
C_PROF:='   '
N_PROF:=SPACE(40)
AT_B:=0
SETCOLOR('RB/G,N/G,,,W/G')
TELA(10,15,14,65,15,20,65,,,,'COD.','              PROFESSOR ')
SOMBRA(10,15,14,65)
SETCOLOR('RB/G,N/G,,,W/G')
E:=0
DO WHILE .T.
   O:=' '
   SET ORDER TO 1
   GO (LASTREC())
   CO_D:=C_PROFES
   CO_D:=STRZERO((VAL(LEFT(CO_D,2))+1),2,0)
   C_PROF:=VAL(RIGHT(CO_D,1))
        IF C_PROF=1
           C_PROF:=CO_D+'0'
        ELSEIF C_PROF=2
           C_PROF:=CO_D+'9'
        ELSEIF C_PROF=3
           C_PROF:=CO_D+'8'
        ELSEIF C_PROF=4
           C_PROF:=CO_D+'7'
        ELSEIF C_PROF=5
           C_PROF:=CO_D+'6'
        ELSEIF C_PROF=6
           C_PROF:=CO_D+'5'
        ELSEIF C_PROF=7
           C_PROF:=CO_D+'4'
        ELSEIF C_PROF=8
           C_PROF:=CO_D+'3'
        ELSEIF C_PROF=9
           C_PROF:=CO_D+'2'
        ELSEIF C_PROF=0
           C_PROF:=CO_D+'1'
       ENDIF
   @      13,16 GET C_PROF PICT'@R 99-9'
   READ
   SEEK C_PROF
   E:=0
   IF FOUND()
      N_PROF:=PROFESSO
      E:=1
   ENDIF
   @   13,21 GET N_PROF PICT'@S40!' VALID(VER_3(@E))
   READ
   @ 14,26 SAY 'CONFIRMA INCLUSÇO ? Y/N [ ] '
   @ 14,51 GET O PICT'@S1!' VALID(O$ 'YN')
  READ
   IF LASTKEY()=27
      EXIT
   ENDIF
   IF O$ 'Y' .AND. .NOT. EMPTY(N_PROF)
      IF E=0
         APPEND BLANK
      ENDIF
      REPL C_PROFES  WITH   C_PROF       ,;
           PROFESSO  WITH   N_PROF
        COMMIT
        C_PROF:='   '
        N_PROF:=SPACE(40)
  ENDIF
ENDDO
RETURN




// ******** CADASTRO DA GRADE ESCOLAR POR ANO ********


FUNCTION CAD_GRADE
IF !ABREARQ('CADGRADE','GRADE','E',3)
   RETURN
ENDIF
IF !ABREARQ('MATGRADE','MGRADE','T',3)
   RETURN
ENDIF
NOMTELA('CADASTRO DA GRADE ESCOLAR POR SERIE ')
CURSO:=SPACE(25)
CRIACAO:=SPACE(25)
AUTORIZACAO:=SPACE(25)
RECONHECIMENTO:=SPACE(25)
AN:=SPACE(4)
TELA(4,4,7,75)
XY:=E:=0
Q:=1
T:=10
C:=14
SE:=' '
GR:=' '
CO:='   '
SELE GRADE
DO WHILE LASTKEY()#27
   O:=' '
   GO (LASTREC())
   CO:=GRADE->COD_GRAD
   CO_D:=STRZERO((VAL(LEFT(CO,2))+1),2,0)
   CO:=VAL(RIGHT(CO_D,1))
        IF EMPTY(CO)
           CO:='010'
        ELSEIF CO=1
           CO:=CO_D+'0'
        ELSEIF CO=2
           CO:=CO_D+'9'
        ELSEIF CO=3
           CO:=CO_D+'8'
        ELSEIF CO=4
           CO:=CO_D+'7'
        ELSEIF CO=5
           CO:=CO_D+'6'
        ELSEIF CO=6
           CO:=CO_D+'5'
        ELSEIF CO=7
           CO:=CO_D+'4'
        ELSEIF CO=8
           CO:=CO_D+'3'
        ELSEIF CO=9
           CO:=CO_D+'2'
        ELSEIF CO=0
           CO:=CO_D+'1'
     ENDIF
   @  4,60 SAY 'COD/TABELA:'+CO
   @  5,6 SAY 'Curso:' GET CURSO PICT'@S25!'
   @  5,40 SAY 'Cria‡Æo :' GET CRIACAO PICT'@S25!'
   @  6,6 SAY 'Aut. :' GET AUTORIZACAO PICT'@R25!'
   @  6,40 SAY 'Reconh. :' GET RECONHECIMENTO PICT'@R25!'
   @ 8,2 CLEAR TO 10,10
   @  8,2 SAY 'Ano:' GET AN PICT'9999' VALID((VAL(AN)) > 1960)
   @  9,2 SAY 'S‚rie:' GET SE PICT'9' VALID(SE$ '12345678')
   @ 10,2 SAY 'Grau :' GET GR PICT'9' VALID(GR$ '12')
   CRIA_GRADE()
   @ 24,26 SAY 'CONFIRMA INCLUSÇO ? Y/N [ ] '
   @ 24,51 GET O PICT'@S1!' VALID(O$ 'YN')
  READ
   IF LASTKEY()=27
      EXIT
   ENDIF
   IF O$ 'Y' .AND. .NOT. EMPTY(AUTORIZACAO)
     APPEND BLANK
        REPLACE CUR_GRAD WITH CURSO ,;
                CRI_GRAD WITH CRIACAO,;
                AUT_GRAD WITH AUTORIZACAO,;
                REC_GRAD WITH RECONHECIMENTO,;
                ANO_GRAD WITH AN,;
                SER_GRAD WITH SE,;
                GRA_GRAD WITH GR,;
                COD_GRAD WITH CO
         A:=ASCAN(C_MATERIA,'   ')
         A--
          SELE MGRADE
            FOR I=1 TO A
               APPEND BLANK
                  REPLACE GRADECOD WITH CO,;
                          GRADEMAT WITH C_MATERIA[I],;
                          GRADECHS WITH CH_S[I],;
                          GRADECHA WITH CH_A[I]
            NEXT
            SELE GRADE
  ELSE
     LOOP
 ENDIF
ENDDO
RETURN




FUNCTION CRIA_GRADE
TELA(7,13,23,63,13,20,27,,,,'CO.MAT','CH/SEM','CH/ANUAL')
@ 8,38 TO 22,38
@ 9,45 TO 22,45
@ 9,52 TO 22,52
@ 8,39 SAY 'CO.MAT'+CHR(179)+'CH/SEM'+CHR(179)+'CH/ANUAL'
E:=0
Q:=1
T:=10
C:=14
IF XY=0
PUBLIC CH_S[61], CH_A[61], C_MATERIA[61]
        AFILL(C_MATERIA,SPACE(3))
        AFILL(CH_S,SPACE(3))
        AFILL(CH_A,SPACE(4))
ENDIF
DO WHILE  Q<=26
       @  T,C    GET C_MATERIA[Q] PICT'@R 99-9'
       @  T,C+8  GET CH_S[Q] PICT'999'
       @  T,C+15  GET CH_A[Q] PICT'9999'
         IF Q=13
            T:=9
            C:=40
         ELSEIF Q=26
            EXIT
         ENDIF
       Q++
       T++
     ENDDO
  READ
RETURN



// ************ CADASTRO DE HISTORICO ESCOLAR  ***************

FUNCTION CAD_HISTORICO
IF !ABREARQ('MATERIAS','MATER','R',3)
   RETURN
ENDIF
IF !ABREARQ('HISTESC','HISTORICO','E',3)
   RETURN
ENDIF
SET INDEX TO HCODIIND
A:=PROCNAME()
NOMTELA('CADASTRO DE HISTORICO-ESCOLAR')
ATE:=SAVESCREEN(2,2,24,78)
SETCOLOR('RB/G,N/G,,,W/G')
MATR:='   '; ATU:=0
TI_HIS:=SPACE(1)
CURSO:=CRIAC:=AUTOR:=RECON:=ALUNO:=PAIAL:=MAEAL:=SPACE(40)
NATUR:=SPACE(35); NACIO:=SPACE(30); DTNAS:=CTOD(SPACE(8))
PRIVATE AN[8], ES[8], LO[8], UF[8]
AFILL(AN,'0000')
AFILL(ES,SPACE(35))
AFILL(LO,SPACE(35))
AFILL(UF,SPACE(2))
NC1:=PD1:=NO1:=CH1:=NO2:=CH2:=NO3:=CH3:=NO4:=CH4:=NO5:=CH5:=NO6:=CH6:=NO7:=CH7:=NO8:=CH8:=''
PRIVATE NOMAT[33],   CARHO[33], NOTAS1[33], CARHO1[33], NOTAS2[33], CARHO2[33]
PRIVATE NOTAS3[33], CARHO3[33], NOTAS4[33], CARHO4[33], NOTAS5[33]
PRIVATE CARHO5[33], NOTAS6[33], CARHO6[33], NOTAS7[33], CARHO7[33]
PRIVATE NOTAS8[33], CARHO8[33]
AFILL(NOMAT,SPACE(3))
AFILL(CARHO,'0000')
AFILL(NOTAS1,'0000'); AFILL(CARHO1,'0000')
AFILL(NOTAS2,'0000'); AFILL(CARHO2,'0000')
AFILL(NOTAS3,'0000'); AFILL(CARHO3,'0000')
AFILL(NOTAS4,'0000'); AFILL(CARHO4,'0000')
AFILL(NOTAS5,'0000'); AFILL(CARHO5,'0000')
AFILL(NOTAS6,'0000'); AFILL(CARHO6,'0000')
AFILL(NOTAS7,'0000'); AFILL(CARHO7,'0000')
AFILL(NOTAS8,'0000'); AFILL(CARHO8,'0000')
DO WHILE .T.
   TELA(6,10,19,70)
   SELE HISTORICO
   GO (LASTREC())
   CO_D:=HCODHI
   CO_D:=STRZERO((VAL(LEFT(CO_D,3))+1),3,0)
   C_MATE:=VAL(RIGHT(CO_D,1))
   IF C_MATE=1
           CO_D+='0'
        ELSEIF C_MATE=2
           CO_D+='9'
        ELSEIF C_MATE=3
           CO_D+='8'
        ELSEIF C_MATE=4
           CO_D+='7'
        ELSEIF C_MATE=5
           CO_D+='6'
        ELSEIF C_MATE=6
           CO_D+='5'
        ELSEIF C_MATE=7
           CO_D+='4'
        ELSEIF C_MATE=8
           CO_D+='3'
        ELSEIF C_MATE=9
           CO_D+='2'
        ELSEIF C_MATE=0
           CO_D+='1'
    ENDIF
    CODHI:=CO_D
    GO TOP
    @     6,31  SAY '[ Cod.Tabela:          ]'
    @     6,46  GET CODHI PICT'@R 999-9'
    READ
    SEEK CODHI
    E:=0
    IF FOUND()
       E:=1
        TI_HIS:=TIHIS
        CURSO:=HCURSO
        CRIAC:=HCRIAC
        AUTOR:=HAUTOR
        RECON:=HRECON
        ALUNO:=HALUNO
        NATUR:=HNATUR
        NACIO:=HNACIO
        DTNAS:=HDTNAS
        PAIAL:=HPAIAL
        MAEAL:=HMAEAL
        AN[1]:=HAN01
        AN[2]:=HAN02
        AN[3]:=HAN03
        AN[4]:=HAN04
        AN[5]:=HAN05
        AN[6]:=HAN06
        AN[7]:=HAN07
        AN[8]:=HAN08
        ES[1]:=HES01
        ES[2]:=HES02
        ES[3]:=HES03
        ES[4]:=HES04
        ES[5]:=HES05
        ES[6]:=HES06
        ES[7]:=HES07
        ES[8]:=HES08
        LO[1]:=HLO01
        LO[2]:=HLO02
        LO[3]:=HLO03
        LO[4]:=HLO04
        LO[5]:=HLO05
        LO[6]:=HLO06
        LO[7]:=HLO07
        LO[8]:=HLO08
        UF[1]:=HUF01
        UF[2]:=HUF02
        UF[3]:=HUF03
        UF[4]:=HUF04
        UF[5]:=HUF05
        UF[6]:=HUF06
        UF[7]:=HUF07
        UF[8]:=HUF08
        S:=1
        R:=1
        FOR I=1 TO 33
             NOMAT[I]:=SUBSTR(HNC01,S,3)
             CARHO[I]:=SUBSTR(HNC02,S,4)
             NOTAS1[I]:=SUBSTR(HNO01,R,4)
             CARHO1[I]:=SUBSTR(HCH01,R,4)
             NOTAS2[I]:=SUBSTR(HNO02,R,4)
             CARHO2[I]:=SUBSTR(HCH02,R,4)
             NOTAS3[I]:=SUBSTR(HNO03,R,4)
             CARHO3[I]:=SUBSTR(HCH03,R,4)
             NOTAS4[I]:=SUBSTR(HNO04,R,4)
             CARHO4[I]:=SUBSTR(HCH04,R,4)
             NOTAS5[I]:=SUBSTR(HNO05,R,4)
             CARHO5[I]:=SUBSTR(HCH05,R,4)
             NOTAS6[I]:=SUBSTR(HNO06,R,4)
             CARHO6[I]:=SUBSTR(HCH06,R,4)
             NOTAS7[I]:=SUBSTR(HNO07,R,4)
             CARHO7[I]:=SUBSTR(HCH07,R,4)
             NOTAS8[I]:=SUBSTR(HNO08,R,4)
             CARHO8[I]:=SUBSTR(HCH08,R,4)
             S+=3
             R+=4
        NEXT
     ENDIF
     @     7,11  SAY '1§/2§  GRAU:' GET TI_HIS PICT'@S1!' VALID(TI_HIS$ '12')
     @     8,11  SAY 'CURSO      :' GET CURSO PICT'@S40!'
     @     9,11  SAY 'CRIACAO    :' GET CRIAC PICT'@S40!'
     @    10,11  SAY 'AUTORIZACAO:' GET AUTOR  PICT'@S40!'
     @    11,11  SAY 'RECONHEC.  :' GET RECON PICT'@S40!'
     @    12,11  SAY 'ALUNO      :' GET ALUNO  PICT'@S40!'
     @    13,11  SAY 'NATUR-EST. :' GET NATUR  PICT'@S35!'
     @    14,11  SAY 'NACIONAL.  :' GET NACIO PICT'@S30!'
     @    15,11  SAY 'DATA NASC. :' GET DTNAS PICT'@D' VALID(DTNAS<=DATE() .AND. !EMPTY(DTNAS))
     @    16,11  SAY 'PAI        :' GET PAIAL PICT'@S40!'
     @    17,11  SAY 'MAE        :' GET MAEAL PICT'@S40!'
     READ
     RESTSCREEN(2,2,24,78,ATE)
     TELA(4,10,6,70)
     A:=1
     @    4,12 SAY '[ ALUNO : '+ALUNO+' ]' PICT'@S35!'
     @    4,50 SAY '[ Campo n.:       ]'
     TELA(6,10,17,70)
     @ 7,40 TO 17,40
     NOMATE:='000'
     FOR IS:=1 TO 33
             @       4,63 SAY  STR(IS,3)
             IF E=0
                @       5,15 SAY ' Materia :' GET NOMATE  PICT'@R 99-9' VALID(VER_8(@NOMATE,5,31))
             ELSEIF E=1
                       NOMATE:=NOMAT[IS]
                 @      5,15 SAY ' Materia :' GET NOMATE  PICT'@R 99-9' VALID(VER_8(@NOMATE,5,31))
            ENDIF
             @       7,12 SAY ' CH.Curso:' GET CARHO[IS]  PICT'@S4!'
             @ ROW()+1,12 SAY ' Nota 1¦ :' GET NOTAS1[IS] PICT'@S4!'
             @ ROW()+1,12 SAY ' Ch.  1¦ :' GET CARHO1[IS] PICT'@S4!'
             @ ROW()+1,12 SAY ' Nota 2¦ :' GET NOTAS2[IS] PICT'@S4!'
             @ ROW()+1,12 SAY ' Ch   2¦ :' GET CARHO2[IS] PICT'@S4!'
             @ ROW()+1,12 SAY ' Nota 3¦ :' GET NOTAS3[IS] PICT'@S4!'
             @ ROW()+1,12 SAY ' Ch.  3¦ :' GET CARHO3[IS] PICT'@S4!'
             @ ROW()+1,12 SAY ' Nota 4¦ :' GET NOTAS4[IS] PICT'@S4!'
             @ ROW()+1,12 SAY ' Ch.  4¦ :' GET CARHO4[IS] PICT'@S4!'
             @       7,42 SAY ' Nota 5¦ :' GET NOTAS5[IS] PICT'@S4!'
             @ ROW()+1,42 SAY ' Ch.  5¦ :' GET CARHO5[IS] PICT'@S4!'
             @ ROW()+1,42 SAY ' Nota 6¦ :' GET NOTAS6[IS] PICT'@S4!'
             @ ROW()+1,42 SAY ' Ch.  6¦ :' GET CARHO6[IS] PICT'@S4!'
             @ ROW()+1,42 SAY ' Nota 7¦ :' GET NOTAS7[IS] PICT'@S4!'
             @ ROW()+1,42 SAY ' Ch.  7¦ :' GET CARHO7[IS] PICT'@S4!'
             @ ROW()+1,42 SAY ' Nota 8¦ :' GET NOTAS8[IS] PICT'@S4!'
             @ ROW()+1,42 SAY ' Ch.  8¦ :' GET CARHO8[IS] PICT'@S4!'
             READ
             IF LASTKEY()=27
                 A:=2
                 EXIT
             ENDIF
             NOMAT[IS]:=NOMATE
             NOMATE:='000'
     NEXT
     IF A=2
         EXIT
     ENDIF
     FOR I=1 TO 33
           NC1+=LEFT(NOMAT[I],3)
           PD1+=CARHO[I]
           NO1+=NOTAS1[I]
           CH1+=CARHO1[I]
           NO2+=NOTAS2[I]
           CH2+=CARHO2[I]
           NO3+=NOTAS3[I]
           CH3+=CARHO3[I]
           NO4+=NOTAS4[I]
           CH4+=CARHO4[I]
           NO5+=NOTAS5[I]
           CH5+=CARHO5[I]
           NO6+=NOTAS6[I]
           CH6+=CARHO6[I]
           NO7+=NOTAS7[I]
           CH7+=CARHO7[I]
           NO8+=NOTAS8[I]
           CH8+=CARHO8[I]
     NEXT
     NOMTELA('CADASTRO DE HISTORICO-ESCOLAR')
     TELA(6,10,19,70)
     FOR I=1 TO 8
           @   6,25 SAY' [ '+STRZERO(I)+' Serie ]'
           @   8,12 SAY 'Ano             : ' GET AN[I] PICT'9999'
           @  10,12 SAY 'Estabelecimento : ' GET ES[I] PICT'@S35!'
           @  12,12 SAY 'Localidade      : ' GET LO[I] PICT'@S35!'
           @  14,12 SAY 'UF..............: ' GET UF[I] PICT'AA'
           READ
     NEXT
     TELA(20,30,22,50)
     O:=' '
     @ 21,31 SAY 'INCLUIR ? Y/N [ ]'
     @ 21,46 GET O PICT'@S1!' VALID(O$ 'YN ')
     READ
     IF LASTKEY()=27
         EXIT
     ELSEIF O$ 'Y'
     ATU:=1
         SELE HISTORICO
         APPEND BLANK
          REPLACE  HCODHI WITH CODHI ,;
                   TIHIS  WITH TI_HIS ,;
                   HCURSO WITH   CURSO ,;
                   HCRIAC WITH   CRIAC ,;
                   HAUTOR WITH   AUTOR ,;
                   HRECON WITH   RECON ,;
                   HALUNO WITH   ALUNO ,;
                   HNATUR WITH   NATUR ,;
           HNACIO WITH   NACIO ,;
           HDTNAS WITH   DTNAS ,;
           HPAIAL WITH   PAIAL ,;
           HMAEAL WITH   MAEAL ,;
           HNC01  WITH   NC1 ,;
           HNC02  WITH   PD1 ,;
           HNO01  WITH   NO1 ,;
           HCH01  WITH   CH1 ,;
           HNO02  WITH   NO2 ,;
           HCH02  WITH   CH2 ,;
           HNO03  WITH   NO3 ,;
           HCH03  WITH   CH3 ,;
           HNO04  WITH   NO4 ,;
           HCH04  WITH   CH4 ,;
           HNO05  WITH   NO5 ,;
           HCH05  WITH   CH5 ,;
           HNO06  WITH   NO6 ,;
           HCH06  WITH   CH6 ,;
           HNO07  WITH   NO7 ,;
           HCH07  WITH   CH7 ,;
           HNO08  WITH   NO8 ,;
           HCH08  WITH   CH8 ,;
           HAN01  WITH   AN[1],;
           HAN02  WITH   AN[2],;
           HAN03  WITH   AN[3],;
           HAN04  WITH   AN[4],;
           HAN05  WITH   AN[5],;
           HAN06  WITH   AN[6],;
           HAN07  WITH   AN[7],;
           HAN08  WITH   AN[8],;
           HES01  WITH   ES[1],;
           HES02  WITH   ES[2],;
           HES03  WITH   ES[3],;
           HES04  WITH   ES[4],;
           HES05  WITH   ES[5],;
           HES06  WITH   ES[6],;
           HES07  WITH   ES[7],;
           HES08  WITH   ES[8],;
           HLO01  WITH   LO[1],;
           HLO02  WITH   LO[2],;
           HLO03  WITH   LO[3],;
           HLO04  WITH   LO[4],;
           HLO05  WITH   LO[5],;
           HLO06  WITH   LO[6],;
           HLO07  WITH   LO[7],;
           HLO08  WITH   LO[8],;
           HUF01  WITH   UF[1],;
           HUF02  WITH   UF[2],;
           HUF03  WITH   UF[3],;
           HUF04  WITH   UF[4],;
           HUF05  WITH   UF[5],;
           HUF06  WITH   UF[6],;
           HUF07  WITH   UF[7],;
           HUF08  WITH   UF[8]
           COMMIT
           CURSO:=CRIAC:=AUTOR:=RECON:=ALUNO:=PAIAL:=MAEAL:=SPACE(40)
           NATUR:=SPACE(35); NACIO:=SPACE(30); DTNAS:=CTOD(SPACE(8))
           PRIVATE AN[8], ES[8], LO[8], UF[8]
           AFILL(AN,'0000')
           AFILL(ES,SPACE(35))
           AFILL(LO,SPACE(35))
           AFILL(UF,SPACE(2))
           NC1:=PD1:=NO1:=CH1:=NO2:=CH2:=NO3:=CH3:=NO4:=CH4:=NO5:=CH5:=NO6:=CH6:=NO7:=CH7:=NO8:=CH8:=''
           PRIVATE NOMAT[33],   CARHO[33], NOTAS1[33], CARHO1[33], NOTAS2[33], CARHO2[33]
           PRIVATE NOTAS3[33], CARHO3[33], NOTAS4[33], CARHO4[33], NOTAS5[33]
           PRIVATE CARHO5[33], NOTAS6[33], CARHO6[33], NOTAS7[33], CARHO7[33]
           PRIVATE NOTAS8[33], CARHO8[33]
           AFILL(NOMAT,SPACE(3))
           AFILL(CARHO,'0000')
           AFILL(NOTAS1,'0000'); AFILL(CARHO1,'0000')
           AFILL(NOTAS2,'0000'); AFILL(CARHO2,'0000')
           AFILL(NOTAS3,'0000'); AFILL(CARHO3,'0000')
           AFILL(NOTAS4,'0000'); AFILL(CARHO4,'0000')
           AFILL(NOTAS5,'0000'); AFILL(CARHO5,'0000')
           AFILL(NOTAS6,'0000'); AFILL(CARHO6,'0000')
           AFILL(NOTAS7,'0000'); AFILL(CARHO7,'0000')
           AFILL(NOTAS8,'0000'); AFILL(CARHO8,'0000')
     ENDIF
ENDDO
RETURN

// *************  CADASTRO DE ALUNOS QUE ESTAO NO ARQUIVO MORTO   *******************


FUNCTION CAD_MORTO
IF !ABREARQ('CADMORTO','MORTO','E',4)
   RETURN
ENDIF
SET INDEX TO NOMORIND
NOMTELA('* CADASTRO DO ARQUIVO MORTO *')
A:='CAD_MORTO'
SETCOLOR('RB/G,N/G,,,W/G')
TELA(7,15,13,65)
SETCOLOR('RB/G,N/G,,,W/G')
MOR_NO:=SPACE(35)
MOR_AN:=SPACE(4)
MOR_CA:=SPACE(3)
MOR_PA:=SPACE(2)
AT:=0
DO WHILE .T. .AND. LASTKEY()#27
   O:=' '
   @ 7,40 SAY '[ Tot.Cad.:'+ALLTRIM(STR(LASTREC(),5))+' ]'
   @      8,17 SAY 'Nome : ' GET MOR_NO  PICT'@S35!' VALID(VAZIO(MOR_NO))
   @ ROW()+1,17 SAY 'Ano  : ' GET MOR_AN PICT'9999'
   @ ROW()+1,17 SAY 'Caixa: ' GET MOR_CA PICT'999'
   @ ROW()+1,17 SAY 'Pasta: ' GET MOR_PA PICT'99'
   READ
   IF LASTKEY()=27
       EXIT
   ENDIF
   SET SOFTSEEK ON
   SEEK MOR_NO
   SET SOFTSEEK OFF
   IF FOUND()
      TONE(9000,2)
      TONE(1000,1)
      TONE(10000,2)
      LOOP
   ENDIF
   @ 13,26 SAY 'CONFIRMA INCLUSÇO ? Y/N [ ] '
   @ 13,51 GET O PICT'@S1!' VALID(O$ 'YNC ')
  READ
   IF LASTKEY()=27
      EXIT
   ENDIF
   IF O$ 'Y'
       APPEND BLANK
       REPL NOME  WITH  MOR_NO,;
            ANO   WITH  MOR_AN ,;
            CAIXA WITH  MOR_CA ,;
            PASTA WITH  MOR_PA
            COMMIT
            MOR_NO:=SPACE(35)
            MOR_AN:=SPACE(4)
            MOR_CA:=SPACE(3)
            MOR_PA:=SPACE(2)
    ELSEIF O$'C'
      COT:=SETCOLOR()
      QW:=SAVESCREEN(10,20,14,61)
      BROWSE(4,5,23,75)
      COMMIT
      SETCOLOR(COT)
      RESTSCREEN(10,20,14,61,QW)
  ENDIF
ENDDO
RETURN

             



FUNCTION MENSAGEM()
IF !ABREARQ('CADMSGEM','CADMSG','E',3)
      RETURN
ENDIF
SELE CADMSG
SET INDEX TO MSGIND, NOMSGIND
NOMTELA('CADASTRO DE MENSAGEM PADRAO')
SETCOLOR('RB/G,N/G,,,W/G')
TELA(10,15,14,65,15,20,65,,,,'COD.','              MENSAGEM ')
SOMBRA(10,15,14,65)
SETCOLOR('RB/G,N/G,,,W/G')
E:=0
AT:=0
O:=' '
COD_M:='0000'
COD_2:=SPACE(120)
DO WHILE .T.
   @       13,16 GET COD_M PICT'@R 9999' VALID(VAZIO(COD_M))
   READ
   GO TOP
   IF LOCATE FOR CODMSG$COD_M
      COD_2:=MSGPAD
      E:=1
   ENDIF
   @   ROW(),21 GET COD_2 PICT'@S40!' VALID(VAZIO(COD_2))
   READ
   @ 14,26 SAY 'CONFIRMA INCLUSÇO ? Y/N [ ] '
   @ 14,51 GET O PICT'@S1!' VALID(O$ 'YN')
  READ
   IF LASTKEY()=27
      EXIT
   ENDIF
   IF O$ 'Y' .AND. .NOT. EMPTY(COD_2)
      IF E=0
         APPEND BLANK
      ENDIF
      REPL CODMSG WITH COD_M,;
           MSGPAD WITH COD_2
           COMMIT
        O:=' '
        COD_1:='    '
        COD_2:=SPACE(120)
   ELSE 
      O:=' '
          LOOP
  ENDIF
ENDDO
RETURN

// ********  LANCAMENTO DE NOTAS *****************


FUNCTION LANC_SECRETARIA
NOMTELA('LAN€AMENTO DE NOTAS BIMESTRAIS DO ALUNO')
TE200:=SAVESCREEN(5,10,20,70)
A:=PROCNAME()
IF !SENH()
    RETURN
ENDIF
RESTSCREEN(5,10,20,70,TE200)
IF !ABREARQ('MATERIAS','MATER','R',3)
   RETURN
ENDIF
IF !ABREARQ('PROFESSO','PROFESS','R',3)
   RETURN
ENDIF
IF !ABREARQ('CADMATRI','CADA_MAT','R',3)
   RETURN
ENDIF
SET INDEX TO GSMATIND
IF !ABREARQ('CADNOTAS','NOTA','E',3)
   RETURN
ENDIF
SET INDEX TO CMNOTIND
SET ORDER TO 2
SETCOLOR(GCOR2)
SET DECIMAL TO 2
DO WHILE .T. .OR. LASTKEY()#27
   @ 3,3 CLEAR TO 3,77
   O:=' ';TP_LC:=' '; GR:=' '; SE:=' '; C_MATE:='000'; C_PROF:='000'; RE:=' '
   BI:=' '; TU:=' '; ARMCOD:={}; NALU:={}
   @ 3,01         SAY ' Grau:'        GET GR     PICT'@9' VALID(GR$ '12')
   @ ROW(),COL()+1 SAY 'Serie:'       GET SE     PICT'@9' VALID(SE$ '12345678')
   @ ROW(),COL()+1 SAY 'Turma:'       GET TU     PICT'@S1!' VALID(TU$ 'ABEU')
   @ ROW(),COL()+1 SAY 'Disciplina.:' GET C_MATE PICT'@R 99-9' VALID(VER_8(@C_MATE))
   @ ROW(),COL()+1 SAY 'Prof.:'       GET C_PROF PICT'@R 99-9' VALID(VER_9(@C_PROF))
   @ ROW(),COL()+1 SAY 'Bim.:'        GET BI     PICT'@S1!' VALID(BI$ '1234RM')
   @ ROW(),COL()+1 SAY 'Rec.:'        GET RE     PICT'@S1!' VALID(RE$ 'R ')
   @ ROW(),COL() SAY '       '
   READ
   IF LASTKEY()=27
        EXIT
   ENDIF
   SELE CADA_MAT
   GO TOP
   SEEK (GR+SE+TU)
   DO WHILE GRAU$GR .AND. SERIE$SE .AND. TURMA$TU
           AADD(ARMCOD,COD_ALU)
           AADD(NALU,NUCLASSE)
           SKIP
   ENDDO
   CT:=LEN(ARMCOD)
   PRIVATE NOTALU[(LEN(ARMCOD))], FALALU[(LEN(ARMCOD))]
   AFILL(NOTALU,00.00)
   AFILL(FALALU,0)
   SELE NOTA
   GO TOP
   CO13:=1
   AX:=0
   FOR I=1 TO CT
       LOCATE FOR NOTA->MAT_NOT$C_MATE .AND. NOTA->COD_ALU$ARMCOD[I]
       IF FOUND()
          AX:=1
          EXIT
       ENDIF
       GO TOP
   NEXT
   IF AX=1
          TONE(400,0.3)
          TONE(2400,1)
          TONE(1100,0.6)
   ENDIF
   SELE CADA_MAT
   IF AX=1
        SELE NOTA
        GO TOP
        FOR I=1 TO CT
           SEEK (ARMCOD[I]+C_MATE)
           IF FOUND()
             IF BI$'1' .AND. EMPTY(RE)
                 NOTALU[I]:=NOTA->NB1
                 FALALU[I]:=NOTA->FN1
             ELSEIF BI$'2' .AND. EMPTY(RE)
                 NOTALU[I]:=NOTA->NB2
                 FALALU[I]:=NOTA->FN2
             ELSEIF BI$'3' .AND. EMPTY(RE)
                 NOTALU[I]:=NOTA->NB3
                 FALALU[I]:=NOTA->FN3
             ELSEIF BI$'4' .AND. EMPTY(RE)
                 NOTALU[I]:=NOTA->NB4
                 FALALU[I]:=NOTA->FN4
             ELSEIF BI$'M' .AND. EMPTY(RE)
                 NOTALU[I]:=NOTA->RFN
                 FALALU[I]:=NOTA->RFF
             ELSEIF BI$'1' .AND. RE='R'
                 NOTALU[I]:=NOTA->NR1
                 FALALU[I]:=NOTA->FR1
             ELSEIF BI$'2' .AND. RE='R'
                 NOTALU[I]:=NOTA->NR2
                 FALALU[I]:=NOTA->FR2
             ELSEIF BI$'3' .AND. RE='R'
                 NOTALU[I]:=NOTA->NR3
                 FALALU[I]:=NOTA->FR3
             ELSEIF BI$'4' .AND. RE='R'
                 NOTALU[I]:=NOTA->NR4
                 FALALU[I]:=NOTA->FR4
             ELSEIF BI$'R' .AND. RE='R'
                 NOTALU[I]:=NOTA->NRF
                 FALALU[I]:=NOTA->FRF
              ENDIF
           ELSE
               NOTALU[I]:=00.00
               FALALU[I]:=00
           ENDIF
           GO TOP
        NEXT
    ENDIF
  DO WHILE .T.
     GO TOP
     SETCOLOR('N/B')
     T6:=SAVESCREEN(5,10,23,70)
     IF CT<=15 .AND. CT>0
        TELA(5,33,23,47,33,36,43,47,,,'N§',' Nota',' F')
        C:=34
     ELSEIF CT>15 .AND. CT<31
        TELA(5,24,23,37,24,27,34,37,,,'N§',' Nota',' F')
        TELA(5,38,23,53,39,42,49,53,,,'N§',' Nota',' F')
        C:=25
     ELSEIF CT>30 .AND. CT<46
        TELA(5,10,23,24,10,13,20,24,,,'N§',' Nota',' F')
        TELA(5,25,23,39,25,28,35,39,,,'N§',' Nota',' F')
        TELA(5,40,23,54,40,43,50,54,,,'N§',' Nota',' F')
        C:=11
     ELSEIF CT>45
        TELA(5,10,23,24,10,13,20,24,,,'N§',' Nota',' F')
        TELA(5,25,23,39,25,28,35,39,,,'N§',' Nota',' F')
        TELA(5,40,23,54,40,43,50,54,,,'N§',' Nota',' F')
        TELA(5,55,23,69,55,57,64,69,,,'N§',' Nota',' F')
        C:=11
     ENDIF
     SETCOLOR(GCOR2)
     Q:=1
     T:=8
     FOR Q:=1 TO CT
        @  T,C    SAY NALU[Q] PICT'99'
        @  T,C+3  GET NOTALU[Q] PICT'99.99'
        @  T,C+10 GET FALALU[Q] PICT'99'
         IF Q=15
            T:=7
            C+=15
         ELSEIF Q=30
            T:=7
            C+=15
         ELSEIF Q=45
            T:=7
            C+=15
         ELSEIF Q=60
            EXIT
         ENDIF
       T++
     NEXT
  READ
  C0:=ASCAN(NOTALU,00.00)
  ST:=SAVESCREEN(20,10,22,70)
  IF C0#0
     SET CURSOR OFF
     TONE(5000,2)
     TONE(2000,1)
     TONE(3000,3)
     TELA(20,10,22,70,10,,,,,,'Existe nota zerada - Tecle C p/ confirmar!!!')
     INKEY(0)
     SET CURSOR ON
  ENDIF
  IF CHR(LASTKEY())$'C' .AND. C0=0
     RESTSCREEN(20,10,22,70,ST)
     LOOP
  ENDIF
  RESTSCREEN(20,10,22,70,ST)
  EXIT
ENDDO
  @ 24,26 SAY 'CONFIRMA INCLUSÇO ? Y/N [ ] '
  @ 24,51 GET O PICT'@S1!' VALID(O$ 'YN')
  READ
  IF LASTKEY()=27
      EXIT
  ENDIF
  IF O$'Y'
      SELE NOTA
      FOR I=1 TO CT
          IF AX=0
             APPEND BLANK
          ELSEIF AX=1
              SELE NOTA
              GO TOP
              SEEK (ARMCOD[I]+C_MATE)
              IF .NOT. FOUND()
                  APPEND BLANK
              ENDIF
          ENDIF
          REPLACE NOTA->COD_ALU WITH ARMCOD[I] ,;
                  MAT_NOT WITH C_MATE,;
                  PRO_NOT WITH C_PROF
                  IF BI$'1' .AND. EMPTY(RE)
                     REPLACE NB1 WITH NOTALU[I],;
                             FN1 WITH FALALU[I]
                  ELSEIF BI$'2' .AND. EMPTY(RE)
                     REPLACE NB2 WITH NOTALU[I],;
                             FN2 WITH FALALU[I]
                  ELSEIF BI$'3' .AND. EMPTY(RE)
                     REPLACE NB3 WITH NOTALU[I],;
                             FN3 WITH FALALU[I]
                  ELSEIF BI$'4' .AND. EMPTY(RE)
                     REPLACE NB4 WITH NOTALU[I],;
                             FN4 WITH FALALU[I]
                  ELSEIF BI$'M' .AND. EMPTY(RE)
                     REPLACE RFN WITH NOTALU[I],;
                             RFF WITH FALALU[I]
                  ELSEIF BI$'1' .AND. RE='R'
                     REPLACE NR1 WITH NOTALU[I],;
                             FR1 WITH FALALU[I]
                  ELSEIF BI$'2' .AND. RE='R'
                     REPLACE NR2 WITH NOTALU[I],;
                             FR2 WITH FALALU[I]
                  ELSEIF BI$'3' .AND. RE='R'
                     REPLACE NR3 WITH NOTALU[I],;
                             FR3 WITH FALALU[I]
                  ELSEIF BI$'4' .AND. RE='R'
                     REPLACE NR4 WITH NOTALU[I],;
                             FR4 WITH FALALU[I]
                  ELSEIF BI$'R' .AND. RE='R'
                     REPLACE NRF WITH NOTALU[I],;
                             FRF WITH FALALU[I]
                  ENDIF
                  ATU:=1
       NEXT
      COMMIT
  ELSE
     RESTSCREEN(5,10,23,70,T6)
     LOOP
  ENDIF
 O:=SPACE(1)
 AX:=0
 RESTSCREEN(5,10,23,70,T6)
ENDDO
RETURN




FUNCTION FEC_NOTAS()
TE200:=SAVESCREEN(5,10,20,70)
GCO:=SETCOLOR()
A:=PROCNAME()
IF !SENH()
    RETURN
ENDIF
RESTSCREEN(5,10,20,70,TE200)
IF !ABREARQ('MATERIAS','MATER','R',3)
   RETURN
ENDIF
IF !ABREARQ('PROFESSO','PROFESS','R',3)
   RETURN
ENDIF
IF !ABREARQ('CADMATRI','CADA_MAT','R',3)
   RETURN
ENDIF
SET INDEX TO GSMATIND
IF !ABREARQ('CADNOTAS','NOTA','E',3)
   RETURN
ENDIF
SET INDEX TO CMNOTIND
SET ORDER TO 2
SETCOLOR(GCOR2)
SET DECIMAL TO 2
PE:=SPACE(1)
TELA(10,25,12,55)
@ 11,26 SAY 'Por: 1=Serie  9=Geral ->' GET PE PICT'9' VALID(PE$ '19 ')
READ
IF EMPTY(PE) .OR. LASTKEY()=27
   RETURN
 ELSEIF PE$'9'
   NOMTELA('FECHAMENTO DE MEDIA ANUAL')
   SELE NOTA
   GO TOP
     IF RFN#0
       TONE(400,0.3)
       TONE(2400,1)
       TONE(1100,0.6)
       O:=' '
       tela(10,10,12,70)
       @ 11,11 SAY 'Ja existe fechamento - CONFIRMA FECHAMENTO ? Y/N [ ] '
       @ 11,68 GET O PICT'@S1!' VALID(O$ 'YN')
       READ
       IF LASTKEY()=27 .AND. O$'N'
          RETURN
       ENDIF
       O:=' '
     ENDIF
     TELA(10,10,17,70)
     SET CURSOR OFF
     @ 11,26 SAY '   Aguarde alguns segundos !    '
     @ 12,26 SAY '  Fechamento sendo realizado.   '
     @ 13,26 SAY '  Em caso de queda de energia   '
     @ 14,26 SAY '  ou problema similar ...       '
     @ 15,26 SAY '    REFAZER A OPERACAO          '
     DO WHILE .NOT. EOF()
         SETCOLOR('W+*/BG')
         @ 16,26 SAY ' Fechando aluno codigo->'+TRANSFORM(NOTA->COD_ALU, '@R 99999-9')
         MF:=0
         FF:=0
         IF NRF=0
           IF NR1#0
              MF+=NR1
           ELSE
              MF+=NB1
           ENDIF
           IF NR2#0
              MF+=NR2
           ELSE
              MF+=NB2
           ENDIF
           IF NR3#0
              MF+=NR3
           ELSE
              MF+=NB3
           ENDIF
           IF NR4#0
              MF+=NR4
           ELSE
              MF+=NB4
           ENDIF
           FF+=(FN1+FN2+FN3+FN4+FR1+FR2+FR3+FR4)
           SET DECIMAL TO 2
           IF MF<=5.5
              MFC:=1
           ELSEIF MF=6
              MFC:=1.5
           ELSEIF MF>=6.5 .AND. MF<=9.5
              MFC:=2
           ELSEIF MF=10
              MFC:=2.5
           ELSEIF MF>=10.5 .AND. MF<=13.5
              MFC:=3
           ELSEIF MF=14
              MFC:=3.5
           ELSEIF MF>=14.5 .AND. MF<=17.5
              MFC:=4
           ELSEIF MF=18
              MFC:=4.5
           ELSEIF MF>=18.5 .AND. MF<=21.5
              MFC:=5
           ELSEIF MF=22
              MFC:=5.5
           ELSEIF MF>=22.5 .AND. MF<=25.5
              MFC:=6
           ELSEIF MF=26
              MFC:=6.5
           ELSEIF MF>=26.5 .AND. MF<=29.5
              MFC:=7
           ELSEIF MF=30
              MFC:=7.5
           ELSEIF MF>=30.5 .AND. MF<=33.5
              MFC:=8
           ELSEIF MF=34
              MFC:=8.5
           ELSEIF MF>=34.5 .AND. MF<=37.5
              MFC:=9
           ELSEIF MF=38
              MFC:=9.5
           ELSEIF MF>=38.5 .AND. MF<=40
              MFC:=10
           ENDIF
             REPLACE RFN WITH MFC,;
                     RFF WITH FF
          ELSE
             REPLACE RFN WITH NRF,;
                     RFF WITH FRF
         ENDIF
        SKIP
     ENDDO
   ELSEIF PE$'1'
   NOMTELA('FECHAMENTO POR SERIE/MATERIA')
      TELA(12,20,15,60)
      O:=' ';TP_LC:=' '; GR:=' '; SE:=' '; C_MATE:='000'; C_PROF:='000'; RE:=' '
      BI:=' '; TU:=' '; ARMCOD:={}; NALU:={}
      @ 13,26         SAY ' Grau:'        GET GR     PICT'@9' VALID(GR$ '12')
      @ ROW(),COL()+1 SAY 'Serie:'       GET SE     PICT'@9' VALID(SE$ '12345678')
      @ ROW(),COL()+1 SAY 'Turma:'       GET TU     PICT'@S1!' VALID(TU$ 'ABEU')
      READ
      IF LASTKEY()=27
          RETURN
      ENDIF
      SELE CADA_MAT
      GO TOP
      SEEK (GR+SE+TU)
      DO WHILE GRAU$GR .AND. SERIE$SE .AND. TURMA$TU
           AADD(ARMCOD,COD_ALU)
           AADD(NALU,NUCLASSE)
           SKIP
      ENDDO
      CT:=LEN(ARMCOD)
      SELE NOTA
      GO TOP
      CO13:=1
     @ 14,26 SAY 'CONFIRMA FECHAMENTO ? Y/N [ ] '
     @ 14,53 GET O PICT'@S1!' VALID(O$ 'YN')
     READ
     IF LASTKEY()=27
        RETURN
     ENDIF
     IF O$'Y'
        TELA(10,10,17,70)
        SET CURSOR OFF
        @ 11,26 SAY '   Aguarde alguns segundos !    '
        @ 12,26 SAY '  Fechamento sendo realizado.   '
        @ 13,26 SAY '  Em caso de queda de energia   '
        @ 14,26 SAY '  ou problema similar ...       '
        @ 15,26 SAY '    REFAZER A OPERACAO          '
        SELE NOTA
           FOR I=1 TO CT
            GO TOP
            SEEK (ARMCOD[I])
            IF .NOT. FOUND()
               TONE(4000,8)
            ENDIF
            DO WHILE NOTA->COD_ALU$(ARMCOD[I])
               SETCOLOR('W+*/BG')
               @ 16,26 SAY ' Fechando aluno codigo->'+TRANSFORM(NOTA->COD_ALU, '@R 99999-9')
               MF:=0
               FF:=0
               IF NRF=0
              FF+=(FN1+FN2+FN3+FN4+FR1+FR2+FR3+FR4)
                 IF NR1#0
                   MF+=NR1
                 ELSE
                   MF+=NB1
                 ENDIF
                 IF NR2#0
                    MF+=NR2
                 ELSE
                    MF+=NB2
                 ENDIF
                 IF NR3#0
                    MF+=NR3
                 ELSE
                    MF+=NB3
                 ENDIF
                 IF NR4#0
                    MF+=NR4
                 ELSE
                    MF+=NB4
                 ENDIF
                 SET DECIMAL TO 2
                 IF MF<=5.5
                    MFC:=1
                 ELSEIF MF=6
                    MFC:=1.5
                 ELSEIF MF>=6.5 .AND. MF<=9.5
                    MFC:=2
                 ELSEIF MF=10
                    MFC:=2.5
                 ELSEIF MF>=10.5 .AND. MF<=13.5
                    MFC:=3
                 ELSEIF MF=14
                    MFC:=3.5
                 ELSEIF MF>=14.5 .AND. MF<=17.5
                    MFC:=4
                 ELSEIF MF=18
                    MFC:=4.5
                 ELSEIF MF>=18.5 .AND. MF<=21.5
                    MFC:=5
                 ELSEIF MF=22
                    MFC:=5.5
                 ELSEIF MF>=22.5 .AND. MF<=25.5
                    MFC:=6
                 ELSEIF MF=26
                    MFC:=6.5
                 ELSEIF MF>=26.5 .AND. MF<=29.5
                    MFC:=7
                 ELSEIF MF=30
                    MFC:=7.5
                 ELSEIF MF>=30.5 .AND. MF<=33.5
                    MFC:=8
                 ELSEIF MF=34
                    MFC:=8.5
                 ELSEIF MF>=34.5 .AND. MF<=37.5
                    MFC:=9
                 ELSEIF MF=38
                    MFC:=9.5
                 ELSEIF MF>=38.5 .AND. MF<=40
                    MFC:=10
                 ENDIF
                 REPLACE RFN WITH MFC,;
                         RFF WITH FF
                  ELSE
                  REPLACE RFN WITH NRF,;
                        RFF WITH FRF
              ENDIF
              SKIP
           ENDDO
        NEXT
   ENDIF
ENDIF
SELE NOTA
COMMIT
SET CURSOR ON
RESTSCREEN(5,10,20,70,TE200)
SETCOLOR(GCO)
RETURN


// ******** CONSULTA CADASTRO DE MATRICULAS **************


FUNCTION CON_MATRICULA
IF !ABREARQ('CADMATRI','CADA_MAT','R',3)
   RETURN
ENDIF
IF O4=7
   SET INDEX TO GSMATIND
   NOMTELA('CONSULTA AO ALUNO - GRAU/SERIE/TURMA/NUMERO - tecle enter para ampliar')
ELSE
  SET INDEX TO NOMATIND
   NOMTELA('CONSULTA AO ALUNO - MATRICULA E CODIGO - tecle enter para ampliar')
ENDIF
GO TOP
SETCOLOR('RB/G')
TELA(4,10,21,70)
@ 4,50 SAY '[ Tot.Cad.:'+ALLTRIM(STR(LASTREC(),5,0))+' ]'
    FOR I=5 TO 18
        @ I,70 SAY CHR(177)
    NEXT
    @ 19,70 SAY CHR(25)
    PRIVATE X:={}
    DO WHILE .NOT. EOF()
           IF O4=7
             YX:=GRAU+' ³ '+SERIE+' ³ '+TURMA+' ³ '+NUCLASSE+' ³ '+LEFT(NOM_ALU,25)+' | '+(TRANSFORM(COD_ALU,'@R 99999-9'))+(IF(DELETED(),'$$$',''))
           ELSE
             YX:=LEFT(NOM_ALU,25)+' | '+NUM_MAT+'/94'+' | '+(TRANSFORM(COD_ALU,'@R 99999-9'))+(IF(DELETED(),'$$$',''))
           ENDIF
        AADD(X,YX)
        SKIP
    ENDDO
    SETCOLOR(GCOR1)
    DO WHILE .T. .OR. LASTKEY()#27
        V:=SAVESCREEN(4,10,21,70)
        OP1:=ACHOICE(5,11,20,69,X,,'Fop',,)
        RESTSCREEN(4,10,21,70,V)
        IF OP1=0
           EXIT
         ELSEIF OP1#0 .AND. LASTKEY()=13
           IF O4=7
              TAMA:=GRAU+SERIE+TURMA+NUCLASSE+NOM_ALU+COD_ALU
           ELSE
              TAMA:=LEFT(X[OP1],25)
           ENDIF
           GO TOP
           SET SOFTSEEK ON
           SEEK TAMA
           SET SOFTSEEK OFF
           TW:=SAVESCREEN(4,2,24,77)
           NOMTELA('CONSULTA AO CADASTRO DE MATRICULA')
           SETCOLOR('GR/G,N/BG,,,W/G')
           TELA(4,02,24,77)
           APA_TELA()
           DO WHILE .T.
              SETCOLOR('W/G,N/BG,,,W/G')
              @       5,16 SAY  NUM_MAT
              @       5,33 SAY  COD_ALU   PICT'@R 99999-9'
              @   ROW(),52 SAY  DAT_MAT
              @ ROW()+1,32 SAY  SERIE
              @   ROW(),42 SAY  TURMA
              @   ROW(),48 SAY  GRAU
              @   ROW(),70 SAY  NUCLASSE
              @ ROW()+1,53 SAY  CURSO
              @ ROW()+1,16 SAY  NOM_ALU
              @   row(),63 SAY  SEXO
              @ ROW()+1,16 SAY  END_ALU
              @ ROW()+1,16 SAY  BAI_ALU
              @   ROW(),43 SAY  CID_ALU
              @   ROW(),69 SAY  UF_ALU
              @ ROW()+1,16 SAY  CEP_ALU   PICT'@R 99999-999'
              @   ROW(),43 SAY  TEL_ALUN
              @ ROW()+1,16 SAY  NASC_ALU
              @   ROW(),43 SAY  CID_NAS
              @   ROW(),69 SAY  UF_NAS
              @ ROW()+1,16 SAY  PAI_ALU
              @   ROW(),62 SAY  PROF_PAI
              @ ROW()+1,16 SAY  MAE_ALU
              @   ROW(),62 SAY  PROF_MAE
              @ ROW()+1,28 SAY  RELI_ALU
              @   ROW(),60 SAY  RELI_PAIS
              @ ROW()+1,43 SAY  SIT_ALUN
              @   ROW(),70 SAY  SIT_INTE
              @ ROW()+1,70 SAY  SIT_ECON
              @ ROW()+1,62 SAY  NUM_BOLS
              @      19,17 SAY  NOM_RESP
              @ ROW()+1,17 SAY  END_RESP
              @ ROW()+1,17 SAY  BAI_RESP
              @   ROW(),45 SAY  CID_RESP
              @   ROW(),69 SAY  UF_RESP
              @ ROW()+1,17 SAY  CEP_RESP  PICT'@R 99999-999'
              @   ROW(),45 SAY  TEL_RESP
              @ ROW()+1,17 SAY  CPF_RESP  PICT'@R 999.999.999-99'
              @   ROW(),45 SAY  RG_RESP
              @   ROW(),69 SAY  RG_UF
              SETCOLOR(GCOR1)
              E:=INKEY(0)
              IF E=27
                 EXIT
              ELSEIF E=5 .AND. BOF()#.T.
                 SKIP -1
              ELSEIF E=24 .AND. EOF()#.T.
                SKIP
              ENDIF
              IF EOF()
                 TONE(145,6)
                 TONE(270,2)
                 EXIT
              ENDIF
           ENDDO
           RESTSCREEN(4,2,24,77,TW)
        ENDIF
   ENDDO
   SETCOLOR(GCOR1)
SET INDEX TO COMATIND
RETURN



FUNCTION CON_MATERIA
IF !ABREARQ('MATERIAS','MATER','R',3)
       RETURN
ENDIF
SET INDEX TO MATEAIND
SET ORDER TO 2
GO TOP
NOMTELA('CONSULTA CODIGO/NOME MATERIAS - ORDEM ALFABETICA')
TELA(04,20,23,60)
@ 4,40 SAY '[ Tot.Cad.:'+ALLTRIM(STR(LASTREC(),3,0))+' ]'
FOR I=5 TO 21
     @ I,60 SAY CHR(177)
NEXT
@ 22,60 SAY CHR(25)
PRIVATE  X:={}
DO WHILE .NOT. EOF()
       YX:=LEFT(MATER->MATERIA,25)+' | '+MATER->C_MATERI
       AADD(X,YX)
       SKIP
ENDDO
TAMA:=LEN(X)
SETCOLOR('B/BG,N/G,,,B/W')
DO WHILE .T. .OR. LASTKEY()#27
        V:=SAVESCREEN(4,20,23,60)
        OP:=ACHOICE(5,21,22,59,X,,'Fop',,)
        RESTSCREEN(4,20,23,60,V)
        IF OP=0
           EXIT
       ENDIF
ENDDO
SETCOLOR(GCOR1)
RETURN


FUNCTION CON_PROFESSOR
IF !ABREARQ('PROFESSO','PROFESS','R',3)
       RETURN
ENDIF
SET INDEX TO NOPROIND
GO TOP
NOMTELA('CONSULTA CODIGO/NOME PROFESSOR - ORDEM ALFABETICA')
TELA(04,20,23,60)
@ 4,40 SAY '[ Tot.Cad.:'+ALLTRIM(STR(LASTREC(),5,0))+' ]'
FOR I=5 TO 21
        @ I,60 SAY CHR(177)
NEXT
@ 22,60 SAY CHR(25)
PRIVATE X:={}
DO WHILE .NOT. EOF()
       YX:=LEFT(PROFESSO,25)+' | '+C_PROFES
       AADD(X,YX)
       SKIP
ENDDO
TAMA:=LEN(X)
SETCOLOR('B/BG,N/G,,,B/W')
DO WHILE .T. .OR. LASTKEY()#27
        V:=SAVESCREEN(4,20,23,60)
        OP:=ACHOICE(5,21,22,59,X,,'Fop',,)
        RESTSCREEN(4,20,23,60,V)
        IF OP=0
           EXIT
       ENDIF
ENDDO
SETCOLOR(GCOR1)
RETURN




FUNCTION CON_GRADE
CO:=SPACE(3)
IF !ABREARQ('CADGRADE','GRA1','R',3)
       RETURN
ENDIF
IF !ABREARQ('MATGRADE','MGRADE','R',3)
       RETURN
ENDIF
SELE GRA1
NOMTELA('CONSULTA AO CADASTRO DA GRADE ESCOLAR POR SERIE ')
DO WHILE LASTKEY()#27
   @  4,60 SAY 'COD/TABELA:' GET CO PICT'@R 99-9'
   READ
   @  5,6 SAY 'Curso:'+CUR_GRAD PICT'@S25!'
   @  5,40 SAY 'Cria‡Æo :'+CRI_GRAD PICT'@S25!'
   @  6,6 SAY 'Aut. :'+AUT_GRAD PICT'@S25!'
   @  6,40 SAY 'Reconh. :'+REC_GRAD PICT'@S25!'
   @ 8,2 CLEAR TO 10,10
   @  8,2 SAY 'Ano:'+ANO_GRAD PICT'9999'
   @  9,2 SAY 'S‚rie:'+SER_GRAD PICT'9'
   @ 10,2 SAY 'Grau :'+GRA_GRAD PICT'9'
   SELE MGRADE
          DO WHILE CO=GRADECOD
                 ?  GRADECOD+' '+GRADEMAT+' '+GRADECHS+' '+GRADECHA
                 SKIP
          ENDDO
            SELE GRA1
 ENDDO
RETURN



// *******************  CONSULTA ARQUIVO MORTO - POR NOME COLOCALIZA-SE A CAIXA E PASTA *****



FUNCTION CON_MORTO
NOMTELA(' CONSULTA ARQUIVO MORTO ')
SETCOLOR('RB/G,N/G,,,W/G')
TELA(6,10,22,70)
@ 6,40 SAY '[ Tot.Cad.:'+ALLTRIM(STR(LASTREC(),5,0))+' ]'
SETCOLOR('RB/G,N/G,,,W/G')
IF !ABREARQ('CADMORTO','MORTO','R',3)
       RETURN
ENDIF
SET INDEX TO NOMORIND
GO TOP
@ 8,48 SAY '[ CONSULTA COD.ALUNO ]'
PRIVATE SAM[4], SAM1[4], SAM2[4], SAM3[4]
SAM[1]:='NOME'
SAM[2]:='ANO'
SAM[3]:='CAIXA'
SAM[4]:='PASTA'
SAM1[1]:='!'
SAM1[2]:='9999'
SAM1[3]:='9999'
SAM1[4]:='9999'
SAM2[1]:='Nome'
SAM2[2]:='Ano '
SAM2[3]:='Cx.'
SAM2[4]:='Pasta'
SAM3[1]:=35
SAM3[2]:=4
SAM3[3]:=4
SAM3[4]:=3
VISUALIZA('MORTO',1,7,11,21,69,SAM,SAM1,SAM2,SAM3)
SETCOLOR(GCOR1)
RETURN




FUNCTION CON_BOLET()
C:=SETCOLOR()
IF !ABREARQ('CADNOTAS','NOTA','R',3)
       RETURN
ENDIF
IF !ABREARQ('MATERIAS','MATER','R',3)
       RETURN
ENDIF
IF !ABREARQ('CADMATRI','CADA_MAT','R',3)
   RETURN
ENDIF
SET INDEX TO COMATIND
SETCOLOR(GCOR2)
NOMTELA(' CONSULTA BOLETIM POR ALUNO ')
DO WHILE .T. .AND. LASTKEY()#27
   TELA(4,5,6,75)
   TELA(6,1,20,78)
   @ 9,6  TO 19,6 ; @ 9,12 TO 19,12; @ 9,15 TO 19,15; @ 9,21 TO 19,21
   @ 9,24 TO 19,24; @ 9,30 TO 19,30; @ 9,33 TO 19,33; @ 9,39 TO 19,39
   @ 9,42 TO 19,42; @ 9,48 TO 19,48; @ 9,51 TO 19,51; @ 9,57 TO 19,57
   @ 9,60 TO 19,60; @ 9,66 TO 19,66; @ 9,69 TO 19,69; @ 9,75 TO 19,75
   @ 7,2 SAY 'Mate³ 1.Bim. ³Recup.1B³ 2.Bim. ³Recup.2B³ 3.Bim. ³Recup.3b³4.Bim.  ³Recup.4B'
   @ 8,2 SAY '    ³Notas³ F³Notas³ F³Notas³ F³Notas³ F³Notas³ F³Notas³ F³Notas³ F³Notas³ F'
   B:=PROCNAME()
   C_ALU:=SPACE(6)
   @ 5,6 SAY 'C¢d.Aluno: ' GET C_ALU PICT'@R 99999-9' VALID(VER_6())
   READ
   IF LASTKEY()=27 .OR. EMPTY(C_ALU)
      RETURN
   ENDIF
   SET DECIMAL TO 2
   A:=NOM_ALU
   MAIUSC(,,@A)
   B:=COD_ALU
   SET CURSOR OFF
   SELE NOTA
   GO TOP
   SETCOLOR('W/RB')
   @ 8,2 SAY ''
   DO WHILE .NOT. EOF() .AND. NEXTKEY()#27
      IF COD_ALU$B
         C:=NOTA->MAT_NOT
         SELE MATER
         SET INDEX TO MATECIND
         SEEK C
         D:=MATER->ABREVMAT
         @ ROW()+1,2 SAY D
         SELE NOTA
                  IF NOTA->NB1#0
                     @ ROW(),7 SAY NOTA->NB1 PICT'99.99'
                     @ ROW(),13 SAY NOTA->FN1 PICT'99'
                  ENDIF
                  IF NOTA->NR1#0
                     SETCOLOR('W+/RB')
                     @ ROW(),16 SAY NOTA->NR1 PICT'99.99'
                     @ ROW(),22 SAY NOTA->FR1 PICT'99'
                     SETCOLOR('W/RB')
                   ENDIF
                   IF NOTA->NB2#0
                     @ ROW(),25 SAY NOTA->NB2 PICT'99.99'
                     @ ROW(),31 SAY NOTA->FN2 PICT'99'
                   ENDIF
                   IF NOTA->NR2#0
                     SETCOLOR('W+/RB')
                     @ ROW(),34 SAY NOTA->NR2 PICT'99.99'
                     @ ROW(),40 SAY NOTA->FR2 PICT'99'
                     SETCOLOR('W/RB')
                   ENDIF
                   IF NOTA->NB3#0
                     @ ROW(),43 SAY NOTA->NB3 PICT'99.99'
                     @ ROW(),49 SAY NOTA->FN3 PICT'99'
                   ENDIF
                   IF NOTA->NR3#0
                     SETCOLOR('W+/RB')
                     @ ROW(),52 SAY NOTA->NR3 PICT'99.99'
                     @ ROW(),58 SAY NOTA->FR3 PICT'99'
                     SETCOLOR('W/RB')
                   ENDIF
                   IF NOTA->NB4#0
                     @ ROW(),61 SAY NOTA->NB4 PICT'99.99'
                     @ ROW(),67 SAY NOTA->FN4 PICT'99'
                   ENDIF
                   IF NOTA->NR4#0
                     SETCOLOR('W+/RB')
                     @ ROW(),70 SAY NOTA->NR4 PICT'99.99'
                     @ ROW(),76 SAY NOTA->FR4 PICT'99'
                     SETCOLOR('W/RB')
                  ENDIF
        ENDIF
     SKIP
   ENDDO
   SELE CADA_MAT
   SETCOLOR(GCOR2)
   TELA(20,7,22,73)
   @ 21,8 SAY 'ESC p/ Sair | ENTER =Nova Consulta| Seta direita=Resultado final'
   SET CURSOR ON
   INKEY(0)
   IF LASTKEY()=27
      EXIT
   ELSEIF LASTKEY()=4
      SNA:=SAVESCREEN(4,5,6,75)
      NOMTELA(' CONSULTA BOLETIM POR ALUNO  - 2a. Tela')
      RESTSCREEN(4,5,6,75,SNA)
      SETCOLOR('W/W')
      @ 7,1 CLEAR TO 20,78
      SETCOLOR(GCOR2)
      TELA(6,22,20,47)
       @ 9,27 TO 19,27;@ 9,33 TO 19,33; @ 9,37 TO 19,37; @ 9,43 TO 19,43
       @ 7,23 SAY 'Mate³Rec.Final³Resultado'
       @ 8,23 SAY '    ³Notas³ F ³Notas³TF '
       SET DECIMAL TO 2
       SET CURSOR OFF
       SELE NOTA
       GO TOP
       SETCOLOR('W/RB')
       @ 8,23 SAY ''
       DO WHILE .NOT. EOF() .AND. NEXTKEY()#27
          IF COD_ALU$C_ALU
             C:=NOTA->MAT_NOT
             SELE MATER
             SET INDEX TO MATECIND
             GO TOP
             SEEK C
             D:=MATER->ABREVMAT
             @ ROW()+1,23 SAY D
             SELE NOTA
                   IF NOTA->NRF#0
                     @ ROW(),28 SAY NOTA->NRF PICT'99.99'
                     @ ROW(),34 SAY NOTA->FRF PICT'99'
                   ENDIF
                   IF NOTA->RFN#0
                     SETCOLOR('W+/G+')
                     @ ROW(),38 SAY NOTA->RFN PICT'99.99'
                     @ ROW(),44 SAY NOTA->RFF PICT'99'
                     SETCOLOR('W/RB')
                  ENDIF
          ENDIF
         SKIP
       ENDDO
       SETCOLOR(GCOR2)
       TELA(20,7,22,73)
       @ 21,9 SAY '                                                                '
       @ 21,21 SAY 'ESC p/ Sair | ENTER =Nova Consulta'
       SET CURSOR ON
       INKEY(0)
         IF LASTKEY()=27
            EXIT
         ENDIF
   ENDIF
ENDDO
SETCOLOR(C)
RETURN



// *************** RELATORIO DE ALUNOS MATRICULAS COM NOME, SERIE,
// *************** GRAU, N.MATRIC., NASCIMENTO E IDADE    *******


FUNCTION RELA_ALU
IF !ABREARQ('CADMATRI','CADA_MAT','R',3)
   RETURN
ENDIF
SET INDEX TO GSMATIND
SET ORDER TO 4
AGREL()
NPAG:=1
DO WHILE .NOT. EOF() .AND. NEXTKEY()#27
CABEIMPRE()
NPAG++
   @ PROW()+2,15 SAY+PADC('RELATORIO DE MATRICULAS - Ordenado por serie/grau/nome ',120)
   @ PROW()+1,9 SAY REPL('=',120)
   @ PROW()+1,10 SAY 'NOME                                | MATRICULA | CODIGO  | SERIE | GRAU | DT.NASC    |   IDADE '
     @ PROW(),10 SAY 'NOME                                | MATRICULA | CODIGO  | SERIE | GRAU | DT.NASC    |   IDADE '
   @ PROW(),9 SAY REPL('_',120)
 DO WHILE .NOT. EOF() .AND. NEXTKEY()#27 .AND. PROW()<56
   A:=NOM_ALU
    MAIUSC(,,@A)
   @ PROW()+1,11 SAY A
   @ PROW(),46 SAY '|'
   @ PROW(),50 SAY NUM_MAT
   @ PROW(),PCOL() SAY '/94'
   @ PROW(),58 SAY '!'
   @ PROW(),60 SAY COD_ALU PICT'@R 99999-9'
   @ PROW(),68 SAY '!'
   @ PROW(),70 SAY SERIE PICT'@9'
   @ PROW(),76 SAY '|'
   @ PROW(),78 SAY GRAU  PICT'@9'
   @ PROW(),83 SAY '|'
   @ PROW(),85 SAY NASC_ALU PICT'@D'
   @ PROW(),96 SAY '|'
   SET DECIMAL TO 0
   A:=DATE()-NASC_ALU
   A:=INT(A/365)
   N:=SERIE
   @ PROW(),0 SAY PADL(ALLTRIM(STR(A)),104)
   SKIP
   IF N#SERIE
      @ PROW()+1,9 SAY REPL('- ',60)
    ENDIF
 ENDDO
ENDDO
@ PROW()+1,9 SAY REPL('=',120)
@ PROW()+1,84 SAY 'TOTAL DE MATRICULAS  : '
@ PROW(),PCOL() SAY ALLTRIM(STR(LASTREC()))
IF NEXTKEY()=27
   @ PROW()+1,21 SAY ' *******  CUIDADO - RELATORIO CANCELADO POR PEDIDO USUARIO ANTES DO TERMINO! *******'
   @ PROW(),21   SAY ' *******  CUIDADO - RELATORIO CANCELADO POR PEDIDO USUARIO ANTES DO TERMINO! *******'
ENDIF
EJECT
SET DEVICE TO SCREEN
SET DECIMAL TO 2
SET INDEX TO COMATIND
RETURN



FUNCTION REL_DIARIOS
IF !ABREARQ('CADMATRI','CADA_MAT','R',3)
   RETURN
ENDIF
SET INDEX TO GSMATIND
SET ORDER TO 4
SET DECIMAL TO 0
CX:=SETCOLOR()
SETCOLOR(GCOR2)
DO WHILE .T.
  NOMTELA('EMISSAO LISTAGEM P/ DIARIOS - ORDEM ALFABETICA, POR SERIE, TURMA,')
  X:=' '
  Y:=' '
  T:=' '
  NU:=0
  XA:=0
  TELA(7,10,10,70)
  @ 08,13 SAY 'SERIE ? ' GET X PICT'9' VALID(X$ '12345678 ')
  @ 08,30 SAY 'GRAU ? ' GET Y PICT'9' VALID(Y$ '12 ')
  @ 08,53 SAY 'TURMA ? ' GET T PICT'@S1!' VALID(T$ 'ABCDUE')
  @ 09,27 SAY 'QUANTIDADE DE COPIAS ? ' GET NU PICT'99'
  READ
  IF LASTKEY()=27
     EXIT
  ENDIF
  AGREL()
  SET DEVICE TO PRINTER
  DO WHILE NU>XA .AND. NEXTKEY()#27
  W:=1
  @ 01,00 SAY 'GRAU   '
  @ 01,00 SAY 'GRAU   '
  @ 01,7 SAY Y
  @ 01,14 SAY 'SERIE  '
  @ 01,14 SAY 'SERIE  '
  @ 01,22 SAY X
  @ 01,27 SAY 'TURMA  '
  @ 01,27 SAY 'TURMA  '
  @ 01,35 SAY '"  "'
  @ 01,36 SAY IF(T$'U','Unica',T)
  @ 04,00 SAY 'N.         NOMES '
  @ 04,00 SAY 'N.         NOMES '
  @ 05,00 SAY ' '
  GO TOP
  DO WHILE .NOT. EOF() .AND. NEXTKEY()#27
    IF CADA_MAT->SERIE==X .AND. CADA_MAT->GRAU==Y .AND. CADA_MAT->TURMA==T
       A:=CADA_MAT->NOM_ALU
       MAIUSC(,,@A)
       @ PROW()+1,0 SAY NUCLASSE
       @ PROW(),4 SAY A
       W++
    ENDIF
    SKIP
  ENDDO
  XA++
  IF NEXTKEY()=27
     @ PROW()+1,21 SAY ' *******  CUIDADO - RELATORIO CANCELADO POR PEDIDO USUARIO ANTES DO TERMINO! *******'
     @ PROW(),21   SAY ' *******  CUIDADO - RELATORIO CANCELADO POR PEDIDO USUARIO ANTES DO TERMINO! *******'
  ENDIF
  EJECT
  SET DEVICE TO SCREEN
  @ 22,10 SAY  ' TROQUE DE PAPEL (folha sulfite) !!  e tecle ENTER  '
  inkey(0)
  SET DEVICE TO PRINTER
  ENDDO
 SET DEVICE TO SCREEN
ENDDO
SET DECIMAL TO 2
SETCOLOR(CX)
RETURN



// *************** RELATORIO DE ALUNOS MATRICULAS COM NOME, SERIE,
// *************** GRAU, N.MATRIC., NASCIMENTO E IDADE    *******



FUNCTION REL_HISTORICO
IF !ABREARQ('MATERIAS','MATER','R',3)
       ? 'NAO DEU PARA ABRER!'
       RETURN
ENDIF
IF !ABREARQ('HISTESC','HISTORICO','R',3)
   RETURN
ENDIF
COPD:=0
CX:=SETCOLOR()
NOMTELA('EMITE HISTORICO 1 e 2§ GRAU - POR COD. DA TABELA ')
SELE HISTORICO
SET INDEX TO HCODIIND
        TELA (4,25,6,55)
        CODHI:='    '
        @     5,26  SAY '[ Cod.Tabela:          ]'
        @     5,41  GET CODHI PICT'@R 999-9'
        READ
        SEEK CODHI
        IF .NOT. FOUND()
             TE4:=SAVESCREEN(24,20,24,60)
             @ 24,30 SAY '[ C¢digo Inexistente ]'
             TONE(1000,2)
             TONE(500,3)
             INKEY(1)
             RESTSCREEN(24,20,24,60,TE4)
             RETURN
        ENDIF
AGREL()
SET MARGIN TO 9
SET DEVICE TO PRINTER
   @        1,2   SAY 'ESTADO DE MATO GROSSO'
   @ PROW()+1,2   SAY 'SECRETARIA DE EDUCACAO'
   @ PROW()+1,2   SAY 'SUPERINTENDENCIA REGIONAL DE EDUCACAO LESTE-SUL /01'
   @ PROW()+1,5   SAY+CHR(15)+'_'
   @ PROW(),5     SAY REPL('_',125)
   @  PROW()+1,0 SAY PADC(NOESC+' | END.: '+NOENDE+' | MUNICIPIO: '+NOCIDADE+' - '+NOUF,135)
   @  PROW(),0   SAY PADC(NOESC+' | END.: '+NOENDE+' | MUNICIPIO: '+NOCIDADE+' - '+NOUF,135)
   @ PROW(),5    SAY REPL('_',125)
   @  PROW()+1,5 SAY 'HISTORICO ESCOLAR DE '+IF(TIHIS$'1','1','2')+'. GRAU'
   @  PROW(),45  SAY '| CURSO: '+HISTORICO->HCURSO
   @  PROW(),90  SAY 'CRIACAO   : '+HISTORICO->HCRIAC
   @ PROW(),5    SAY REPL('_',125)
   @ PROW()+1,5  SAY 'AUTORIZACAO: '+HISTORICO->HAUTOR
   @  PROW(),68  SAY '| RECONHECIMENTO: '+HISTORICO->HRECON
   @  PROW(),5   SAY REPL('_',125)
   @  PROW()+1,5 SAY 'ALUNO(A)  : '+HISTORICO->HALUNO
   @  PROW(),5   SAY '            '+HISTORICO->HALUNO
   @  PROW(),55  SAY '| NATURAL./UF: '+HISTORICO->HNATUR
   @  PROW(),100  SAY '| NACIONALIDADE : '+HISTORICO->HNACIO
   @  PROW(),5   SAY REPL('_',125)
   @  PROW()+1,5 SAY 'DATA NASC.: '+DTOC(HISTORICO->HDTNAS)
   @  PROW(),45  SAY '| PAI: '+ALLTRIM(HISTORICO->HPAIAL)
   @  PROW(),90  SAY '| MAE: '+ALLTRIM(HISTORICO->HMAEAL)
   @  PROW(),5   SAY REPL('_',125)
   @  PROW()+1,5 SAY PADC(' NUCLEO COMUM    ARTIGO 7. / 5.692/71',130)
   @  PROW(),5   SAY PADC(' NUCLEO COMUM    ARTIGO 7. / 5.692/71',130)
   @  PROW()+1,5    SAY REPL('=',125)
   @  PROW()+1,5  SAY 'COMP.CURRICULARES\SERIE '
   @   PROW(),5    SAY 'COMP.CURRICULARES\SERIE '
   @   PROW(),45   SAY '|CARG| 1.SERIE | 2.SERIE | 3.SERIE | 4.SERIE |'
   IF TIHIS$'1'
      @ PROW(),91 SAY ' 5.SERIE | 6.SERIE | 7.SERIE | 8.SERIE |'
   ENDIF
   @   PROW()+1,45 SAY '|HORA|NOTA|CH  |NOTA|CH  |NOTA|CH  |NOTA|CH  |'
   IF TIHIS$'1'
      @  PROW(),91 SAY 'NOTA|CH  |NOTA|CH  |NOTA|CH  |NOTA|CH  |'
   ENDIF
   @  PROW(),5 SAY REPL('_',125)
   IU:=1
   totnc:=0
   TPD:=0
   TES:=0
   FOR II=1 TO 60 STEP 4
     totnc+=val(SUBSTR(HISTORICO->HNC02,II,4))
     iu++
     if iu=16
        EXIT
     ENDIF
   NEXT
   IU:=1
   FOR IQ:=61 TO 128 STEP 4
     TPD+=val(SUBSTR(HISTORICO->HNC02,IQ,4))
     iu++
     if iu=18
        EXIT
     ENDIF
   NEXT
   TES:=VAL(SUBSTR(HISTORICO->HNC02,125,4))
   I:=1
   IU:=1
   FOR II=1 TO 132 STEP 4
     @  PROW(),5 SAY REPL('_',125)
     SELE MATER
     SET INDEX TO MATECIND
     GO TOP
     SEEK (SUBSTR(HISTORICO->HNC01,I,3))
     @ PROW()+1,5 SAY MATER->MATERIA
     @ PROW(),45 SAY '|'
     SELE HISTORICO
     @ PROW(),46 SAY SUBSTR(HISTORICO->HNC02,II,4)
     @   PROW(),50 SAY '|'
     @ PROW(),51 SAY IF(SUBSTR(HISTORICO->HNO01,II,4)#'000',SUBSTR(HISTORICO->HNO01,II,4),' -')
     @   PROW(),55 SAY '|'
     @ PROW(),56 SAY IF(SUBSTR(HISTORICO->HCH01,II,4)#'000',SUBSTR(HISTORICO->HCH01,II,4),' -')
     @   PROW(),60 SAY '|'
     @ PROW(),61 SAY IF(SUBSTR(HISTORICO->HNO02,II,4)#'000',SUBSTR(HISTORICO->HNO02,II,4),' -')
     @   PROW(),65 SAY '|'
     @ PROW(),66 SAY IF(SUBSTR(HISTORICO->HCH02,II,4)#'000',SUBSTR(HISTORICO->HCH02,II,4),' -')
     @   PROW(),70 SAY '|'
     @ PROW(),71 SAY IF(SUBSTR(HISTORICO->HNO03,II,4)#'000',SUBSTR(HISTORICO->HNO03,II,4),' -')
     @   PROW(),75 SAY '|'
     @ PROW(),76 SAY IF(SUBSTR(HISTORICO->HCH03,II,4)#'000',SUBSTR(HISTORICO->HCH03,II,4),' -')
     @   PROW(),80 SAY '|'
     @ PROW(),81 SAY IF(SUBSTR(HISTORICO->HNO04,II,4)#'000',SUBSTR(HISTORICO->HNO04,II,4),' -')
     @   PROW(),85 SAY '|'
     @ PROW(),86 SAY IF(SUBSTR(HISTORICO->HCH04,II,4)#'000',SUBSTR(HISTORICO->HCH04,II,4),' -')
     @   PROW(),90 SAY '|'
     IF TIHIS$'1'
       @ PROW(),91 SAY IF(SUBSTR(HISTORICO->HNO05,II,4)#'000',SUBSTR(HISTORICO->HNO05,II,4),' -')
       @   PROW(),95 SAY '|'
       @ PROW(),96 SAY IF(SUBSTR(HISTORICO->HCH05,II,4)#'000',SUBSTR(HISTORICO->HCH05,II,4),' -')
       @   PROW(),100 SAY '|'
       @ PROW(),101 SAY IF(SUBSTR(HISTORICO->HNO06,II,4)#'000',SUBSTR(HISTORICO->HNO06,II,4),' -')
       @   PROW(),105 SAY '|'
       @ PROW(),106 SAY IF(SUBSTR(HISTORICO->HCH06,II,4)#'000',SUBSTR(HISTORICO->HCH06,II,4),' -')
       @   PROW(),110 SAY '|'
       @ PROW(),111 SAY IF(SUBSTR(HISTORICO->HNO07,II,4)#'000',SUBSTR(HISTORICO->HNO07,II,4),' -')
       @   PROW(),115 SAY '|'
       @ PROW(),116 SAY IF(SUBSTR(HISTORICO->HCH07,II,4)#'000',SUBSTR(HISTORICO->HCH07,II,4),' -')
       @   PROW(),120 SAY '|'
       @ PROW(),121 SAY IF(SUBSTR(HISTORICO->HNO08,II,4)#'000',SUBSTR(HISTORICO->HNO08,II,4),' -')
       @   PROW(),125 SAY '|'
       @ PROW(),126 SAY IF(SUBSTR(HISTORICO->HCH08,II,4)#'000',SUBSTR(HISTORICO->HCH08,II,4),' -')
       @   PROW(),130 SAY '|'
     ENDIF
     I+=3
     IU++
  IF IU=33
     EXIT
  ENDIF
  IF IU=16
           @  PROW(),5   SAY REPL('_',125)
           @  PROW()+1,5 SAY PADC('PARTE DIVERSIFICADA',130)
           @  PROW(),5   SAY PADC('PARTE DIVERSIFICADA',130)
           @  PROW(),5    SAY REPL('_',125)
           COPD:=1
   ENDIF
      IF COPD#0 .AND. TIHIS$'1'
         COPD++
         IF COPD>5
            EXIT
         ENDIF
      ENDIF
  NEXT
  @  PROW(),5 SAY REPL('_',125)
  @ PROW()+1,5 SAY 'RESULTADO FINAL '
  @ PROW(),5   SAY 'RESULTADO FINAL '
  @ PROW(),45 SAY '|'
  SELE HISTORICO
  @ PROW(),46 SAY SUBSTR(HISTORICO->HNC02,129,4)
  @   PROW(),50 SAY '|'
  @ PROW(),51 SAY IF(SUBSTR(HISTORICO->HNO01,129,4)#'000',SUBSTR(HISTORICO->HNO01,129,4),' -')
  @   PROW(),55 SAY '|'
  @ PROW(),56 SAY IF(SUBSTR(HISTORICO->HCH01,129,4)#'000',SUBSTR(HISTORICO->HCH01,129,4),' -')
  @   PROW(),60 SAY '|'
  @ PROW(),61 SAY IF(SUBSTR(HISTORICO->HNO02,129,4)#'000',SUBSTR(HISTORICO->HNO02,129,4),' -')
  @   PROW(),65 SAY '|'
  @ PROW(),66 SAY IF(SUBSTR(HISTORICO->HCH02,129,4)#'000',SUBSTR(HISTORICO->HCH02,129,4),' -')
  @   PROW(),70 SAY '|'
  @ PROW(),71 SAY IF(SUBSTR(HISTORICO->HNO03,129,4)#'000',SUBSTR(HISTORICO->HNO03,129,4),' -')
  @   PROW(),75 SAY '|'
  @ PROW(),76 SAY IF(SUBSTR(HISTORICO->HCH03,129,4)#'000',SUBSTR(HISTORICO->HCH03,129,4),' -')
  @   PROW(),80 SAY '|'
  @ PROW(),81 SAY IF(SUBSTR(HISTORICO->HNO04,129,4)#'000',SUBSTR(HISTORICO->HNO04,129,4),' -')
  @   PROW(),85 SAY '|'
  @ PROW(),86 SAY IF(SUBSTR(HISTORICO->HCH04,129,4)#'000',SUBSTR(HISTORICO->HCH04,129,4),' -')
  @   PROW(),90 SAY '|'
  IF TIHIS$'1'
     @ PROW(),91 SAY IF(SUBSTR(HISTORICO->HNO05,129,4)#'000',SUBSTR(HISTORICO->HNO05,129,4),' -')
     @   PROW(),95 SAY '|'
     @ PROW(),96 SAY IF(SUBSTR(HISTORICO->HCH05,129,4)#'000',SUBSTR(HISTORICO->HCH05,129,4),' -')
     @   PROW(),100 SAY '|'
     @ PROW(),101 SAY IF(SUBSTR(HISTORICO->HNO06,129,4)#'000',SUBSTR(HISTORICO->HNO06,129,4),' -')
     @   PROW(),105 SAY '|'
     @ PROW(),106 SAY IF(SUBSTR(HISTORICO->HCH06,129,4)#'000',SUBSTR(HISTORICO->HCH06,129,4),' -')
     @   PROW(),110 SAY '|'
     @ PROW(),111 SAY IF(SUBSTR(HISTORICO->HNO07,129,4)#'000',SUBSTR(HISTORICO->HNO07,129,4),' -')
     @   PROW(),115 SAY '|'
     @ PROW(),116 SAY IF(SUBSTR(HISTORICO->HCH07,129,4)#'000',SUBSTR(HISTORICO->HCH07,129,4),' -')
     @   PROW(),120 SAY '|'
     @ PROW(),121 SAY IF(SUBSTR(HISTORICO->HNO08,129,4)#'000',SUBSTR(HISTORICO->HNO08,129,4),' -')
     @   PROW(),125 SAY '|'
     @ PROW(),126 SAY IF(SUBSTR(HISTORICO->HCH08,129,4)#'000',SUBSTR(HISTORICO->HCH08,129,4),' -')
     @   PROW(),130 SAY '|'
   ENDIF
   @ PROW(),5  SAY REPL('_',125)
   IF HAn01#'    '
           @  PROW()+1,5 SAY '1.SERIE'
           @  PROW(),5   SAY '1.SERIE'
           @  PROW(),15   SAY 'ANO: '+HAN01
           @  PROW(),25  SAY 'ESTABELECIMENTO: '+HES01
           @  PROW(),85  SAY 'LOCALIDADE: '+HLO01
           @  PROW(),122 SAY 'UF: '+HUF01
           @ PROW(),5  SAY REPL('_',125)
  ENDIF
  IF HAN02#'    '
           @  PROW()+1,5 SAY '2.SERIE'
           @  PROW(),5   SAY '2.SERIE'
           @  PROW(),15   SAY 'ANO: '+HAN02
           @  PROW(),25  SAY 'ESTABELECIMENTO: '+HES02
           @  PROW(),85  SAY 'LOCALIDADE: '+HLO02
           @  PROW(),122 SAY 'UF: '+HUF02
           @ PROW(),5  SAY REPL('_',125)
  ENDIF
  IF HAN03#'    '
           @  PROW()+1,5 SAY '3.SERIE'
           @  PROW(),5   SAY '3.SERIE'
           @  PROW(),15   SAY 'ANO: '+HAN03
           @  PROW(),25  SAY 'ESTABELECIMENTO: '+HES03
           @  PROW(),85  SAY 'LOCALIDADE: '+HLO03
           @  PROW(),122 SAY 'UF: '+HUF03
           @ PROW(),5  SAY REPL('_',125)
  ENDIF
  IF HAN04#'0000'
           @  PROW()+1,5 SAY '4.SERIE'
           @  PROW(),5   SAY '4.SERIE'
           @  PROW(),15   SAY 'ANO: '+HAN04
           @  PROW(),25  SAY 'ESTABELECIMENTO: '+HES04
           @  PROW(),85  SAY 'LOCALIDADE: '+HLO04
           @  PROW(),122 SAY 'UF: '+HUF04
           @ PROW(),5  SAY REPL('_',125)
  ENDIF
  IF TIHIS$'1'
   IF HAn05#'    '
           @  PROW()+1,5 SAY '5.SERIE'
           @  PROW(),5   SAY '5.SERIE'
           @  PROW(),15   SAY 'ANO: '+HAN05
           @  PROW(),25  SAY 'ESTABELECIMENTO: '+HES05
           @  PROW(),85  SAY 'LOCALIDADE: '+HLO05
           @  PROW(),122 SAY 'UF: '+HUF05
           @ PROW(),5  SAY REPL('_',125)
  ENDIF
  IF HAN06#'    '
           @  PROW()+1,5 SAY '6.SERIE'
           @  PROW(),5   SAY '6.SERIE'
           @  PROW(),15   SAY 'ANO: '+HAN06
           @  PROW(),25  SAY 'ESTABELECIMENTO: '+HES06
           @  PROW(),85  SAY 'LOCALIDADE: '+HLO06
           @  PROW(),122 SAY 'UF: '+HUF06
           @ PROW(),5  SAY REPL('_',125)
  ENDIF
  IF HAN07#'    '
           @  PROW()+1,5 SAY '7.SERIE'
           @  PROW(),5   SAY '7.SERIE'
           @  PROW(),15   SAY 'ANO: '+HAN07
           @  PROW(),25  SAY 'ESTABELECIMENTO: '+HES07
           @  PROW(),85  SAY 'LOCALIDADE: '+HLO07
           @  PROW(),122 SAY 'UF: '+HUF07
           @ PROW(),5  SAY REPL('_',125)
  ENDIF
  IF HAN08#'0000'
           @  PROW()+1,5 SAY '8.SERIE'
           @  PROW(),5   SAY '8.SERIE'
           @  PROW(),15   SAY 'ANO: '+HAN08
           @  PROW(),25  SAY 'ESTABELECIMENTO: '+HES08
           @  PROW(),85  SAY 'LOCALIDADE: '+HLO08
           @  PROW(),122 SAY 'UF: '+HUF08
           @ PROW(),5  SAY REPL('_',125)
  ENDIF
  ENDIF
  @  PROW(),5 SAY REPL('_',125)
  @  PROW()+1,5 SAY '| CURSO: '+HISTORICO->HCURSO
  @  PROW(),45  SAY '| TOTAL DE HORAS |   OBSERVACOES :                                                  |'
  @  PROW(),5   SAY REPL('_',57)
  @  PROW()+1,5 SAY '|NUCLEO COMUM E ART.7./ 5692/71         |                |                                                                  |'
  @  PROW(),52  SAY+TRANSFORM(STR(TOTNC,4,0), '@R 9999')
  @  PROW(),5   SAY REPL('_',57)
  @  PROW()+1,5 SAY '|PARTE DIVERSIFICADA                    |                |                                                                  |'
  @  PROW(),52  SAY+TRANSFORM(STR((TPD-TES),4,0), '@R 9999')
  @  PROW(),5   SAY REPL('_',57)
  @  PROW()+1,5 SAY '|ESTAGIO SUPERVISIONADO                 |                |                                                                  |'
  @  PROW(),52  SAY+TRANSFORM(STR(TES,4,0), '@R 9999')
  @  PROW(),5   SAY REPL('_',57)
  @  PROW()+1,5 SAY '| T O T A L   G E R A L                 |                |                                                                  |'
  @  PROW(),52  SAY+TRANSFORM(STR((TPD+TOTNC),4,0), '@R 9999')
  @  PROW(),5   SAY REPL('_',125)
  @  PROW()+2,5 SAY 'DATA: '+DTOC(DATE())
  @  PROW(),30  SAY 'SECRETARIO  /AUT. N.: '
  @  PROW(),90  SAY 'DIRETOR  /AUT. N.: '
  @  PROW()+1,5 SAY REPL('= ',65)
  @  PROW()+1,5 SAY+CHR(14)+' '
  @  PROW()+1,5 SAY+CHR(18)+' '
  EJECT
SET DEVICE TO SCREEN
SETCOLOR(CX)
RETURN




// ********** RELATORIO DE MATERIAS CADASTRADAS *************


FUNCTION RELA_MATE
IF !ABREARQ('MATERIAS','MATER','R',3)
       RETURN
ENDIF
SET INDEX TO MATEAIND
SET ORDER TO 1
AGREL()
NPAG:=1
DO WHILE .NOT. EOF()  .AND. NEXTKEY()#27
   CABEIMPRE()
   NPAG++
   @ PROW(),0 SAY+CHR(18)
   @ PROW()+2,15 SAY+PADC('RELATORIO DE MATERIAS',65)
   @ PROW()+1,15 SAY REPL('=',65)
   @ PROW()+1,16 SAY 'CODIGO|      MATERIA'
   @ PROW(),16   SAY 'CODIGO|      MATERIA'
   @ PROW(),15 SAY REPL('_',65)
   DO WHILE .NOT. EOF() .AND.  PROW()<56 .AND. NEXTKEY()#27
      @ PROW()+1,17 SAY C_MATERI PICT'@R 99-9'
      @ PROW(),22 SAY '|'
      @ PROW(),24 SAY MATERIA
      @ PROW(),PCOL()+1 SAY ABREVMAT
      SKIP
   ENDDO
ENDDO
@ PROW()+1,15 SAY REPL('=',65)
@ PROW()+1,44 SAY 'TOTAL DE MATERIAS CADASTRADAS: '
@ PROW(),PCOL() SAY ALLTRIM(STR(LASTREC()))
IF NEXTKEY()=27
   @ PROW()+1,21 SAY ' *******  CUIDADO - RELATORIO CANCELADO POR PEDIDO USUARIO ANTES DO TERMINO! *******'
   @ PROW(),21   SAY ' *******  CUIDADO - RELATORIO CANCELADO POR PEDIDO USUARIO ANTES DO TERMINO! *******'
ENDIF
EJECT
SET DEVICE TO SCREEN
SET DECIMAL TO 2
RETURN



// ******** RELATORIO DE PROFESSORES CADASTRADOS ********

FUNCTION RELA_PROF
IF !ABREARQ('PROFESSO','PROFESS','R',3)
       RETURN
ENDIF
SELE PROFESS
SET INDEX TO NOPROIND
AGREL()
NPAG:=1
DO WHILE .NOT. EOF() .AND. NEXTKEY()#27
   CABEIMPRE()
   NPAG++
   @ PROW(),0 SAY+CHR(18)
   @ PROW()+2,15 SAY+PADC('RELATORIO DE PROFESSORES',65)
   @ PROW()+1,15 SAY REPL('=',65)
   @ PROW()+1,15 SAY 'CODIGO|       PROFESSOR'
   @ PROW(),15   SAY 'CODIGO|       PROFESSOR'
   @ PROW(),15 SAY REPL('_',65)
   DO WHILE .NOT. EOF() .AND. NEXTKEY()#27
       @ PROW()+1,16 SAY C_PROFES PICT'@R 99-9'
       A:=PROFESSO
       MAIUSC(,,@A)
       @ PROW(),22 SAY '|'
       @ PROW(),24 SAY A
       SKIP
   ENDDO
ENDDO
@ PROW()+1,15 SAY REPL('=',65)
@ PROW()+1,44 SAY 'TOTAL DE PROFESSORES CADASTRADOS: '
@ PROW(),PCOL() SAY ALLTRIM(STR(LASTREC()))
IF NEXTKEY()=27
   @ PROW()+1,21 SAY ' *******  CUIDADO - RELATORIO CANCELADO POR PEDIDO USUARIO ANTES DO TERMINO! *******'
   @ PROW(),21   SAY ' *******  CUIDADO - RELATORIO CANCELADO POR PEDIDO USUARIO ANTES DO TERMINO! *******'
ENDIF
EJECT
SET DEVICE TO SCREEN
SET DECIMAL TO 2
RETURN



FUNCTION RELA_GRADE
IF !ABREARQ('MATERIAS','MATER','R',3)
       RETURN
ENDIF
IF !ABREARQ('CADGRADE','GRADE','R',3)
       RETURN
ENDIF
SET INDEX TO
IF !ABREARQ('MATGRADE','MGRADE','R',3)
       RETURN
ENDIF
SELE GRADE
SET INDEX TO
AGREL()
NPAG:=1
DO WHILE .NOT. EOF() .AND. NEXTKEY()#27
   CABEIMPRE()
   NPAG++
   @ PROW()+2,0 SAY+chr(18)+PADC('RELATORIO - GRADE ESCOLAR',80)
   @ PROW()+1,5 SAY REPL('=',75)
   DO WHILE .NOT. EOF() .AND. NEXTKEY()#27
       @  PROW()+1,5 SAY PADC('Cod/Tabela: '+COD_GRAD+'   Curso: '+CUR_GRAD+'   Criacao : '+CRI_GRAD,75)
       @  PROW()+1,5 SAY PADC('Aut. : '+AUT_GRAD+'   Reconh.: '+REC_GRAD,75)
       @  PROW()+1,5 SAY PADC(' Ano: '+ANO_GRAD+'   Serie: '+SER_GRAD+'   Grau : '+GRA_GRAD,75)
       @ PROW()+1,5 SAY REPL('_',75)
       @ PROW()+1,5 SAY 'CO.MAT ! MATERIA                      !'
       @ PROW(),PCOL()+2 SAY 'CH/SEM ! CH/ANUAL'
       @ PROW()+1,5 SAY REPL('_',62)
       SELE MGRADE
        DO WHILE  GRADE->COD_GRAD$MGRADE->GRADECOD .AND. PROW()<56 .AND. NEXTKEY()#27
           @  PROW()+1,5 SAY MGRADE->GRADEMAT PICT'@R 99-9'
           SELE MATER
           SET INDEX TO MATECIND
           SEEK MGRADE->GRADEMAT
           @ PROW(),14 SAY MATERIA
           SELE MGRADE
           @  PROW(),40   SAY MGRADE->GRADECHS PICT'999'
           @  PROW(),45   SAY MGRADE->GRADECHA PICT'9999'
           SKIP
        ENDDO
       SELE GRADE
       SKIP
       @ PROW()+1,5 SAY REPL('_ ',62)
    ENDDO
ENDDO
IF NEXTKEY()=27
   @ PROW()+1,5 SAY '   CUIDADO - RELATORIO CANCELADO POR PEDIDO USUARIO ANTES DO TERMINO! **'
   @ PROW(),5   SAY ' *  CUIDADO - RELATORIO CANCELADO POR PEDIDO USUARIO ANTES DO TERMINO! **'
ENDIF
EJECT
SET DEVICE TO SCREEN
SET DECIMAL TO 2
RETURN




FUNCTION SUBRELA_FREE()
NOMTELA(' ESCOLHA OS CAMPOS QUE DESEJA P/ O RELATORIO- X(P/MARCAR) OU BARRA DE ESPA€O' )
IF !ABREARQ('CADMATRI','CADA_MAT','R',3)
   RETURN
ENDIF
SET INDEX TO
TELA(4,3,15,77)
CO6:=SETCOLOR()
@         5,09 SAY 'C¢d.aluno '
@   ROW()+1,09 SAY 'Cod.matri.'
@   ROW()+1,09 SAY 'Situa‡Æo A/I'
@   ROW()+1,09 SAY 'Data      '
@   ROW()+1,09 SAY 'S‚rie     '
@   ROW()+1,09 SAY 'Turma     '
@   ROW()+1,09 SAY 'Turno     '
@   ROW()+1,09 SAY 'N.do aluno'
@   ROW()+1,09 SAY 'Grau      '
@   ROW()+1,09 SAY 'Curso:1ou2'
@         5,27 SAY 'Aluno(a)  '
@   ROW()+1,27 SAY 'Masc/Fem. '
@   ROW()+1,27 SAY 'Endere‡o  '
@   ROW()+1,27 SAY 'Bairro    '
@   ROW()+1,27 SAY 'Cidade    '
@   ROW()+1,27 SAY 'UF(Estado)'
@   ROW()+1,27 SAY 'CEP       '
@   ROW()+1,27 SAY 'Telefone  '
@   ROW()+1,27 SAY 'Data Nasc '
@   ROW()+1,27 SAY 'Natural de'
@         5,44 SAY '(Est.Nasc)'
@   ROW()+1,44 SAY 'Pai       '
@   ROW()+1,44 SAY 'Prof.Pai  '
@   ROW()+1,44 SAY 'MÆe       '
@   ROW()+1,44 SAY 'Prof.MÆe  '
@   ROW()+1,44 SAY 'Relig.alu.'
@   ROW()+1,44 SAY 'Relig.Pais'
@   ROW()+1,44 SAY '1.Part/2.Bol'
@   ROW()+1,44 SAY 'Int.  Ext. '
@   ROW()+1,44 SAY 'SEC/ESCOLA '
@         5,63 SAY 'Respons vel'
@   ROW()+1,63 SAY 'Endere‡o  '
@   ROW()+1,63 SAY 'Bairro    '
@   ROW()+1,63 SAY 'Cidade    '
@   ROW()+1,63 SAY 'UF Respon.'
@   ROW()+1,63 SAY 'CEP        '
@   ROW()+1,63 SAY 'Telefone   '
@   ROW()+1,63 SAY 'CPF        '
@   ROW()+1,63 SAY 'RG N§      '
@   ROW()+1,63 SAY 'UF-Emissor '
SETCOLOR('W/GR')
FOR I=5 TO 14
    @ I,4 SAY '[ ]'
NEXT
FOR I=5 TO 14
    @ I,23 SAY '[ ]'
NEXT
FOR I=5 TO 14
    @ I,40 SAY '[ ]'
NEXT
FOR I=5 TO 14
    @ I,58 SAY '[ ]'
NEXT
PRIVATE V[40]
AFILL(V,' ')
IL:=5
FOR I=1 TO 10
    @ IL,5 GET V[I]
    IL++
NEXT
IL:=5
FOR I=11 TO 20
    @ IL,24 GET V[I]
    IL++
NEXT
IL:=5
FOR I=21 TO 30
    @ IL,41 GET V[I]
    IL++
NEXT
IL:=5
FOR I=31 TO 40
    @ IL,59 GET V[I]
    IL++
NEXT
READ
IF LASTKEY()=27
   RETURN
ENDIF
PRIVATE V1:={}
FOR I=1 TO 40
     IF V[I]$'X'
        AADD(V1,I)
     ENDIF
NEXT
TELA(17,3,23,77)
CV:=LEN(V1)
IL:=18
CL:=9
CAMPOS:=''
FOR I=1 TO CV
     @ IL,CL SAY FIELD((V1[I]))
     CAMPOS+='+'
     CAMPOS+=(FIELD((V1[I])))
     IF IL=22
        IL:=17
        CL+=18
     ENDIF
    IL++
NEXT
@ 23,10 SAY CAMPOS
INKEY(0)
NOMTELA(' MONTAGEM-RELATORIO - ESCOLHA OS CAMPOS QUE DEVERÇO ORDENAR A LISTAGEM ' )
TELA(4,3,15,77)
@         5,09 SAY 'C¢d.aluno '
@   ROW()+1,09 SAY 'Cod.matri.'
@   ROW()+1,09 SAY 'Situa‡Æo A/I'
@   ROW()+1,09 SAY 'Data      '
@   ROW()+1,09 SAY 'S‚rie     '
@   ROW()+1,09 SAY 'Turma     '
@   ROW()+1,09 SAY 'Turno     '
@   ROW()+1,09 SAY 'N.do aluno'
@   ROW()+1,09 SAY 'Grau      '
@   ROW()+1,09 SAY 'Curso:1ou2'
@         5,27 SAY 'Aluno(a)  '
@   ROW()+1,27 SAY 'Masc/Fem. '
@   ROW()+1,27 SAY 'Endere‡o  '
@   ROW()+1,27 SAY 'Bairro    '
@   ROW()+1,27 SAY 'Cidade    '
@   ROW()+1,27 SAY 'UF(Estado)'
@   ROW()+1,27 SAY 'CEP       '
@   ROW()+1,27 SAY 'Telefone  '
@   ROW()+1,27 SAY 'Data Nasc '
@   ROW()+1,27 SAY 'Natural de'
@         5,44 SAY '(Est.Nasc)'
@   ROW()+1,44 SAY 'Pai       '
@   ROW()+1,44 SAY 'Prof.Pai  '
@   ROW()+1,44 SAY 'MÆe       '
@   ROW()+1,44 SAY 'Prof.MÆe  '
@   ROW()+1,44 SAY 'Relig.alu.'
@   ROW()+1,44 SAY 'Relig.Pais'
@   ROW()+1,44 SAY '1.Part/2.Bol'
@   ROW()+1,44 SAY 'Int.  Ext. '
@   ROW()+1,44 SAY 'SEC/ESCOLA '
@         5,63 SAY 'Respons vel'
@   ROW()+1,63 SAY 'Endere‡o  '
@   ROW()+1,63 SAY 'Bairro    '
@   ROW()+1,63 SAY 'Cidade    '
@   ROW()+1,63 SAY 'UF Respon.'
@   ROW()+1,63 SAY 'CEP        '
@   ROW()+1,63 SAY 'Telefone   '
@   ROW()+1,63 SAY 'CPF        '
@   ROW()+1,63 SAY 'RG N§      '
@   ROW()+1,63 SAY 'UF-Emissor '
SETCOLOR('W/GR')
FOR I=5 TO 14
    @ I,4 SAY '[ ]'
NEXT
FOR I=5 TO 14
    @ I,23 SAY '[ ]'
NEXT
FOR I=5 TO 14
    @ I,40 SAY '[ ]'
NEXT
FOR I=5 TO 14
    @ I,58 SAY '[ ]'
NEXT
PRIVATE V2[40]
AFILL(V2,' ')
IL:=5
FOR I=1 TO 10
    @ IL,5 GET V2[I]
    IL++
NEXT
IL:=5
FOR I=11 TO 20
    @ IL,24 GET V2[I]
    IL++
NEXT
IL:=5
FOR I=21 TO 30
    @ IL,41 GET V2[I]
    IL++
NEXT
IL:=5
FOR I=31 TO 40
    @ IL,59 GET V2[I]
    IL++
NEXT
READ
IF LASTKEY()=27
   RETURN
ENDIF
PRIVATE V3:={}
FOR I=1 TO 40
     IF V2[I]$'X'
        AADD(V3,I)
     ENDIF
NEXT
TELA(17,3,23,77)
CV:=LEN(V3)
IL:=18
CL:=9
INDICE:=''
FOR I=1 TO CV
     @ IL,CL SAY FIELD((V3[I]))
     INDICE+='+'
     INDICE+=FIELD((V3[I]))
     IF IL=22
        IL:=17
        CL+=18
     ENDIF
    IL++
NEXT
@ 23,10 SAY INDICE
IF LEN(INDICE)>2
   INDEX ON INDICE TO INDITEMP
   SET INDEX TO INDITEMP
ENDIF
INKEY(0)
CV:=LEN(V1)
CAMPOS:=''
   AGREL()
   NPAG:=1
   DO WHILE .NOT. EOF() .AND. NEXTKEY()#27
      CABEIMPRE()
      NPAG++
      @ PROW()+2,15 SAY+PADC('RELATORIO LIVRE - Montado pelo usuario',120)
      @ PROW()+1,5 SAY REPL('=',125)
      DO WHILE .NOT. EOF() .AND. NEXTKEY()#27 .AND. PROW()<56
         @ PROW()+1,5 SAY ' '
         FOR I=1 TO CV
             @ PROW(),PCOL()+1 SAY (FIELDGET((V1[I])))
         NEXT
         SKIP
      ENDDO
ENDDO
@ PROW()+1,5 SAY REPL('=',125)
IF NEXTKEY()=27
    @ PROW()+1,21 SAY ' *******  CUIDADO - RELATORIO CANCELADO POR PEDIDO USUARIO ANTES DO TERMINO! *******'
    @ PROW(),21   SAY ' *******  CUIDADO - RELATORIO CANCELADO POR PEDIDO USUARIO ANTES DO TERMINO! *******'
ENDIF
EJECT
SET DEVICE TO SCREEN
SET DECIMAL TO 2
SET INDEX TO COMATIND
SETCOLOR(CO6)
RETURN



FUNCTION RELA_ALU1
IF !ABREARQ('CADMATRI','CADA_MAT','R',3)
   RETURN
ENDIF
SET INDEX TO DTMATIND
GO TOP
NOMTELA('RELATORIO POR DATA DE NASCIMENTO E SITUACAO (INTERNO OU EXTERNO)')
SX:=' '
ST:=' '
TELA(4,10,6,70)
@ 5,11      SAY 'Sexo M/F/(T)odos ? ' GET SX PICT'@S1!' VALID(SX$ 'MFT')
@ 5,COL()+3 SAY 'Situacao I/E/(T)odos ? ' GET ST PICT'@S1!' VALID(ST$ 'IET')
READ
IF LASTKEY()=27
   RETURN
ENDIF
AGREL()
NPAG:=1
COTA:=0
DO WHILE .NOT. EOF() .AND. NEXTKEY()#27
   CABEIMPRE()
   NPAG++
   @ PROW()+2,15 SAY+PADC('RELATORIO DE ALUNOS - Ordenado por data de nascimento,sexo  e situacao interna ',120)
   @ PROW()+1,9 SAY REPL('=',120)
   @ PROW()+1,10 SAY 'NOME                                | MATRICULA | CODIGO  | SERIE | GRAU | DT.NASC    |   IDADE '
   @ PROW(),10 SAY 'NOME                                | MATRICULA | CODIGO  | SERIE | GRAU | DT.NASC    |   IDADE '
   @ PROW(),9 SAY REPL('_',120)
   DO WHILE .NOT. EOF() .AND. NEXTKEY()#27 .AND. PROW()<56
    IF SX#'T' .AND. ST#'T'
     IF CADA_MAT->SEXO$SX .AND. CADA_MAT->SIT_INTE$ST
       COTA++
       LIALUSEX()
     ENDIF
   ELSEIF SX$'T' .AND. ST#'T'
    IF CADA_MAT->SIT_INTE$ST
       COTA++
       LIALUSEX()
     ENDIF
   ELSEIF SX#'T' .AND. ST$'T'
    IF CADA_MAT->SEXO$SX
       COTA++
       LIALUSEX()
     ENDIF
   ELSEIF SX$'T' .AND. ST$'T'
       COTA++
       LIALUSEX()
    ENDIF
     SKIP
   ENDDO
ENDDO
@ PROW()+1,9 SAY REPL('=',120)
@ PROW()+1,84 SAY 'TOTAL ...............: '
@ PROW(),PCOL() SAY ALLTRIM(STR(COTA))
IF NEXTKEY()=27
    @ PROW()+1,21 SAY ' *******  CUIDADO - RELATORIO CANCELADO POR PEDIDO USUARIO ANTES DO TERMINO! *******'
    @ PROW(),21   SAY ' *******  CUIDADO - RELATORIO CANCELADO POR PEDIDO USUARIO ANTES DO TERMINO! *******'
ENDIF
EJECT
SET DEVICE TO SCREEN
SET DECIMAL TO 2
SET INDEX TO COMATIND
RETURN


FUNCTION LIALUSEX
  A:=ALLTRIM(NOM_ALU)
  MAIUSC(,,@A)
  @ PROW()+1,11 SAY A
  @ PROW(),46 SAY '|'
  @ PROW(),50 SAY NUM_MAT
  @ PROW(),PCOL() SAY '/94'
  @ PROW(),58 SAY '!'
  @ PROW(),60 SAY COD_ALU PICT'@R 99999-9'
  @ PROW(),68 SAY '!'
  @ PROW(),70 SAY SERIE+TURMA
  @ PROW(),76 SAY '|'
  @ PROW(),78 SAY GRAU  PICT'9'
  @ PROW(),83 SAY '|'
  @ PROW(),85 SAY NASC_ALU PICT'@D'
  @ PROW(),96 SAY '|'
  SET DECIMAL TO 0
  A:=DATE()-NASC_ALU
  A:=INT(A/365)
  N:=SERIE
  @ PROW(),0 SAY PADL(ALLTRIM(STR(A)),104)
RETURN



FUNCTION REL_MATCLA
IF !ABREARQ('CADMATRI','CADA_MAT','R',3)
   RETURN
ENDIF
SET INDEX TO GSMATIND
SET ORDER TO 4
AGREL()
NPAG:=1
COTA:=0
DO WHILE .NOT. EOF() .AND. NEXTKEY()#27
   CABEIMPRE()
   NPAG++
   @ PROW()+2,15 SAY+PADC('RELATORIO DE MATRICULAS - Ordenado por serie/grau/nome ',120)
   @ PROW()+1,9 SAY REPL('=',120)
   @ PROW()+1,10 SAY 'NOME                                | MATRICULA | CODIGO  | SERIE | GRAU | DT.NASC    |   IDADE '
   @ PROW(),10 SAY 'NOME                                | MATRICULA | CODIGO  | SERIE | GRAU | DT.NASC    |   IDADE '
   @ PROW(),9 SAY REPL('_',120)
   DO WHILE .NOT. EOF() .AND. NEXTKEY()#27 .AND. PROW()<56
       COTA++
       A:=NOM_ALU
       MAIUSC(,,@A)
       @ PROW()+1,11 SAY A
       @ PROW(),46 SAY '|'
       @ PROW(),50 SAY NUM_MAT
       @ PROW(),PCOL() SAY '/94'
       @ PROW(),58 SAY '!'
       @ PROW(),60 SAY COD_ALU PICT'@R 99999-9'
       @ PROW(),68 SAY '!'
       @ PROW(),70 SAY SERIE PICT'@9'
       @ PROW(),76 SAY '|'
       @ PROW(),78 SAY GRAU  PICT'@9'
       @ PROW(),83 SAY '|'
       @ PROW(),85 SAY NASC_ALU PICT'@D'
       @ PROW(),96 SAY '|'
       SET DECIMAL TO 0
       A:=DATE()-NASC_ALU
       A:=INT(A/365)
       N:=SERIE
       @ PROW(),0 SAY PADL(ALLTRIM(STR(A)),104)
       SKIP
       IF N#SERIE
          @ PROW()+1,9 SAY REPL('- ',60)
       ENDIF
   ENDDO
ENDDO
@ PROW()+1,9 SAY REPL('=',120)
@ PROW()+1,84 SAY 'TOTAL DE MATRICULAS  : '
@ PROW(),PCOL() SAY ALLTRIM(STR(COTA))
IF NEXTKEY()=27
    @ PROW()+1,21 SAY ' *******  CUIDADO - RELATORIO CANCELADO POR PEDIDO USUARIO ANTES DO TERMINO! *******'
    @ PROW(),21   SAY ' *******  CUIDADO - RELATORIO CANCELADO POR PEDIDO USUARIO ANTES DO TERMINO! *******'
ENDIF
EJECT
SET DEVICE TO SCREEN
SET DECIMAL TO 2
SET INDEX TO COMATIND
RETURN



FUNCTION RELA_MOR
IF !ABREARQ('CADMORTO','MORTO','R',3)
   RETURN
ENDIF
SELE MORTO
SET INDEX TO NOMORIND
AGREL()
NPAG:=1
COTA:=0
DO WHILE .NOT. EOF() .AND. NEXTKEY()#27
   CABEIMPRE()
   NPAG++
   @ PROW()+2,15 SAY+PADC('RELACAO DO ARQUIVO MORTO - Ordem alfabetica',120)
   @ PROW()+1,9 SAY REPL('=',120)
   @ PROW()+1,20 SAY 'NOME                                |  ANO  | CX. | PASTA '
   @ PROW(),20 SAY   'NOME                                |  ANO  | CX. | PASTA '
   @ PROW(),9 SAY REPL('_',120)
   DO WHILE .NOT. EOF() .AND. NEXTKEY()#27 .AND. PROW()<56
       COTA++
       A:=NOME
       MAIUSC(,,@A)
       @ PROW()+1,21 SAY A
       @ PROW(),56 SAY '|'
       @ PROW(),59 SAY ANO
       @ PROW(),64 SAY '!'
       @ PROW(),66 SAY CAIXA
       @ PROW(),70 SAY '!'
       @ PROW(),72 SAY PASTA
       SKIP
   ENDDO
ENDDO
@ PROW()+1,9 SAY REPL('=',120)
@ PROW()+1,9 SAY PADL('TOTAL ........: '+TRANSFORM(COTA, '@R 99999'),120)
IF NEXTKEY()=27
    @ PROW()+1,21 SAY ' *******  CUIDADO - RELATORIO CANCELADO POR PEDIDO USUARIO ANTES DO TERMINO! *******'
    @ PROW(),21   SAY ' *******  CUIDADO - RELATORIO CANCELADO POR PEDIDO USUARIO ANTES DO TERMINO! *******'
ENDIF
EJECT
SET DEVICE TO SCREEN
SET DECIMAL TO 2
RETURN



FUNCTION REL_MATBOL
IF !ABREARQ('CADMATRI','CADA_MAT','R',3)
   RETURN
ENDIF
NOMTELA('RELATORIO DE BOLSISTA SEC')
OP:=' '
TELA(4,20,6,60)
@ 5,22 SAY 'Ordenar por:1=Nome  2=N.Autorizacao ' GET OP PICT'9' VALID(OP$ '12')
READ
IF OP$'1'
    NOMTELA('RELATORIO DE BOLSISTA SEC - ORDENADO POR NOME')
   SET INDEX TO NOMATIND
ELSEIF OP$'2'
    NOMTELA('RELATORIO DE BOLSISTA SEC - ORDENADO POR N.AUTORIZACAO SEC')
   SET INDEX TO BOMATIND
ENDIF
TELA(4,20,6,60)
GO TOP
TI:=SPACE(1)
@ 5,22 SAY '1=So inativos  2=Todos  3=So ativos ' GET TI PICT'9' VALID(TI$ '123 ')
READ
IF LASTKEY()=27 .AND. EMPTY(TI)
   RETURN
ENDIF
AGREL()
NPAG:=1
COTA:=0
NUOR:=1
DO WHILE .NOT. EOF() .AND. NEXTKEY()#27
   CABEIMPRE()
   NPAG++
   IF OP$'1' .AND. TI$'1'
     @ PROW()+1,10 SAY+PADC('BOLSISTA DA SEC - ORDEM ALFABETICA - INATIVOS',125)
   ELSEIF OP$'1' .AND. TI$'2'
     @ PROW()+1,10 SAY+PADC('BOLSISTA DA SEC - ORDEM ALFABETICA - GERAL',125)
   ELSEIF OP$'1' .AND. TI$'3'
     @ PROW()+1,10 SAY+PADC('BOLSISTA DA SEC - ORDEM ALFABETICA - ATIVOS',125)
   ELSEIF OP$'2' .AND. TI$'1'
     @ PROW()+1,10 SAY+PADC('BOLSISTA DA SEC - ORDEM N.AUTORIZACAO - INATIVOS',125)
   ELSEIF OP$'2' .AND. TI$'2'
     @ PROW()+1,10 SAY+PADC('BOLSISTA DA SEC - ORDEM N.AUTORIZACAO - GERAL',125)
   ELSEIF OP$'2' .AND. TI$'3'
     @ PROW()+1,10 SAY+PADC('BOLSISTA DA SEC - ORDEM N.AUTORIZACAO - ATIVOS',125)
   ENDIF
   @ PROW()+1,10 SAY REPL('=',125)
   @ PROW()+1,20   SAY 'N.ORD.|N.BOLSA  |  NOME                               | MATRI.|  CODIGO  |SE|G'
   @ PROW(),20     SAY 'N.ORD.|N.BOLSA  |  NOME                               | MATRI.|  CODIGO  |SE|G'
   @ PROW(),10 SAY REPL('_',125)
   DO WHILE .NOT. EOF() .AND. NEXTKEY()#27 .AND. PROW()<56
      IF TI$'1' .AND. SIT_ALUN$'2' .AND. SIT_ECON$'S'
         IF DELETED()
            COTA++
            A:=NOM_ALU
            MAIUSC(,,@A)
            @ PROW()+1,21 SAY STRZERO(NUOR,3,0)
            @ PROW(),25 SAY '|'
            @ PROW(),29 SAY NUM_BOLS
            @ PROW(),36 SAY '|'
            @ PROW(),39 SAY A
            @ PROW(),74 SAY '|'
            @ PROW(),76 SAY NUM_MAT
            @ PROW(),82 SAY '!'
            @ PROW(),84 SAY COD_ALU PICT'@R 99999-9'
            @ PROW(),92 SAY '|'
            @ PROW(),93 SAY SERIE+TURMA
            @ PROW(),96 SAY '|'
            @ PROW(),97 SAY GRAU
            NUOR++
         ENDIF
      ELSEIF TI$'3' .AND. SIT_ALUN$'2' .AND. SIT_ECON$'S'
            COTA++
            A:=NOM_ALU
            MAIUSC(,,@A)
            @ PROW()+1,21 SAY STRZERO(NUOR,3,0)
            @ PROW(),25 SAY '|'
            @ PROW(),29 SAY NUM_BOLS
            @ PROW(),36 SAY '|'
            @ PROW(),39 SAY A
            @ PROW(),74 SAY '|'
            @ PROW(),76 SAY NUM_MAT
            @ PROW(),82 SAY '!'
            @ PROW(),84 SAY COD_ALU PICT'@R 99999-9'
            @ PROW(),92 SAY '|'
            @ PROW(),93 SAY SERIE+TURMA
            @ PROW(),96 SAY '|'
            @ PROW(),97 SAY GRAU
            NUOR++
      ELSEIF TI$'2' .AND. SIT_ALUN$'2' .AND. SIT_ECON$'S'
         IF !DELETED()
            COTA++
            A:=NOM_ALU
            MAIUSC(,,@A)
            @ PROW()+1,21 SAY STRZERO(NUOR,3,0)
            @ PROW(),25 SAY '|'
            @ PROW(),29 SAY NUM_BOLS
            @ PROW(),36 SAY '|'
            @ PROW(),39 SAY A
            @ PROW(),74 SAY '|'
            @ PROW(),76 SAY NUM_MAT
            @ PROW(),82 SAY '!'
            @ PROW(),84 SAY COD_ALU PICT'@R 99999-9'
            @ PROW(),92 SAY '|'
            @ PROW(),93 SAY SERIE+TURMA
            @ PROW(),96 SAY '|'
            @ PROW(),97 SAY GRAU
            NUOR++
         ENDIF
       ENDIF
       SKIP
   ENDDO
ENDDO
@ PROW()+1,10 SAY REPL('=',125)
@ PROW()+1,10 SAY PADL(('TOTAL : '+TRANSFORM(COTA ,'@R 999')),125)
IF NEXTKEY()=27
    @ PROW()+1,5 SAY ' *******  CUIDADO - RELATORIO CANCELADO POR PEDIDO USUARIO ANTES DO TERMINO! *******'
    @   PROW(),5 SAY ' *******  CUIDADO - RELATORIO CANCELADO POR PEDIDO USUARIO ANTES DO TERMINO! *******'
ENDIF
EJECT
SET DEVICE TO SCREEN
SET DECIMAL TO 2
SET INDEX TO COMATIND
RETURN

// ***************   BOLETIM DE SERIE  - EMISSAO GERAL ***************


FUNCTION BOLET_SERIE
IF !ABREARQ('CADMSGEM','CADMSG','R',3)
      RETURN
ENDIF
SET INDEX TO MSGIND
IF !ABREARQ('MATERIAS','MATER','R',3)
       RETURN
ENDIF
IF !ABREARQ('CADNOTAS','NOTA','R',3)
       RETURN
ENDIF
IF !ABREARQ('CADMATRI','CADA_MAT','R',3)
   RETURN
ENDIF
SET INDEX TO GSMATIND
SET ORDER TO 6
CX:=SETCOLOR()
NOMTELA(' EMISSÇO BOLETIM POR SERIE ')
SETCOLOR(GCOR1)
TELA(4,5,8,75)
esm:=2
B:=PROCNAME()
MI:=0
MS:=0
C_ALU:=SPACE(6)
COD_M:=SPACE(4)
M_CO1:=SPACE(120)
M_CO2:=SPACE(120)
@ 5,6 SAY '1>Geral ou 2>Por serie ' GET ESM PICT'9' VALID(ESM=1 .OR. ESM=2 .OR. ESM=0)
@ 6,6 say 'Mensagem: ' GET COD_M PICT'9999' VALID(VER_MSG(1,@M_CO1))
@ 7,6 say 'Mensagem: ' GET COD_M PICT'9999' VALID(VER_MSG(2,@M_CO2))
READ
@ 6,21 say M_CO1 PICT'@S50!'
@ 7,21 say M_CO2 PICT'@S50!'
IF LASTKEY()=27
   RETURN
ELSEIF ESM=2
   TELA(8,20,10,60)
   SOMBRA(8,20,10,60)
   SE:=' '
   GR:=' '
   TU:=' '
   CO:=0
   NBPAG:=0
   MI:=0
   MS:=0
   @ 9,24      SAY 'Grau: ' GET GR PICT'@R 9' VALID(GR$ '12')
   @ 9,COL()+2 SAY 'S‚rie: ' GET SE PICT'@R 9' VALID(SE$ '12345678')
   @ 9,COL()+2 SAY 'Turma: ' GET TU PICT'@S1!' VALID(TU$ 'ABCUE')
   READ
   IF LASTKEY()=27
      RETURN
   ENDIF
ELSE
  RELBO_GERAL()
  RETURN
ENDIF
AGREL()
SET DECIMAL TO 2
SET DEVICE TO PRINTER
DO WHILE .NOT. EOF()
        IMS:=0
        IMI:=0
        IF CADA_MAT->GRAU$GR .AND. CADA_MAT->SERIE$SE .AND. CADA_MAT->TURMA$TU
            NBPAG++
            IF NBPAG=3
               NBPAG:=1
               SETPRC(54,0)
               EJECT
            ENDIF
            @ PROW(),0 SAY+CHR(18)
            @ PROW()+1,0 SAY+CHR(14)+PADC(NOESC,45)
            @ PROW()+1,0 SAY+CHR(14)+PADC('* BOLETIM ESCOLAR *',45)
            @ PROW(),0   SAY+PADC('* BOLETIM ESCOLAR *',45)
            @ PROW(),0 SAY+CHR(18)
            @ PROW()+1,5 SAY REPL('=',78)
            @ PROW()+1,5 SAY 'Aluno: '
            @ PROW(),12 SAY CADA_MAT->COD_ALU PICT'@R 99999-9'
            A:=CADA_MAT->NOM_ALU
            MAIUSC(,,@A)
            B:=CADA_MAT->COD_ALU
            @ PROW(),20 SAY A
            @ PROW(),20 SAY A
            @ PROW(),20 SAY A
            @ PROW(),56 SAY 'Serie:'+CADA_MAT->SERIE+CADA_MAT->TURMA+' - Grau:'+CADA_MAT->GRAU+'  No.:'+CADA_MAT->NUCLASSE
            @ PROW()+1,5 SAY REPL('-',78)
            @ PROW(),0 SAY CHR(15)
            @ PROW()+1,9 SAY 'Disciplina             | 1.Bim.  |Recup.1B | 2.Bim.  | Recup.2B| 3.Bim.  | Recup.3b| 4.Bim.  | Recup.4B|Rec.Final|RESULTADO'
            @ PROW(),9   SAY+REPL('_',128)
            @ PROW()+1,9 SAY '                       |Notas| F |Notas| F |Notas| F |Notas| F |Notas| F |Notas| F |Notas| F |Notas| F |Notas| F|Notas| TF'
            @ PROW(),9   SAY+REPL('_',128)
            SELE NOTA
            GO TOP
            DO WHILE .NOT. EOF() .AND. NEXTKEY()#27
               IF NOTA->COD_ALU$B
                  C:=NOTA->MAT_NOT
                  SELE MATER
                  SET INDEX TO MATECIND
                  GO TOP
                  SEEK C
                  D:=MATER->MATERIA
                  @ PROW()+1,9 SAY LEFT(D,20)
                  SELE NOTA
                  IF NOTA->NB1#NIL
                     @ PROW(),33 SAY IF(NOTA->NB1#0,NOTA->NB1,' ### ')
                     @ PROW(),39 SAY IF(NOTA->FN1#0,TRANSFORM(NOTA->FN1,'99'),' ##')
                   ENDIF
                  IF NOTA->NR1#NIL
                     @ PROW(),43 SAY IF(NOTA->NR1#0,NOTA->NR1,' ### ')
                     @ PROW(),49 SAY IF(NOTA->FR1#0,TRANSFORM(NOTA->FR1,'99'),' ##')
                   ENDIF
                   IF NOTA->NB2#NIL
                     @ PROW(),53 SAY IF(NOTA->NB2#0,NOTA->NB2,' ### ')
                     @ PROW(),59 SAY IF(NOTA->FN2#0,TRANSFORM(NOTA->FN2,'99'),' ##')
                   ENDIF
                   IF NOTA->NR2#NIL
                     @ PROW(),63 SAY IF(NOTA->NR2#0,NOTA->NR2,' ### ')
                     @ PROW(),69 SAY IF(NOTA->FR2#0,TRANSFORM(NOTA->FR2,'99'),' ##')
                   ENDIF
                   IF NOTA->NB3#NIL
                     @ PROW(),73 SAY IF(NOTA->NB3#0,NOTA->NB3,' ### ')
                     @ PROW(),79 SAY IF(NOTA->FN3#0,TRANSFORM(NOTA->FN3,'99'),' ##')
                   ENDIF
                   IF NOTA->NR3#NIL
                     @ PROW(),83 SAY IF(NOTA->NR3#0,NOTA->NR3,' ### ')
                     @ PROW(),89 SAY IF(NOTA->FR3#0,TRANSFORM(NOTA->FR3,'99'),' ##')
                   ENDIF
                   IF NOTA->NB4#NIL
                     @ PROW(),93 SAY IF(NOTA->NB4#0,NOTA->NB4,' ### ')
                     @ PROW(),99 SAY IF(NOTA->FN4#0,TRANSFORM(NOTA->FN4,'99'),' ##')
                   ENDIF
                   IF NOTA->NR4#NIL
                     @ PROW(),103 SAY IF(NOTA->NR4#0,NOTA->NR4,' ### ')
                     @ PROW(),109 SAY IF(NOTA->FR4#0,TRANSFORM(NOTA->FR4,'99'),' ##')
                   ENDIF
                   IF NOTA->NRF#NIL
                     @ PROW(),113 SAY IF(NOTA->NRF#0,NOTA->NRF,' ### ')
                     @ PROW(),119 SAY IF(NOTA->FRF#0,TRANSFORM(NOTA->FRF,'99'),' ##')
                   ENDIF
                   IF NOTA->RFN#NIL
                     @ PROW(),123 SAY IF(NOTA->RFN#0,NOTA->RFN,' ### ')
                     @ PROW(),129 SAY IF(NOTA->RFF#0,TRANSFORM(NOTA->RFF,'99'),' ##')
                   ENDIF
                  @ PROW(),9 SAY '                       |     |   |     |   |     |   |     |   |     |   |     |   |     |   |     |   |     |   |     |  '
                  @ PROW(),9   SAY+REPL('_',128)
              ENDIF
            SKIP
           ENDDO
        SELE NOTA
        GO TOP
        IF !EMPTY(M_CO1)
            @ PROW()+2,9  SAY+REPL('-',128)
            @ PROW()+1,9  SAY M_CO1
            @ PROW()+1,9  SAY+M_CO2
            @ PROW()+1,9  SAY+REPL('=',128)
        ELSE
            @ PROW()+2,9  SAY+REPL('-',128)
        ENDIF
        MI:=0
        MS:=0
        @ PROW()+3,0 SAY ' '
     ENDIF
     SELE CADA_MAT
     SKIP
    IF EOF()=.T.
       EXIT
    ENDIF
ENDDO
SETPRC(54,0)
IF NEXTKEY()=27
    @ PROW()+1,21 SAY ' *******  CUIDADO - RELATORIO CANCELADO POR PEDIDO USUARIO ANTES DO TERMINO! *******'
    @ PROW(),21   SAY ' *******  CUIDADO - RELATORIO CANCELADO POR PEDIDO USUARIO ANTES DO TERMINO! *******'
ENDIF
EJECT
SET DEVICE TO SCREEN
SETCOLOR(CX)
RETURN




FUNCTION RELBO_GERAL
IF !ABREARQ('CADNOTAS','NOTA','R',3)
       RETURN
ENDIF
IF !ABREARQ('MATERIAS','MATER','R',3)
       RETURN
ENDIF
IF !ABREARQ('CADMATRI','CADA_MAT','R',3)
   RETURN
ENDIF
SET INDEX TO GSMATIND
SET ORDER TO 6
AGREL()
SET DECIMAL TO 2
SET DEVICE TO PRINTER
DO WHILE .NOT. EOF()
        IMS:=0
        IMI:=0
            NBPAG++
            IF NBPAG=3
               NBPAG:=1
               SETPRC(54,0)
               EJECT
            ENDIF
            @ PROW(),0 SAY+CHR(18)
            @ PROW()+1,0 SAY+CHR(14)+PADC(NOESC,45)
            @ PROW()+1,0 SAY+CHR(14)+PADC('* BOLETIM ESCOLAR *',45)
            @ PROW(),0   SAY+PADC('* BOLETIM ESCOLAR *',45)
            @ PROW(),0 SAY+CHR(18)
            @ PROW()+1,5 SAY REPL('=',78)
            @ PROW()+1,5 SAY 'Aluno: '
            @ PROW(),12 SAY CADA_MAT->COD_ALU PICT'@R 99999-9'
            A:=CADA_MAT->NOM_ALU
            MAIUSC(,,@A)
            B:=CADA_MAT->COD_ALU
            @ PROW(),20 SAY A
            @ PROW(),20 SAY A
            @ PROW(),20 SAY A
            @ PROW(),56 SAY 'Serie:'+CADA_MAT->SERIE+CADA_MAT->TURMA+' - Grau:'+CADA_MAT->GRAU+'  No.:'+CADA_MAT->NUCLASSE
            @ PROW()+1,5 SAY REPL('-',78)
            @ PROW(),0 SAY CHR(15)
            @ PROW()+1,9 SAY 'Disciplina             | 1.Bim.  |Recup.1B | 2.Bim.  | Recup.2B| 3.Bim.  | Recup.3b| 4.Bim.  | Recup.4B|Rec.Final|RESULTADO'
            @ PROW(),9   SAY+REPL('_',128)
            @ PROW()+1,9 SAY '                       |Notas| F |Notas| F |Notas| F |Notas| F |Notas| F |Notas| F |Notas| F |Notas| F |Notas| F|Notas| TF'
            @ PROW(),9   SAY+REPL('_',128)
            SELE NOTA
            GO TOP
            DO WHILE .NOT. EOF() .AND. NEXTKEY()#27
               IF NOTA->COD_ALU$B
                  C:=NOTA->MAT_NOT
                  SELE MATER
                  SET INDEX TO MATECIND
                  SEEK C
                  D:=MATER->MATERIA
                  @ PROW()+1,9 SAY LEFT(D,20)
                  SELE NOTA
                  IF NOTA->NB1#NIL
                     @ PROW(),33 SAY IF(NOTA->NB1#0,NOTA->NB1,' ### ')
                     @ PROW(),39 SAY IF(NOTA->FN1#0,TRANSFORM(NOTA->FN1,'99'),' ##')
                   ENDIF
                  IF NOTA->NR1#NIL
                     @ PROW(),43 SAY IF(NOTA->NR1#0,NOTA->NR1,' ### ')
                     @ PROW(),49 SAY IF(NOTA->FR1#0,TRANSFORM(NOTA->FR1,'99'),' ##')
                   ENDIF
                   IF NOTA->NB2#NIL
                     @ PROW(),53 SAY IF(NOTA->NB2#0,NOTA->NB2,' ### ')
                     @ PROW(),59 SAY IF(NOTA->FN2#0,TRANSFORM(NOTA->FN2,'99'),' ##')
                   ENDIF
                   IF NOTA->NR2#NIL
                     @ PROW(),63 SAY IF(NOTA->NR2#0,NOTA->NR2,' ### ')
                     @ PROW(),69 SAY IF(NOTA->FR2#0,TRANSFORM(NOTA->FR2,'99'),' ##')
                   ENDIF
                   IF NOTA->NB3#NIL
                     @ PROW(),73 SAY IF(NOTA->NB3#0,NOTA->NB3,' ### ')
                     @ PROW(),79 SAY IF(NOTA->FN3#0,TRANSFORM(NOTA->FN3,'99'),' ##')
                   ENDIF
                   IF NOTA->NR3#NIL
                     @ PROW(),83 SAY IF(NOTA->NR3#0,NOTA->NR3,' ### ')
                     @ PROW(),89 SAY IF(NOTA->FR3#0,TRANSFORM(NOTA->FR3,'99'),' ##')
                   ENDIF
                   IF NOTA->NB4#NIL
                     @ PROW(),93 SAY IF(NOTA->NB4#0,NOTA->NB4,' ### ')
                     @ PROW(),99 SAY IF(NOTA->FN4#0,TRANSFORM(NOTA->FN4,'99'),' ##')
                   ENDIF
                   IF NOTA->NR4#NIL
                     @ PROW(),103 SAY IF(NOTA->NR4#0,NOTA->NR4,' ### ')
                     @ PROW(),109 SAY IF(NOTA->FR4#0,TRANSFORM(NOTA->FR4,'99'),' ##')
                   ENDIF
                   IF NOTA->NRF#NIL
                     @ PROW(),113 SAY IF(NOTA->NRF#0,NOTA->NRF,' ### ')
                     @ PROW(),119 SAY IF(NOTA->FRF#0,TRANSFORM(NOTA->FRF,'99'),' ##')
                   ENDIF
                   IF NOTA->RFN#NIL
                     @ PROW(),123 SAY IF(NOTA->RFN#0,NOTA->RFN,' ### ')
                     @ PROW(),129 SAY IF(NOTA->RFF#0,TRANSFORM(NOTA->RFF,'99'),' ##')
                   ENDIF
                  @ PROW(),9 SAY '                       |     |   |     |   |     |   |     |   |     |   |     |   |     |   |     |   |     |   |     |  '
                  @ PROW(),9   SAY+REPL('_',128)
              ENDIF
            SKIP
           ENDDO
        SELE NOTA
        GO TOP
        IF !EMPTY(M_CO1)
            @ PROW()+2,9  SAY+REPL('-',128)
            @ PROW()+1,9  SAY M_CO1
            @ PROW()+1,9  SAY+M_CO2
            @ PROW()+1,9  SAY+REPL('=',128)
        ELSE
            @ PROW()+2,9  SAY+REPL('-',128)
        ENDIF
        MI:=0
        MS:=0
        @ PROW()+3,0 SAY ' '
     SELE CADA_MAT
     SKIP
    IF EOF()=.T.
       EXIT
    ENDIF
ENDDO
SETPRC(54,0)
IF NEXTKEY()=27
    @ PROW()+1,21 SAY ' *******  CUIDADO - RELATORIO CANCELADO POR PEDIDO USUARIO ANTES DO TERMINO! *******'
    @ PROW(),21   SAY ' *******  CUIDADO - RELATORIO CANCELADO POR PEDIDO USUARIO ANTES DO TERMINO! *******'
ENDIF
EJECT
SET DEVICE TO SCREEN
RETURN






FUNCTION BOLET_SEC
IF !ABREARQ('CADNOTAS','NOTA','R',3)
       RETURN
ENDIF
IF !ABREARQ('MATERIAS','MATER','R',3)
       RETURN
ENDIF
IF !ABREARQ('CADMATRI','CADA_MAT','R',3)
   RETURN
ENDIF
SET INDEX TO GSMATIND
SET ORDER TO 6
CX:=SETCOLOR()
NOMTELA(' EMISSÇO BOLETIM POR SERIE PARA SECRETARIA')
TELA(4,20,7,60)
SOMBRA(4,20,7,60)
SETCOLOR(GCOR3)
SE:=' '
GR:=' '
TU:=' '
CO:=0
NBPAG:=0
MI:=0
MS:=0
@ 5,24      SAY 'Grau: ' GET GR PICT'@R 9' VALID(GR$ '12')
@ 5,COL()+2 SAY 'S‚rie: ' GET SE PICT'@R 9' VALID(SE$ '12345678')
@ 5,COL()+2 SAY 'Turma: ' GET TU PICT'@S1!' VALID(TU$ 'ABCUE')
READ
IF LASTKEY()=27
      RETURN
ENDIF
AGREL()
SET DECIMAL TO 2
SET DEVICE TO PRINTER
DO WHILE .NOT. EOF()
        IF CADA_MAT->GRAU$GR .AND. CADA_MAT->SERIE$SE .AND. CADA_MAT->TURMA$TU
            NBPAG++
            IF NBPAG=4
               NBPAG:=1
               SETPRC(54,0)
               EJECT
               @ PROW()+1,0 SAY+CHR(18)+PADC('RELATORIO DE BOLETINS POR SERIE - SECRETARIA',80)
            ENDIF
            @ PROW(),0 SAY+CHR(18)
            @ PROW()+1,5 SAY REPL('=',78)
            @ PROW()+1,5 SAY 'Aluno: '
            @ PROW(),12 SAY IF(DELETED(),'$','')
            @ PROW(),13 SAY CADA_MAT->COD_ALU PICT'@R 99999-9'
            A:=CADA_MAT->NOM_ALU
            MAIUSC(,,@A)
            B:=CADA_MAT->COD_ALU
            @ PROW(),21 SAY A
            @ PROW(),21 SAY A
            @ PROW(),21 SAY A
            @ PROW(),56 SAY 'Serie:'+CADA_MAT->SERIE+CADA_MAT->TURMA+' - Grau:'+CADA_MAT->GRAU+'  No.:'+CADA_MAT->NUCLASSE
            @ PROW()+1,5 SAY REPL('-',78)
            @ PROW(),0 SAY CHR(15)
            @ PROW()+1,9 SAY 'Disciplina             | 1.Bim.  |Recup.1B | 2.Bim.  | Recup.2B| 3.Bim.  | Recup.3b| 4.Bim.  | Recup.4B|Rec.Final|RESULTADO'
            @ PROW(),9   SAY+REPL('_',128)
            @ PROW()+1,9 SAY '                       |Notas| F |Notas| F |Notas| F |Notas| F |Notas| F |Notas| F |Notas| F |Notas| F |Notas| F |Notas| TF'
            @ PROW(),9   SAY+REPL('_',128)
            SELE NOTA
            GO TOP
            DO WHILE .NOT. EOF() .AND. NEXTKEY()#27
               IF NOTA->COD_ALU$B
                  C:=NOTA->MAT_NOT
                  SELE MATER
                  SET INDEX TO MATECIND
                  SEEK C
                  D:=MATER->MATERIA
                  @ PROW()+1,9 SAY LEFT(D,20)
                  SELE NOTA
                  IF NOTA->NB1#NIL
                     @ PROW(),33 SAY IF(NOTA->NB1#0,NOTA->NB1,' ### ')
                     @ PROW(),39 SAY IF(NOTA->FN1#0,TRANSFORM(NOTA->FN1,'99'),' ##')
                   ENDIF
                  IF NOTA->NR1#NIL
                     @ PROW(),43 SAY IF(NOTA->NR1#0,NOTA->NR1,' ### ')
                     @ PROW(),49 SAY IF(NOTA->FR1#0,TRANSFORM(NOTA->FR1,'99'),' ##')
                   ENDIF
                   IF NOTA->NB2#NIL
                     @ PROW(),53 SAY IF(NOTA->NB2#0,NOTA->NB2,' ### ')
                     @ PROW(),59 SAY IF(NOTA->FN2#0,TRANSFORM(NOTA->FN2,'99'),' ##')
                   ENDIF
                   IF NOTA->NR2#NIL
                     @ PROW(),63 SAY IF(NOTA->NR2#0,NOTA->NR2,' ### ')
                     @ PROW(),69 SAY IF(NOTA->FR2#0,TRANSFORM(NOTA->FR2,'99'),' ##')
                   ENDIF
                   IF NOTA->NB3#NIL
                     @ PROW(),73 SAY IF(NOTA->NB3#0,NOTA->NB3,' ### ')
                     @ PROW(),79 SAY IF(NOTA->FN3#0,TRANSFORM(NOTA->FN3,'99'),' ##')
                   ENDIF
                   IF NOTA->NR3#NIL
                     @ PROW(),83 SAY IF(NOTA->NR3#0,NOTA->NR3,' ### ')
                     @ PROW(),89 SAY IF(NOTA->FR3#0,TRANSFORM(NOTA->FR3,'99'),' ##')
                   ENDIF
                   IF NOTA->NB4#NIL
                     @ PROW(),93 SAY IF(NOTA->NB4#0,NOTA->NB4,' ### ')
                     @ PROW(),99 SAY IF(NOTA->FN4#0,TRANSFORM(NOTA->FN4,'99'),' ##')
                   ENDIF
                   IF NOTA->NR4#NIL
                     @ PROW(),103 SAY IF(NOTA->NR4#0,NOTA->NR4,' ### ')
                     @ PROW(),109 SAY IF(NOTA->FR4#0,TRANSFORM(NOTA->FR4,'99'),' ##')
                   ENDIF
                   IF NOTA->NRF#NIL
                     @ PROW(),113 SAY IF(NOTA->NRF#0,NOTA->NRF,' ### ')
                     @ PROW(),119 SAY IF(NOTA->FRF#0,TRANSFORM(NOTA->FRF,'99'),' ##')
                   ENDIF
                   IF NOTA->RFN#NIL
                     @ PROW(),123 SAY IF(NOTA->RFN#0,NOTA->RFN,' ### ')
                     @ PROW(),129 SAY IF(NOTA->RFF#0,TRANSFORM(NOTA->RFF,'99'),' ##')
                   ENDIF
                  @ PROW(),9 SAY '                       |     |   |     |   |     |   |     |   |     |   |     |   |     |   |     |   |     |   |     |  '
                  @ PROW(),9   SAY+REPL('_',128)
              ENDIF
            SKIP
           ENDDO
        SELE NOTA
        @ PROW()+2,9  SAY+REPL('=',128)
        @ PROW()+3,0 SAY ' '
     ENDIF
     SELE CADA_MAT
     SKIP
    IF EOF()=.T.
       EXIT
    ENDIF
ENDDO
SETPRC(54,0)
IF NEXTKEY()=27
    @ PROW()+1,21 SAY ' *******  CUIDADO - RELATORIO CANCELADO POR PEDIDO USUARIO ANTES DO TERMINO! *******'
    @ PROW(),21   SAY ' *******  CUIDADO - RELATORIO CANCELADO POR PEDIDO USUARIO ANTES DO TERMINO! *******'
ENDIF
EJECT
SET DEVICE TO SCREEN
SETCOLOR(CX)
RETURN


FUNCTION BOLET_ALUNO
IF !ABREARQ('CADMSGEM','CADMSG','R',3)
      RETURN
ENDIF
SET INDEX TO MSGIND
IF !ABREARQ('CADNOTAS','NOTA','R',3)
       RETURN
ENDIF
IF !ABREARQ('MATERIAS','MATER','R',3)
       RETURN
ENDIF
IF !ABREARQ('CADMATRI','CADA_MAT','R',3)
   RETURN
ENDIF
CX:=SETCOLOR()
SELE CADA_MAT
SET INDEX TO COMATIND
NOMTELA(' EMISSÇO BOLETIM POR ALUNO ')
TELA(4,5,8,75)
SETCOLOR(GCOR1)
B:=PROCNAME()
MI:=0
MS:=0
C_ALU:=SPACE(6)
COD_M:='0000'
M_CO1:=SPACE(120)
M_CO2:=SPACE(120)
@ 5,6 SAY 'C¢d.Aluno: ' GET C_ALU PICT'@R 99999-9' VALID(VER_6())
@ 6,6 say 'Mensagem: ' GET COD_M PICT'9999' VALID(VER_MSG(1,@M_CO1))
@ 7,6 say 'Mensagem: ' GET COD_M PICT'9999' VALID(VER_MSG(2,@M_CO2))
READ
@ 6,21 say M_CO1 PICT'@S50!'
@ 7,21 say M_CO2 PICT'@S50!'
IF LASTKEY()=27 .OR. EMPTY(C_ALU)
   RETURN
ENDIF
AGREL()
SET DECIMAL TO 2
SET DEVICE TO PRINTER
@ PROW(),0 SAY+CHR(18)
@ PROW()+1,0 SAY+CHR(14)+PADC(NOESC,45)
@ PROW()+1,0 SAY+CHR(14)+PADC('* BOLETIM ESCOLAR *',45)
@ PROW(),0   SAY+PADC('* BOLETIM ESCOLAR *',45)
@ PROW(),0 SAY+CHR(18)
@ PROW()+1,5 SAY REPL('=',78)
@ PROW()+1,5 SAY 'Aluno: '
@ PROW(),12 SAY CADA_MAT->COD_ALU PICT'@R 99999-9'
A:=CADA_MAT->NOM_ALU
MAIUSC(,,@A)
B:=CADA_MAT->COD_ALU
@ PROW(),20 SAY A
@ PROW(),20 SAY A
@ PROW(),20 SAY A
@ PROW(),56 SAY 'Serie:'+CADA_MAT->SERIE+CADA_MAT->TURMA+' - Grau:'+CADA_MAT->GRAU+'  No.:'+CADA_MAT->NUCLASSE
@ PROW()+1,5 SAY REPL('-',78)
@ PROW(),0 SAY CHR(15)
@ PROW()+1,9 SAY 'Disciplina             | 1.Bim.  |Recup.1B | 2.Bim.  | Recup.2B| 3.Bim.  | Recup.3b| 4.Bim.  | Recup.4B|Rec.Final|RESULTADO'
@ PROW(),9   SAY+REPL('_',128)
@ PROW()+1,9 SAY '                       |Notas| F |Notas| F |Notas| F |Notas| F |Notas| F |Notas| F |Notas| F |Notas| F |Notas| F |Notas| TF'
@ PROW(),9   SAY+REPL('_',128)
SELE NOTA
DO WHILE .NOT. EOF() .AND. NEXTKEY()#27
   IF NOTA->COD_ALU$B
       C:=NOTA->MAT_NOT
       SELE MATER
       SET INDEX TO MATECIND
       SEEK C
       D:=MATER->MATERIA
       @ PROW()+1,9 SAY LEFT(D,20)
       SELE NOTA
                  IF NOTA->NB1#NIL
                     @ PROW(),33 SAY IF(NOTA->NB1#0,NOTA->NB1,' ### ')
                     @ PROW(),39 SAY IF(NOTA->FN1#0,TRANSFORM(NOTA->FN1,'99'),' ##')
                   ENDIF
                  IF NOTA->NR1#NIL
                     @ PROW(),43 SAY IF(NOTA->NR1#0,NOTA->NR1,' ### ')
                     @ PROW(),49 SAY IF(NOTA->FR1#0,TRANSFORM(NOTA->FR1,'99'),' ##')
                   ENDIF
                   IF NOTA->NB2#NIL
                     @ PROW(),53 SAY IF(NOTA->NB2#0,NOTA->NB2,' ### ')
                     @ PROW(),59 SAY IF(NOTA->FN2#0,TRANSFORM(NOTA->FN2,'99'),' ##')
                   ENDIF
                   IF NOTA->NR2#NIL
                     @ PROW(),63 SAY IF(NOTA->NR2#0,NOTA->NR2,' ### ')
                     @ PROW(),69 SAY IF(NOTA->FR2#0,TRANSFORM(NOTA->FR2,'99'),' ##')
                   ENDIF
                   IF NOTA->NB3#NIL
                     @ PROW(),73 SAY IF(NOTA->NB3#0,NOTA->NB3,' ### ')
                     @ PROW(),79 SAY IF(NOTA->FN3#0,TRANSFORM(NOTA->FN3,'99'),' ##')
                   ENDIF
                   IF NOTA->NR3#NIL
                     @ PROW(),83 SAY IF(NOTA->NR3#0,NOTA->NR3,' ### ')
                     @ PROW(),89 SAY IF(NOTA->FR3#0,TRANSFORM(NOTA->FR3,'99'),' ##')
                   ENDIF
                   IF NOTA->NB4#NIL
                     @ PROW(),93 SAY IF(NOTA->NB4#0,NOTA->NB4,' ### ')
                     @ PROW(),99 SAY IF(NOTA->FN4#0,TRANSFORM(NOTA->FN4,'99'),' ##')
                   ENDIF
                   IF NOTA->NR4#NIL
                     @ PROW(),103 SAY IF(NOTA->NR4#0,NOTA->NR4,' ### ')
                     @ PROW(),109 SAY IF(NOTA->FR4#0,TRANSFORM(NOTA->FR4,'99'),' ##')
                   ENDIF
                   IF NOTA->NRF#NIL
                     @ PROW(),113 SAY IF(NOTA->NRF#0,NOTA->NRF,' ### ')
                     @ PROW(),119 SAY IF(NOTA->FRF#0,TRANSFORM(NOTA->FRF,'99'),' ##')
                   ENDIF
                   IF NOTA->RFN#NIL
                     @ PROW(),123 SAY IF(NOTA->RFN#0,NOTA->RFN,' ### ')
                     @ PROW(),129 SAY IF(NOTA->RFF#0,TRANSFORM(NOTA->RFF,'99'),' ##')
                   ENDIF
                  @ PROW(),9 SAY '                       |     |   |     |   |     |   |     |   |     |   |     |   |     |   |     |   |     |   |     |  '
                  @ PROW(),9   SAY+REPL('_',128)
              ENDIF
 SKIP
ENDDO
SELE NOTA
GO TOP
IF !EMPTY(M_CO1)
    @ PROW()+2,9  SAY+REPL('-',128)
    @ PROW()+1,9  SAY M_CO1
    @ PROW()+1,9  SAY+M_CO2
    @ PROW()+1,9  SAY+REPL('=',128)
ELSE
    @ PROW()+2,9  SAY+REPL('-',128)
ENDIF
@ 0,0 SAY ' '
IF NEXTKEY()=27
    @ PROW()+1,21 SAY ' *******  CUIDADO - RELATORIO CANCELADO POR PEDIDO USUARIO ANTES DO TERMINO! *******'
    @ PROW(),21   SAY ' *******  CUIDADO - RELATORIO CANCELADO POR PEDIDO USUARIO ANTES DO TERMINO! *******'
ENDIF
SET DEVICE TO SCREEN
SETCOLOR(CX)
RETURN




FUNCTION RELBO_PAI
IF !ABREARQ('CADMSGEM','CADMSG','R',3)
      RETURN
ENDIF
SET INDEX TO MSGIND
IF !ABREARQ('CADNOTAS','NOTA','R',3)
       RETURN
ENDIF
IF !ABREARQ('MATERIAS','MATER','R',3)
       RETURN
ENDIF
IF !ABREARQ('CADMATRI','CADA_MAT','R',3)
   RETURN
ENDIF
SET INDEX TO GSMATIND
SET ORDER TO 6
CX:=SETCOLOR()
SETCOLOR(GCOR2)
NOMTELA(' EMISSÇO BOLETIM PARA OS PAIS ')
TELA(4,5,9,75)
SOMBRA(4,5,9,75)
SETCOLOR(GCOR1)
IBO:=' '
IBS:=' '
B:=PROCNAME()
C_ALU:=SPACE(6)
COD_M:='0000'
M_CO1:=SPACE(120)
M_CO2:=SPACE(120)
@ 5,6 SAY 'ImpressÆo de BOLETINS ou CAPA (B/C):' GET IBO PICT'@S1!' VALID(IBO$ 'BC ')
@ 6,6 SAY 'Por s‚rie ou Aluno : (S/A) ' GET IBS PICT'@S1!' VALID(IBS$ 'S/A ')
@ 7,6 say 'Mensagem: ' GET COD_M PICT'9999' WHEN IBO#'C' VALID(VER_MSG(1,@M_CO1))
@ 8,6 say 'Mensagem: ' GET COD_M PICT'9999' WHEN IBO#'C' VALID(VER_MSG(2,@M_CO2))
READ
IF IBO#'C'
   @ 7,21 say M_CO1 PICT'@S50!'
   @ 8,21 say M_CO2 PICT'@S50!'
ENDIF
IF LASTKEY()=27 .OR. EMPTY(IBO) .OR. EMPTY(IBS)
   RETURN
ENDIF
IF IBO$'B' .AND. IBS$'S'
   NOMTELA(' EMISSÇO BOLETIM PARA OS PAIS POR SERIE')
   TELA(10,20,12,60)
   SOMBRA(10,20,12,60)
   SE:=' '
   GR:=' '
   TU:=' '
   CO:=0
   NBPAG:=0
   @ 11,24      SAY 'Grau: ' GET GR PICT'9' VALID(GR$ '12')
   @ 11,COL()+2 SAY 'S‚rie: ' GET SE PICT'9' VALID(SE$ '12345678')
   @ 11,COL()+2 SAY 'Turma: ' GET TU PICT'@S1!' VALID(TU$ 'ABCUE')
   READ
   IF LASTKEY()=27
      RETURN
   ENDIF
   AGREL ()
   SET DECIMAL TO 2
   SET DEVICE TO PRINTER
   DO WHILE .NOT. EOF()
        IF CADA_MAT->GRAU$GR .AND. CADA_MAT->SERIE$SE .AND. CADA_MAT->TURMA$TU
            @ PROW(),0 SAY+CHR(18)+' '
            @ PROW()+1,0 SAY+CHR(14)+PADC(NOESC,44)
            @ PROW()+1,0 SAY+CHR(14)+PADC('===========================',44)
            @ PROW()+2,0 SAY+CHR(18)
            @ PROW()+2,40   SAY ' '
            @ PROW(),PCOL() SAY DATE()
            @ PROW()+3,5   SAY 'Prezado(a) Sr.(a). :'
            A1:=CADA_MAT->NOM_RESP
            A2:=CADA_MAT->END_RESP
            A3:=CADA_MAT->BAI_RESP
            A4:=RTRIM(CADA_MAT->CID_RESP)
            A5:=' - '+CADA_MAT->UF_RESP
            MAIUSC(,,@A1)
            MAIUSC(,,@A2)
            MAIUSC(,,@A3)
            MAIUSC(,,@A4)
            @ PROW()+1,5   SAY  IF(A1#'NIL',A1,'')
            @ PROW()+1,5   SAY  IF(A2#'NIL',A2,'')
            @ PROW()+1,5   SAY  IF(A3#'NIL',A3,'')
            @ PROW()+1,5   SAY  IF(A4#'NIL',A4,'')
            @ PROW(),PCOL()+2 SAY IF(A5#'NIL',A5,'')
            @ PROW()+3,10 SAY 'Senhores Pais ou Responsaveis, '
            @ PROW()+2,10 SAY 'Segue abaixo o Boletim Escolar de vosso filho(a) ou tutelado(a) ,'
            @ PROW()+1,5  SAY 'contendo o desempenho do(a) mesmo(a).                           '
            @ PROW()+2,10 SAY 'A'+NOESC+' decidiu prestar mais esse servico a'
            @ PROW()+1,5  SAY 'vossa Senhoria a fim de que tome conhecimento  das  notas , assim sen-'
            @ PROW()+1,5  SAY 'do, tambem participe da formacao do(a) aluno(a). '
            @ PROW()+2,10 SAY 'Este BOLETIM ESCOLAR e para seu controle, nao sendo necessaria  a'
            @ PROW()+1,5 SAY 'devolucao.                                                       '
            @ PROW()+1,10 SAY '                Modernizando-se para melhor servir!!!  '
            @ PROW()+3,0 SAY+PADC('* BOLETIM ESCOLAR *',80)
            @ PROW(),0   SAY+PADC('* BOLETIM ESCOLAR *',80)
            @ PROW()+1,5 SAY REPL('=',78)
            @ PROW()+1,5 SAY 'Aluno: '
            @ PROW(),12 SAY CADA_MAT->COD_ALU PICT'@R 99999-9'
            A:=CADA_MAT->NOM_ALU
            MAIUSC(,,@A)
            B:=CADA_MAT->COD_ALU
            @ PROW(),20 SAY A
            @ PROW(),20 SAY A
            @ PROW(),20 SAY A
            @ PROW(),56 SAY 'Serie:'+CADA_MAT->SERIE+CADA_MAT->TURMA+' - Grau:'+CADA_MAT->GRAU+'  No.:'+CADA_MAT->NUCLASSE
            @ PROW()+1,5 SAY REPL('-',78)
            @ PROW(),0 SAY CHR(15)
            @ PROW()+1,9 SAY 'Disciplina             | 1.Bim.  |Recup.1B | 2.Bim.  | Recup.2B| 3.Bim.  | Recup.3b| 4.Bim.  | Recup.4B|Rec.Final|RESULTADO'
            @ PROW(),9   SAY+REPL('_',128)
            @ PROW()+1,9 SAY '                       |Notas| F |Notas| F |Notas| F |Notas| F |Notas| F |Notas| F |Notas| F |Notas| F |Notas| F |Notas| TF'
            @ PROW(),9   SAY+REPL('_',128)
            SELE NOTA
            DO WHILE .NOT. EOF() .AND. NEXTKEY()#27
               IF NOTA->COD_ALU$B
                  C:=NOTA->MAT_NOT
                  SELE MATER
                  SET INDEX TO MATECIND
                  SEEK C
                  D:=MATER->MATERIA
                  @ PROW()+1,9 SAY LEFT(D,20)
                  SELE NOTA
                  IF NOTA->NB1#NIL
                     @ PROW(),33 SAY IF(NOTA->NB1#0,NOTA->NB1,' ### ')
                     @ PROW(),39 SAY IF(NOTA->FN1#0,TRANSFORM(NOTA->FN1,'99'),' ##')
                   ENDIF
                  IF NOTA->NR1#NIL
                     @ PROW(),43 SAY IF(NOTA->NR1#0,NOTA->NR1,' ### ')
                     @ PROW(),49 SAY IF(NOTA->FR1#0,TRANSFORM(NOTA->FR1,'99'),' ##')
                   ENDIF
                   IF NOTA->NB2#NIL
                     @ PROW(),53 SAY IF(NOTA->NB2#0,NOTA->NB2,' ### ')
                     @ PROW(),59 SAY IF(NOTA->FN2#0,TRANSFORM(NOTA->FN2,'99'),' ##')
                   ENDIF
                   IF NOTA->NR2#NIL
                     @ PROW(),63 SAY IF(NOTA->NR2#0,NOTA->NR2,' ### ')
                     @ PROW(),69 SAY IF(NOTA->FR2#0,TRANSFORM(NOTA->FR2,'99'),' ##')
                   ENDIF
                   IF NOTA->NB3#NIL
                     @ PROW(),73 SAY IF(NOTA->NB3#0,NOTA->NB3,' ### ')
                     @ PROW(),79 SAY IF(NOTA->FN3#0,TRANSFORM(NOTA->FN3,'99'),' ##')
                   ENDIF
                   IF NOTA->NR3#NIL
                     @ PROW(),83 SAY IF(NOTA->NR3#0,NOTA->NR3,' ### ')
                     @ PROW(),89 SAY IF(NOTA->FR3#0,TRANSFORM(NOTA->FR3,'99'),' ##')
                   ENDIF
                   IF NOTA->NB4#NIL
                     @ PROW(),93 SAY IF(NOTA->NB4#0,NOTA->NB4,' ### ')
                     @ PROW(),99 SAY IF(NOTA->FN4#0,TRANSFORM(NOTA->FN4,'99'),' ##')
                   ENDIF
                   IF NOTA->NR4#NIL
                     @ PROW(),103 SAY IF(NOTA->NR4#0,NOTA->NR4,' ### ')
                     @ PROW(),109 SAY IF(NOTA->FR4#0,TRANSFORM(NOTA->FR4,'99'),' ##')
                   ENDIF
                   IF NOTA->NRF#NIL
                     @ PROW(),113 SAY IF(NOTA->NRF#0,NOTA->NRF,' ### ')
                     @ PROW(),119 SAY IF(NOTA->FRF#0,TRANSFORM(NOTA->FRF,'99'),' ##')
                   ENDIF
                   IF NOTA->RFN#NIL
                     @ PROW(),123 SAY IF(NOTA->RFN#0,NOTA->RFN,' ### ')
                     @ PROW(),129 SAY IF(NOTA->RFF#0,TRANSFORM(NOTA->RFF,'99'),' ##')
                   ENDIF
                  @ PROW(),9 SAY '                       |     |   |     |   |     |   |     |   |     |   |     |   |     |   |     |   |     |   |     |  '
                  @ PROW(),9   SAY+REPL('_',128)
              ENDIF
            SKIP
           ENDDO
        SELE NOTA
        GO TOP
        IF !EMPTY(M_CO1)
            @ PROW()+2,9  SAY+REPL('-',128)
            @ PROW()+1,9  SAY M_CO1
            @ PROW()+1,9  SAY+M_CO2
            @ PROW()+1,9  SAY+REPL('=',128)
        ELSE
            @ PROW()+3,9  SAY+REPL('-',128)
        ENDIF
        SETPRC(0,0)
        EJECT
      ENDIF
      SELE CADA_MAT
      SKIP
     IF EOF()=.T.
        EXIT
     ENDIF
   ENDDO
   SET DEVICE TO SCREEN
ELSEIF IBO$'B' .AND. IBS$'A'
    NOMTELA(' EMISSÇO BOLETIM PARA OS PAIS POR ALUNO')
    TELA(10,5,12,75)
    SELE CADA_MAT
    SET INDEX TO COMATIND
    GO TOP
    B:=PROCNAME()
    C_ALU:=SPACE(6)
    @ 11,6 SAY 'Cod. Aluno :' GET C_ALU PICT'@R 99999-9' VALID(VER_6())
    READ
    IF LASTKEY()=27 .OR. EMPTY(C_ALU)
       RETURN
    ENDIF
    IF !VERIMPRE(); RETURN; ENDIF
        AGREL()
        SET DECIMAL TO 2
        SET DEVICE TO PRINTER
        @ PROW(),0 SAY+CHR(18)+' '
        @ PROW()+1,0 SAY+CHR(14)+PADC(NOESC,44)
        @ PROW()+1,0   SAY+CHR(14)+PADC('===========================',44)
        @ PROW()+2,0 SAY+CHR(18)
        @ PROW()+2,40   SAY ''
        @ PROW(),PCOL() SAY DATE()
        @ PROW()+3,5   SAY 'Prezado(a) Sr.(a). :'
        A1:=CADA_MAT->NOM_RESP
        A2:=CADA_MAT->END_RESP
        A3:=CADA_MAT->BAI_RESP
        A4:=CADA_MAT->CID_RESP
        A5:=CADA_MAT->UF_RESP
        MAIUSC(,,@A1)
        MAIUSC(,,@A2)
        MAIUSC(,,@A3)
        MAIUSC(,,@A4)
        @ PROW()+1,5   SAY  IF(A1#'NIL',A1,'')
        @ PROW()+1,5   SAY  IF(A2#'NIL',A2,'')
        @ PROW()+1,5   SAY  IF(A3#'NIL',A3,'')
        @ PROW()+1,5   SAY  IF(A4#'NIL',A4,'')
        @ PROW(),PCOL()+2 SAY IF(A5#'NIL',A5,'')
        @ PROW()+3,10 SAY 'Senhores Pais ou Responsaveis, '
        @ PROW()+2,10 SAY 'Segue abaixo o Boletim Escolar de vosso filho(a) ou tutelado(a) ,'
        @ PROW()+1,5  SAY 'contendo o desempenho do(a) mesmo(a).                           '
        @ PROW()+2,10 SAY 'A '+NOESC+' decidiu prestar mais esse servico a'
        @ PROW()+1,5  SAY 'vossa Senhoria a fim de que tome conhecimento  das  notas , assim sen-'
        @ PROW()+1,5  SAY 'do, tambem participe da formacao do(a) aluno(a). '
        @ PROW()+2,10 SAY 'Este BOLETIM ESCOLAR e para seu controle, nao sendo necessaria  a'
        @ PROW()+1,5 SAY 'devolucao.                                                       '
        @ PROW()+1,10 SAY '                Modernizando-se para melhor servir!!!  '
        @ PROW()+3,0 SAY+PADC('* BOLETIM ESCOLAR *',80)
        @ PROW(),0   SAY+PADC('* BOLETIM ESCOLAR *',80)
        @ PROW()+1,5 SAY REPL('=',78)
        @ PROW()+1,5 SAY 'Aluno: '
        @ PROW(),12 SAY CADA_MAT->COD_ALU PICT'@R 99999-9'
        A:=CADA_MAT->NOM_ALU
        MAIUSC(,,@A)
        B:=CADA_MAT->COD_ALU
        @ PROW(),20 SAY A
        @ PROW(),20 SAY A
        @ PROW(),20 SAY A
        @ PROW(),56 SAY 'Serie:'+CADA_MAT->SERIE+CADA_MAT->TURMA+' - Grau:'+CADA_MAT->GRAU+'  No.:'+CADA_MAT->NUCLASSE
        @ PROW()+1,5 SAY REPL('-',78)
        @ PROW(),0 SAY CHR(15)
        @ PROW()+1,9 SAY 'Disciplina             | 1.Bim.  |Recup.1B | 2.Bim.  | Recup.2B| 3.Bim.  | Recup.3b| 4.Bim.  | Recup.4B|Rec.Final|RESULTADO'
        @ PROW(),9   SAY+REPL('_',128)
        @ PROW()+1,9 SAY '                       |Notas| F |Notas| F |Notas| F |Notas| F |Notas| F |Notas| F |Notas| F |Notas| F |Notas| F |Notas| TF'
        @ PROW(),9   SAY+REPL('_',128)
        SELE NOTA
        IMS:=0
        IMI:=0
        DO WHILE .NOT. EOF() .AND. NEXTKEY()#27
            IF NOTA->COD_ALU$B
                 C:=NOTA->MAT_NOT
                 SELE MATER
                 SET INDEX TO MATECIND
                 SEEK C
                 D:=MATER->MATERIA
                 @ PROW()+1,9 SAY LEFT(D,20)
                 SELE NOTA
                  IF NOTA->NB1#NIL
                     @ PROW(),33 SAY IF(NOTA->NB1#0,NOTA->NB1,' ### ')
                     @ PROW(),39 SAY IF(NOTA->FN1#0,TRANSFORM(NOTA->FN1,'99'),' ##')
                   ENDIF
                  IF NOTA->NR1#NIL
                     @ PROW(),43 SAY IF(NOTA->NR1#0,NOTA->NR1,' ### ')
                     @ PROW(),49 SAY IF(NOTA->FR1#0,TRANSFORM(NOTA->FR1,'99'),' ##')
                   ENDIF
                   IF NOTA->NB2#NIL
                     @ PROW(),53 SAY IF(NOTA->NB2#0,NOTA->NB2,' ### ')
                     @ PROW(),59 SAY IF(NOTA->FN2#0,TRANSFORM(NOTA->FN2,'99'),' ##')
                   ENDIF
                   IF NOTA->NR2#NIL
                     @ PROW(),63 SAY IF(NOTA->NR2#0,NOTA->NR2,' ### ')
                     @ PROW(),69 SAY IF(NOTA->FR2#0,TRANSFORM(NOTA->FR2,'99'),' ##')
                   ENDIF
                   IF NOTA->NB3#NIL
                     @ PROW(),73 SAY IF(NOTA->NB3#0,NOTA->NB3,' ### ')
                     @ PROW(),79 SAY IF(NOTA->FN3#0,TRANSFORM(NOTA->FN3,'99'),' ##')
                   ENDIF
                   IF NOTA->NR3#NIL
                     @ PROW(),83 SAY IF(NOTA->NR3#0,NOTA->NR3,' ### ')
                     @ PROW(),89 SAY IF(NOTA->FR3#0,TRANSFORM(NOTA->FR3,'99'),' ##')
                   ENDIF
                   IF NOTA->NB4#NIL
                     @ PROW(),93 SAY IF(NOTA->NB4#0,NOTA->NB4,' ### ')
                     @ PROW(),99 SAY IF(NOTA->FN4#0,TRANSFORM(NOTA->FN4,'99'),' ##')
                   ENDIF
                   IF NOTA->NR4#NIL
                     @ PROW(),103 SAY IF(NOTA->NR4#0,NOTA->NR4,' ### ')
                     @ PROW(),109 SAY IF(NOTA->FR4#0,TRANSFORM(NOTA->FR4,'99'),' ##')
                   ENDIF
                   IF NOTA->NRF#NIL
                     @ PROW(),113 SAY IF(NOTA->NRF#0,NOTA->NRF,' ### ')
                     @ PROW(),119 SAY IF(NOTA->FRF#0,TRANSFORM(NOTA->FRF,'99'),' ##')
                   ENDIF
                   IF NOTA->RFN#NIL
                     @ PROW(),123 SAY IF(NOTA->RFN#0,NOTA->RFN,' ### ')
                     @ PROW(),129 SAY IF(NOTA->RFF#0,TRANSFORM(NOTA->RFF,'99'),' ##')
                   ENDIF
                  @ PROW(),9 SAY '                       |     |   |     |   |     |   |     |   |     |   |     |   |     |   |     |   |     |   |     |  '
                 @ PROW(),9   SAY+REPL('_',128)
             ENDIF
         SKIP
     ENDDO
     SELE NOTA
     GO TOP
        IF !EMPTY(M_CO1)
            @ PROW()+2,9  SAY+REPL('-',128)
            @ PROW()+1,9  SAY M_CO1
            @ PROW()+1,9  SAY+M_CO2
            @ PROW()+1,9  SAY+REPL('=',128)
        ELSE
            @ PROW()+2,9  SAY+REPL('-',128)
        ENDIF
     @ 0,0 SAY ' '
   SET DEVICE TO SCREEN
ELSEIF IBO$'C' .AND. IBS$'S'
   NOMTELA(' EMISSÇO CAPA PARA COM DESTINARIO - BOLETIM PARA OS PAIS POR SERIE')
   TELA(10,20,12,60)
   SOMBRA(10,20,12,60)
   SE:=' '
   GR:=' '
   TU:=' '
   CO:=0
   NBPAG:=0
   @ 11,24      SAY 'Grau: ' GET GR PICT'9' VALID(GR$ '12')
   @ 11,COL()+2 SAY 'S‚rie: ' GET SE PICT'9' VALID(SE$ '12345678')
   @ 11,COL()+2 SAY 'Turma: ' GET TU PICT'@S1!' VALID(TU$ 'ABCUE')
   READ
   IF LASTKEY()=27
      RETURN
   ENDIF
   SELE CADA_MAT
   SET INDEX TO GSMATIND
   GO TOP
   SET ORDER TO 6
   IF !VERIMPRE(); RETURN; ENDIF
   AGREL ()
   SET DECIMAL TO 2
   SET DEVICE TO PRINTER
   DO WHILE .NOT. EOF() .AND. NEXTKEY()#27
        IF CADA_MAT->GRAU$GR .AND. CADA_MAT->SERIE$SE .AND. CADA_MAT->TURMA$TU
            A1:=CADA_MAT->NOM_RESP
            A2:=CADA_MAT->END_RESP
            A3:=CADA_MAT->BAI_RESP
            A4:=CADA_MAT->CID_RESP
            A5:=CADA_MAT->UF_RESP
            MAIUSC(,,@A1)
            MAIUSC(,,@A2)
            MAIUSC(,,@A3)
            MAIUSC(,,@A4)
            @ PROW()+1,0 SAY+CHR(18)+' '
            @ PROW()+24,25   SAY  IF(A1#'NIL',A1,'')
            @ PROW()+1,25   SAY  IF(A2#'NIL',A2,'')
            IF A3#NIL
               @ PROW()+1,25  SAY A3
               TR:=0
            ELSE
              TR:=1
            ENDIF
            @ PROW()+1,25   SAY  IF(A4#'NIL',A4,'')
            @ PROW(),PCOL()+2 SAY IF(A5#'NIL',A5,'')
            @ PROW()+1,25   SAY CEP_RESP PICT'@R 99999-999'
            @ PROW()+1,0 SAY+CHR(18)+' '
            @ PROW()+(5+TR),0 SAY+CHR(14)+PADL('IMPRESSO',35)
            @ PROW()+1,0 SAY+CHR(18)+' '
            A:=CADA_MAT->NOM_ALU
            MAIUSC(,,@A)
            B:=CADA_MAT->COD_ALU
            SETPRC(0,0)
            EJECT
      ENDIF
      SKIP
   ENDDO
   SET DEVICE TO SCREEN
ELSEIF IBO$'C' .AND. IBS$'A'
    NOMTELA(' EMISSÇO CAPA PARA COM DESTINARIO - BOLETIM PARA OS PAIS POR ALUNO')
    TELA(10,5,12,75)
    SELE CADA_MAT
    SET INDEX TO COMATIND
    GO TOP
    B:=PROCNAME()
    C_ALU:=SPACE(6)
    @ 11,6 SAY 'C¢d.Aluno : ' GET C_ALU PICT'@R 99999-9' VALID(VER_6())
    READ
    IF LASTKEY()=27 .OR. EMPTY(C_ALU)
       RETURN
    ENDIF
   IF !VERIMPRE(); RETURN; ENDIF
        AGREL()
        SET DECIMAL TO 2
        SET DEVICE TO PRINTER
        A:=NOM_ALU
        MAIUSC(,,@A)
        B:=COD_ALU
        A1:=CADA_MAT->NOM_RESP
        A2:=CADA_MAT->END_RESP
        A3:=CADA_MAT->BAI_RESP
        A4:=CADA_MAT->CID_RESP
        A5:=CADA_MAT->UF_RESP
        MAIUSC(,,@A1)
        MAIUSC(,,@A2)
        MAIUSC(,,@A3)
        MAIUSC(,,@A4)
        @ PROW()+1,0 SAY+CHR(18)+' '
        @ PROW()+24,25   SAY  IF(A1#'NIL',A1,'')
        @ PROW()+1,25   SAY  IF(A2#'NIL',A2,'')
        IF A3#NIL
             @ PROW()+1,25  SAY A3
             TR:=0
          ELSE
            TR:=1
        ENDIF
        @ PROW()+1,25   SAY  IF(A4#'NIL',A4,'')
        @ PROW(),PCOL()+2 SAY IF(A5#'NIL',A5,'')
        @ PROW()+1,25   SAY CEP_RESP PICT'@R 99999-999'
        @ PROW()+1,0 SAY+CHR(18)+' '
        @ PROW()+(5+TR),0 SAY+CHR(14)+PADL('IMPRESSO',35)
        @ PROW()+1,0 SAY+CHR(18)+' '
   SETPRC(0,0)
   IF NEXTKEY()=27
      @ PROW()+1,21 SAY ' *******  CUIDADO - RELATORIO CANCELADO POR PEDIDO USUARIO ANTES DO TERMINO! *******'
      @ PROW(),21   SAY ' *******  CUIDADO - RELATORIO CANCELADO POR PEDIDO USUARIO ANTES DO TERMINO! *******'
   ENDIF
   EJECT
  SET DEVICE TO SCREEN
ENDIF
SETCOLOR(CX)
RETURN



FUNCTION REL_NUMMATR
IF !ABREARQ('CADMATRI','CADA_MAT','R',3)
   RETURN
ENDIF
SET INDEX TO NUMATIND
AGREL()
SET DEVICE TO PRINTER
Q:=1
N:=0
PI:=0
PE:=0
BIS:=0
BIE:=0
BES:=0
BEE:=0
NPAG:=1
DO WHILE .NOT. EOF() .AND. NEXTKEY()#27
CABEIMPRE()
NPAG++
@ 01,00 SAY+CHR(18)+' '
@ PROW()+1,5 SAY+PADC('RELATORIO DE MATRICULAS - Ordenado por n.matricula ',75)
@ PROW()+1,5 SAY+PADC('Legenda: P=Particular B=Bolsista I=interno E=externo S=SEC E=Escola',75)
@ PROW()+1,5 SAY REPL('=',80)
   @ PROW()+1,5 SAY 'N.MATR. |     NOME                           |CODIGO |NO.|GR|SE/TU|CONDICAO'
     @ PROW(),5 SAY 'N.MATR. |     NOME                           |CODIGO |NO.|GR|SE/TU|CONDICAO'
   @ PROW(),4 SAY REPL('_',76)
 DO WHILE .NOT. EOF() .AND. PROW()<56 .AND. NEXTKEY()#27
   A:=NOM_ALU
 IF VAL(NUM_MAT)=Q
   N++
   @ PROW()+1,5 SAY ALLTRIM(NUM_MAT)
   @ PROW(),PCOL()+1 SAY '/94'
   @ PROW(),12 SAY '!'
   @ PROW(),14 SAY A
   @ PROW(),49 SAY '|'
   @ PROW(),50 SAY COD_ALU PICT'@R 99999-9'
   @ PROW(),58 SAY '|'
   @ PROW(),60 SAY NUCLASSE PICT'99'
   @ PROW(),62 SAY '|'
   @ PROW(),64 SAY GRAU
   @ PROW(),66 SAY '!'
   @ PROW(),68 SAY SERIE+TURMA
   @ PROW(),72 SAY '|'
   @ PROW(),73 SAY IF(SIT_ALUN$'1','P','B')
   @ PROW(),75 SAY SIT_INTE
   @ PROW(),77 SAY SIT_ECON
   IF SIT_ALUN$'1'
       IF(SIT_INTE$'I',PI++,PE++)
   ELSE
       IF SIT_INTE$'I' .AND. SIT_ECON$'S'
            BIS++
          ELSEIF SIT_INTE$'I' .AND. SIT_ECON$'E'
            BIE++
          ELSEIF SIT_INTE$'E' .AND. SIT_ECON$'S'
            BES++
          ELSEIF SIT_INTE$'E' .AND. SIT_ECON$'E'
            BEE++
       ENDIF
   ENDIF
   SKIP
 ELSE
     @ PROW()+1,5 SAY ALLTRIM(STRZERO(Q,3))
 ENDIF
   Q++
 ENDDO
ENDDO
@ PROW()+1,0 SAY REPL('=',80)
SET DECIMAL TO 2
@ PROW()+1,25 SAY 'TOTAL DE MATRICULAS...: '
@ PROW(),52 SAY PADL(ALLTRIM(STR(N))+'->',5)
@ PROW(),60 SAY PADL('100%',8)
@ PROW(),25  SAY 'TOTAL DE MATRICULAS...: '
@ PROW(),52 SAY PADL(ALLTRIM(STR(N))+'->',5)
@ PROW(),60 SAY PADL('100%',8)
@ PROW()+2,25 SAY 'Alunos Part. internos : '
@ PROW(),52   SAY PADL(ALLTRIM(STR(PI))+'->',5)
@ PROW(),60 SAY PADL(ALLTRIM(STR(((PI/N)*100)))+'%',8)
@ PROW()+1,25 SAY 'Alunos Part. externos : '
@ PROW(),52 SAY PADL(ALLTRIM(STR(PE))+'->',5)
@ PROW(),60 SAY PADL(ALLTRIM(STR(((PE/N)*100)))+'%',8)
@ PROW()+1,25 SAY 'Total Part.(int+ext)  : '
@ PROW(),52 SAY PADL(ALLTRIM(STR((PI+PE)))+'->',5)
@ PROW(),60 SAY PADL(ALLTRIM(STR((((PI+PE)/N)*100)))+'%',8)
@ PROW(),25   SAY 'Total Part.(int+ext)  : '
@ PROW(),52 SAY PADL(ALLTRIM(STR((PI+PE)))+'->',5)
@ PROW(),60 SAY PADL(ALLTRIM(STR((((PI+PE)/N)*100)))+'%',8)
@ PROW()+2,25 SAY 'Alunos Bols. int. SEC : '
@ PROW(),52 SAY PADL(ALLTRIM(STR(BIS))+'->',5)
@ PROW(),60 SAY PADL(ALLTRIM(STR(((BIS/N)*100)))+'%',8)
@ PROW()+1,25 SAY 'Alunos Bols. ext. SEC : '
@ PROW(),52 SAY PADL(ALLTRIM(STR(BES))+'->',5)
@ PROW(),60 SAY PADL(ALLTRIM(STR(((BES/N)*100)))+'%',8)
@ PROW()+1,25 SAY 'Total Bols.(int+ext)  : '
@ PROW(),52 SAY PADL(ALLTRIM(STR((BIS+BES)))+'->',5)
@ PROW(),60 SAY PADL(ALLTRIM(STR((((BIS+BES)/N)*100)))+'%',8)
@ PROW(),25   SAY 'Total Bols.(int+ext)  : '
@ PROW(),52 SAY PADL(ALLTRIM(STR((BIS+BES)))+'->',5)
@ PROW(),60 SAY PADL(ALLTRIM(STR((((BIS+BES)/N)*100)))+'%',8)
@ PROW()+2,25 SAY 'Alunos Bols. int. EEB : '
@ PROW(),52 SAY PADL(ALLTRIM(STR(BIE))+'->',5)
@ PROW(),60 SAY PADL(ALLTRIM(STR(((BIE/N)*100)))+'%',8)
@ PROW()+1,25 SAY 'Alunos Bols. ext. EEB : '
@ PROW(),52 SAY PADL(ALLTRIM(STR(BEE))+'->',5)
@ PROW(),60 SAY PADL(ALLTRIM(STR(((BEE/N)*100)))+'%',8)
@ PROW()+1,25 SAY 'Total Bols.Escola Fil.: '
@ PROW(),52 SAY PADL(ALLTRIM(STR((BEE+BIE)))+'->',5)
@ PROW(),60 SAY PADL(ALLTRIM(STR((((BEE+BIE)/N)*100)))+'%',8)
@ PROW(),25   SAY 'Total Bols.Escola Fil.: '
@ PROW(),52 SAY PADL(ALLTRIM(STR((BEE+BIE)))+'->',5)
@ PROW(),60 SAY PADL(ALLTRIM(STR((((BEE+BIE)/N)*100)))+'%',8)
@ PROW()+1,0 SAY REPL('# ',40)
IF NEXTKEY()=27
      @ PROW()+1,5 SAY ' *******  CUIDADO - RELATORIO CANCELADO POR PEDIDO USUARIO ANTES DO TERMINO! *******'
      @ PROW(),5   SAY ' *******  CUIDADO - RELATORIO CANCELADO POR PEDIDO USUARIO ANTES DO TERMINO! *******'
ENDIF
EJECT
SET DEVICE TO SCREEN
SET DECIMAL TO 2
RETURN


FUNCTION NUMMATR2
IF !ABREARQ('CADMATRI','CADA_MAT','R',3)
   RETURN
ENDIF
SET INDEX TO NUMATIND
AGREL()
SET DEVICE TO PRINTER
Q:=1
N:=0
PI:=0
PE:=0
BIS:=0
BIE:=0
BES:=0
BEE:=0
NPAG:=1
DO WHILE .NOT. EOF()
CABEIMPRE()
NPAG++
@ 02,00 SAY+CHR(18)+' '
@ PROW(),0 SAY+REPL('_',80)
@ PROW()+2,0 SAY+PADC('RESUMO ESTATISTICO DAS MATRICULAS ',80)
@ PROW()+1,0 SAY REPL('=',80)
DO WHILE .NOT. EOF()
 IF VAL(NUM_MAT)=Q
   N++
   IF SIT_ALUN$'1'
       IF(SIT_INTE$'I',PI++,PE++)
   ELSE
       IF SIT_INTE$'I' .AND. SIT_ECON$'S'
            BIS++
          ELSEIF SIT_INTE$'I' .AND. SIT_ECON$'E'
            BIE++
          ELSEIF SIT_INTE$'E' .AND. SIT_ECON$'S'
            BES++
          ELSEIF SIT_INTE$'E' .AND. SIT_ECON$'E'
            BEE++
       ENDIF
    ENDIF
  SKIP
  ENDIF
  Q++
 ENDDO
ENDDO
SET DECIMAL TO 2
@ PROW()+1,25 SAY 'TOTAL DE MATRICULAS...: '
@ PROW(),52 SAY PADL(ALLTRIM(STR(N))+'->',5)
@ PROW(),60 SAY PADL('100%',8)
@ PROW(),25  SAY 'TOTAL DE MATRICULAS...: '
@ PROW(),52 SAY PADL(ALLTRIM(STR(N))+'->',5)
@ PROW(),60 SAY PADL('100%',8)
@ PROW()+2,25 SAY 'Alunos Part. internos : '
@ PROW(),52   SAY PADL(ALLTRIM(STR(PI))+'->',5)
@ PROW(),60 SAY PADL(ALLTRIM(STR(((PI/N)*100)))+'%',8)
@ PROW()+1,25 SAY 'Alunos Part. externos : '
@ PROW(),52 SAY PADL(ALLTRIM(STR(PE))+'->',5)
@ PROW(),60 SAY PADL(ALLTRIM(STR(((PE/N)*100)))+'%',8)
@ PROW()+1,25 SAY 'Total Part.(int+ext)  : '
@ PROW(),52 SAY PADL(ALLTRIM(STR((PI+PE)))+'->',5)
@ PROW(),60 SAY PADL(ALLTRIM(STR((((PI+PE)/N)*100)))+'%',8)
@ PROW(),25   SAY 'Total Part.(int+ext)  : '
@ PROW(),52 SAY PADL(ALLTRIM(STR((PI+PE)))+'->',5)
@ PROW(),60 SAY PADL(ALLTRIM(STR((((PI+PE)/N)*100)))+'%',8)
@ PROW()+2,25 SAY 'Alunos Bols. int. SEC : '
@ PROW(),52 SAY PADL(ALLTRIM(STR(BIS))+'->',5)
@ PROW(),60 SAY PADL(ALLTRIM(STR(((BIS/N)*100)))+'%',8)
@ PROW()+1,25 SAY 'Alunos Bols. ext. SEC : '
@ PROW(),52 SAY PADL(ALLTRIM(STR(BES))+'->',5)
@ PROW(),60 SAY PADL(ALLTRIM(STR(((BES/N)*100)))+'%',8)
@ PROW()+1,25 SAY 'Total Bols.(int+ext)  : '
@ PROW(),52 SAY PADL(ALLTRIM(STR((BIS+BES)))+'->',5)
@ PROW(),60 SAY PADL(ALLTRIM(STR((((BIS+BES)/N)*100)))+'%',8)
@ PROW(),25   SAY 'Total Bols.(int+ext)  : '
@ PROW(),52 SAY PADL(ALLTRIM(STR((BIS+BES)))+'->',5)
@ PROW(),60 SAY PADL(ALLTRIM(STR((((BIS+BES)/N)*100)))+'%',8)
@ PROW()+2,25 SAY 'Alunos Bols. int. EEB : '
@ PROW(),52 SAY PADL(ALLTRIM(STR(BIE))+'->',5)
@ PROW(),60 SAY PADL(ALLTRIM(STR(((BIE/N)*100)))+'%',8)
@ PROW()+1,25 SAY 'Alunos Bols. ext. EEB : '
@ PROW(),52 SAY PADL(ALLTRIM(STR(BEE))+'->',5)
@ PROW(),60 SAY PADL(ALLTRIM(STR(((BEE/N)*100)))+'%',8)
@ PROW()+1,25 SAY 'Total Bols.Escola Fil.: '
@ PROW(),52 SAY PADL(ALLTRIM(STR((BEE+BIE)))+'->',5)
@ PROW(),60 SAY PADL(ALLTRIM(STR((((BEE+BIE)/N)*100)))+'%',8)
@ PROW(),25   SAY 'Total Bols.Escola Fil.: '
@ PROW(),52 SAY PADL(ALLTRIM(STR((BEE+BIE)))+'->',5)
@ PROW(),60 SAY PADL(ALLTRIM(STR((((BEE+BIE)/N)*100)))+'%',8)
@ PROW()+1,0 SAY REPL('# ',40)
EJECT
SET DEVICE TO SCREEN
SET DECIMAL TO 2
RETURN





FUNCTION CONFCANHO
IF !ABREARQ('CADNOTAS','NOTA','R',3)
       RETURN
ENDIF
IF !ABREARQ('CADMATRI','CADA_MAT','R',3)
   RETURN
ENDIF
SET INDEX TO GSMATIND
SELE NOTA
SET INDEX TO CMNOTIND
SET DECIMAL TO 2
T:=SAVESCREEN(05,05,24,79)
NOMTELA('RELATORIO DE CONFERENCIA DE CANHOTOS')
COA:=SETCOLOR()
SETCOLOR(GCOR2)
DO WHILE .T.
   TELA(7,10,9,70)
   G:=' '; S:=' ' ; N_M:='000'; BI:=' '; T:=' '; C:=0; RE:=' '
   PRIVATE MR[5]
   AFILL(MR,'000')
   @ 8,20          SAY 'Grau:'   GET G PICT'9' VALID(G$ '12')
   @ ROW(),COL()+1 SAY 'Serie:'  GET S PICT'9' VALID(S$ '12345678')
   @ ROW(),COL()+1 SAY 'Turma:'  GET T PICT'@S1!'
   @ ROW(),COL()+1 SAY 'Bim.:'   GET BI PICT'@S1!' VALID(BI$ '1234RM')
   @ ROW(),COL()+1 SAY 'Rec.:'   GET RE PICT'@S1!' VALID(RE$ 'R ')
   READ
   TELA(10,10,15,70,10,22,34,46,58,,'1¦ Materia','2¦ Materia','3¦ Materia','4¦ Materia','5¦ Materia')
   @ 13,11 GET MR[1] PICT'@R 99-9'
   @ 13,23 GET MR[2] PICT'@R 99-9'
   @ 13,35 GET MR[3] PICT'@R 99-9'
   @ 13,47 GET MR[4] PICT'@R 99-9'
   @ 13,59 GET MR[5] PICT'@R 99-9'
   READ
   IF LASTKEY()=27
      EXIT
   ENDIF
   ARMCOD:={}; NALU:={}
   SELE CADA_MAT
   GO TOP
   SEEK (G+S+T)
   DO WHILE GRAU$G .AND. SERIE$S .AND. TURMA$T
           AADD(ARMCOD,COD_ALU)
           AADD(NALU,NUCLASSE)
           SKIP
   ENDDO
   CT:=LEN(ARMCOD)
   PRIVATE NOTALU[CT], FALALU[CT]
   AFILL(NOTALU,00.00)
   AFILL(FALALU,0)
   ATE:=SAVESCREEN(05,05,24,79)
   SET DECIMAL TO 2
   NPAG:=1
   C:=5
   I:=1
   M2:=' '
   PRIVATE M1[CT,5]
   FOR J=1 TO CT
       FOR H=1 TO 5
           M1[J,H]:=SPACE(13)
       NEXT
   NEXT
   H:=1
   DO WHILE H<6
         M2+=G+' '+S+'  '+T+' '+MR[H]+'    '
         I:=1
         DO WHILE I<=CT
           SELE NOTA
           GO TOP
           SEEK (ARMCOD[I]+(MR[H]))
            IF FOUND()
             IF BI$'1' .AND. EMPTY(RE)
                 NOTALU[I]:=NOTA->NB1
                 FALALU[I]:=NOTA->FN1
             ELSEIF BI$'2' .AND. EMPTY(RE)
                 NOTALU[I]:=NOTA->NB2
                 FALALU[I]:=NOTA->FN2
             ELSEIF BI$'3' .AND. EMPTY(RE)
                 NOTALU[I]:=NOTA->NB3
                 FALALU[I]:=NOTA->FN3
             ELSEIF BI$'4' .AND. EMPTY(RE)
                 NOTALU[I]:=NOTA->NB4
                 FALALU[I]:=NOTA->FN4
             ELSEIF BI$'M' .AND. EMPTY(RE)
                 NOTALU[I]:=NOTA->RFN
                 FALALU[I]:=NOTA->RFF
             ELSEIF BI$'1' .AND. RE='R'
                 NOTALU[I]:=NOTA->NR1
                 FALALU[I]:=NOTA->FR1
             ELSEIF BI$'2' .AND. RE='R'
                 NOTALU[I]:=NOTA->NR2
                 FALALU[I]:=NOTA->FR2
             ELSEIF BI$'3' .AND. RE='R'
                 NOTALU[I]:=NOTA->NR3
                 FALALU[I]:=NOTA->FR3
             ELSEIF BI$'4' .AND. RE='R'
                 NOTALU[I]:=NOTA->NR4
                 FALALU[I]:=NOTA->FR4
             ELSEIF BI$'R' .AND. RE='R'
                 NOTALU[I]:=NOTA->NRF
                 FALALU[I]:=NOTA->FRF
             ENDIF
           ELSE
               NOTALU[I]:=00.00
               FALALU[I]:=00
           ENDIF
           GO TOP
           M1[I,H]:=NALU[I]+' '
           M1[I,H]+=STR((NOTALU[I]),5,2)+' '
           M1[I,H]+=STR(FALALU[I],2)+' '
           M1[I,H]+=' '
           I++
         ENDDO
      H++
   ENDDO
   SET DEVICE TO SCREEN
   IF VERIMPRE()=.F.
       EXIT
   ENDIF
   AGREL()
   SET DECIMAL TO 2
   SET DEVICE TO PRINTER
   I:=1
   @ PROW()+1,10 SAY+CHR(15)+PADC(NOESC+'  - SISTEMA INTEGRADO ESCOLAR', 125)
   @ PROW(),10 SAY PADR(DATE(),125)
   @ PROW(),10 SAY PADL('Pag.:'+STRZERO(NPAG,3),125)
   @ PROW(),10 SAY+CHR(15)+repl('_',126)
   @ PROW()+1,0 SAY+CHR(18)+' '
   @ PROW()+1,0 SAY+CHR(18)+PADC('* CONFERENCIA DE CANHOTOS '+DTOC(DATE())+' Bim: '+BI+' Rec.:'+RE+' *',80)
   @ PROW()+2,C SAY M2
   @ PROW(),0 SAY+CHR(18)
   @ PROW()+1,5 SAY REPL('- ',36)
   @ PROW()+1,C SAY ' N. Nota Falta N. Nota Falta N. Nota Falta N. Nota Falta N. Nota Falta'
   @ PROW(),5 SAY REPL('__',36)
   FOR J=1 TO CT
       @ PROW()+1,4 SAY ' '
       FOR H=1 TO 5
           @ PROW(),PCOL()+1 SAY M1[J,H]
       NEXT
   NEXT
   @ PROW()+1,0 SAY ' '
   EJECT
   SET DEVICE TO SCREEN
   RESTSCREEN(05,05,24,79,ATE)
ENDDO
SET DECIMAL TO 0
SET INDEX TO CMNOTIND
SETCOLOR(COA)
RESTSCREEN(05,05,24,79,T)
RETURN


FUNCTION VER_MSG(U)
SELE CADMSG
IF COD_M$'0000'
   RETURN.T.
ENDIF
SEEK COD_M
IF FOUND()
   GO RECNO()
   IF U=1
      M_CO1:=CADMSG->MSGPAD
   ELSEIF U=2
      M_CO2:=CADMSG->MSGPAD
   ENDIF
ELSE
   TONE(123,1)
   TONE(137,5)
   TEL22:=SAVESCREEN(2,3,23,78)
   TELA(17,5,19,75)
   @ 18,20 SAY 'Codigo inexistente -  cadastre ou tente novamente!'
   INKEY(2)
   @ 2,3 CLEAR TO 23,78
   RESTSCREEN(2,3,23,78,TEL22)
ENDIF
RETURN.T.





FUNCTION SEC_CONFIGURAR()
TEL22:=SAVESCREEN(2,3,23,78)
NOMTELA('CONFIGURAR PARA APARECER OS REGISTROS APAGADOS  ')
T:=' '
TELA(3,55,5,73)
@ 4,56 SAY '[S]im ou [N]Æo:' GET T PICT'@S1!' VALID(T$ 'SN')
READ
IF T$'S'
   SET DELETED OFF
 ELSE
   SET DELETED ON
ENDIF
RESTSCREEN(2,3,23,78,TEL22)
RETURN
